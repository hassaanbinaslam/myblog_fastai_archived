---
keywords: fastai
description: How to call an ML model endpoint hosted by SageMaker using serverless technology.
title: Serverless Inference with SageMaker Serverless Endpoints
toc: true 
badges: true
comments: true
categories: [aws, ml, sagemaker]
keyword: [aws, ml, sagemaker]
image: images/copied_from_nb/images/2022-06-17-sagemaker-endpoint.jpeg
nb_path: _notebooks/2022-06-17-sagemaker-endpoint.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-06-17-sagemaker-endpoint.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint.jpeg" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="About">About<a class="anchor-link" href="#About"> </a></h1><p>You have trained an deployed a model using Amazon SageMaker. You have an endpoint and now you are wondering "After I deploy an endpoint, where do I go from there?" Your concerns are valid because SageMaker endpoints are not public but are scoped to an individual account. In this post we will learn how to make them public using AWS serverless technologies: AWS Lambda and Function URL. We will also make our endpoints serverless so ML inference solution is serverless end-to-end.</p>
<h1 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h1><p>The following diagram shows how a model is called using serverless architecture.
<br><br>
<img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/serverless-architecture.png" alt="serverless-architecture"></p>
<p>Starting from the client, a client application calls the AWS Lambda Function URL and passes parameter values. The Lambda function parses the request and passes it SageMaker model endpoint. This endpoint can be host on an EC2 instance or you have the option to make it serverless. Serverless endpoints behave similar to Lambda functions. Once request is received by the endpoint it will perform the prediction and return the predicted values back to Lambda. The Lambda function parses the returned values and send the final response back to client.</p>
<p>To train a model using Amazon SageMaker you can follow my other post <a href="https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/06/08/sagemaker-training-overview.html">Demystifying Amazon SageMaker Training for scikit-learn Lovers</a>. There I have trained SageMaker Linear Learner model on Boston housing dataset.</p>
<p><code>Note that this post assumes that you have already trained a model and is available in SageMaker model repository.</code></p>
<h1 id="Deploying-SageMaker-Serverless-Endpoint">Deploying SageMaker Serverless Endpoint<a class="anchor-link" href="#Deploying-SageMaker-Serverless-Endpoint"> </a></h1><p>Let's visit SageMaker model repository to find our Linear Learner model. You can find the repository in <strong>SageMaker Inference / Model</strong> page.</p>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/model-repo.png" alt="model-repo"></p>
<p>Note the mode name <code>linear-learner-2022-06-16-09-10-17-207</code> as will need in later steps.</p>
<p>Click on the <em>model name</em> and then <strong>Create endpoint</strong></p>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/create-endpoint.png" alt="create-endpoint"></p>
<p>This will take you to <strong>configure endpoint page</strong>. Here do the following configurations.</p>
<ul>
<li>Set <strong>Endpoint name</strong> to <code>2022-06-17-sagemaker-endpoint-serverless</code>. You may use anyother unique string here.</li>
<li>From <strong>Attach endpoint configuration</strong> select <code>create a new endpoint configuration</code></li>
<li>From <strong>New endpoint configuration / Endpoint configuration</strong> set<ul>
<li><strong>Endpoint configuration name</strong> to <code>config-2022-06-17-sagemaker-endpoint-serverless</code>. You may use anyother name here.</li>
<li><strong>Type of endpoint</strong> to <code>Serverless</code></li>
<li>From <strong>Production variants</strong> click on <strong>Add Model</strong> and then select the model name we want to deploy. In our case it is <code>linear-learner-2022-06-16-09-10-17-207</code>. Click <strong>Save</strong>. </li>
</ul>
</li>
</ul>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/add-model.png" alt="add-model"></p>
<ul>
<li>Then Edit the <strong>Max Concurrency</strong> and set it to 5.</li>
</ul>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/max-concurrency.png" alt="max-concurrency"></p>
<ul>
<li>Click <strong>Create endpoint configuration</strong></li>
</ul>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/new-endpoint-config.png" alt="new-endpoint-config"></p>
<ul>
<li>Click <strong>Create endpoint</strong></li>
</ul>
<p><img src="/myblog/images/copied_from_nb/images/2022-06-17-sagemaker-endpoint/endpoint-created.png" alt="endpoint-created"></p>
<p>It will take a minute for the created endpoint to become in service.
cold start issues and timeout.
logs : /aws/sagemaker/Endpoints/2022-06-17-sagemaker-endpoint-serverless
logs, docker container, gunicorn server, input iterators.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sagemaker</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">c:\MyWorkspace\gitrepos\myblog\myblog\_notebooks\2022-06-17-sagemaker-endpoint.ipynb Cell 4&#39;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; &lt;a href=&#39;vscode-notebook-cell:/c%3A/MyWorkspace/gitrepos/myblog/myblog/_notebooks/2022-06-17-sagemaker-endpoint.ipynb#ch0000058?line=0&#39;&gt;1&lt;/a&gt;</span> import sagemaker

<span class="ansi-red-intense-fg ansi-bold">ModuleNotFoundError</span>: No module named &#39;sagemaker&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

