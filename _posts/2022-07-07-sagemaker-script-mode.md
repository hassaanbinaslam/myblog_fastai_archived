---
keywords: fastai
description: The aim of this notebook is to demonstrate how to train and deploy a scikit-learn model in Amazon SageMaker using script mode.
title: Deploy Scikit-learn Models to Amazon SageMaker with the SageMaker Python SDK using Script mode
toc: true 
badges: true
comments: true
categories: [aws, ml, sagemaker]
keyword: [aws, ml, sagemaker, sklearn, scikit-learn, python]
image: images/copied_from_nb/images/2022-07-07-sagemaker-script-mode.jpeg
nb_path: _notebooks/2022-07-07-sagemaker-script-mode.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-07-07-sagemaker-script-mode.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-07-07-sagemaker-script-mode.jpeg" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h1><p>You may have trained a model with your favorite ML framework, and now you are asked to move your code to Amazon SageMaker. The good news is that SageMaker's fully managed training works well with many popular ML frameworks, including <code>scikit-learn.</code> In addition, SageMaker provides its prebuilt container for the scikit-learn framework, enabling us to port our scripts to SageMaker and benefit from its training and deployment capabilities. SageMaker's scikit-learn container is an open source library for making the scikit-learn framework run on the Amazon SageMaker platform. You can read more about sklearn container features from its GitHub page <a href="https://github.com/aws/sagemaker-scikit-learn-container">SageMaker Scikit-learn Container</a>.</p>
<p>Amazon SageMaker also provides open source Python SDK to train and deploy models on SageMaker. SageMaker SDK provides several high-level abstractions (classes), including:</p>
<ul>
<li><code>Session</code> Provides a collection of methods for working with SageMaker resources </li>
<li><code>Estimators</code> Encapsulate training on SageMaker</li>
<li><code>Predictors</code> Provide real-time inference and transformation using Python data types against a SageMaker endpoint
You can read more on SageMaker Python SDK from its official site <a href="https://sagemaker.readthedocs.io/en/stable/overview.html">Amazon SageMaker Python SDK</a></li>
</ul>
<p>This approach of using a custom training script with SageMaker's prebuilt container is commonly called <strong>Script Mode</strong>. To train a scikit-learn model by using the SageMaker Python SDK involves three steps:</p>
<ol>
<li><strong>Prepare a training script</strong>. The training script is similar to any other scikit-learn training script that you might use outside of SageMaker</li>
<li><strong>Create an Estimator object from class <code>sagemaker.sklearn.SKLearn</code></strong>. Scikit-learn estimator class handles end-to-end training and deployment of custom scikit-learn code. It will execute a scikit-learn script within a SageMaker Training Job. The managed scikit-learn environment is an Amazon-built Docker container that runs functions defined in the supplied <code>entry_point</code> Python script. </li>
<li><strong>Call the Estimator's <code>fit</code> method on training data</strong>. Training is started by calling <code>fit()</code> on this Estimator. After training is complete, calling <code>deploy()</code> creates a hosted SageMaker endpoint and returns a <code>SKLearnPredictor</code> instance that can be used to perform inference against the hosted model. We will discuss the <code>SKLearn</code> Estimator in more detail later in this post.</li>
</ol>
<p>To read more about using scikit-learn with the SageMaker Python SDK, you may refer to the official documentation <a href="https://sagemaker.readthedocs.io/en/stable/frameworks/sklearn/using_sklearn.html">using Scikit-learn with the SageMaker Python SDK</a>. The official documentation is valuable, and I would highly recommend checking it and keeping it as a reference.</p>
<p>In this post we will built a scikit-learn <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html">RandomForrestClassifier</a> on <a href="https://archive.ics.uci.edu/ml/datasets/iris">iris public dataset</a>. There is a similar example in SageMaker documentation. <a href="https://sagemaker-examples.readthedocs.io/en/latest/sagemaker-script-mode/sklearn/sklearn_byom_outputs.html">Train a SKLearn Model using Script Mode</a>. Still, it does not discuss many important elements of a scikit-learn container and its environment. This post will cover all the stages of training a scikit-learn model with script mode. I also noted that the example in the documentation uses <code>RandomForrestRegressor</code> on a classification problem which I believe is a mistake.</p>
<p>We have much to cover and learn, so let's start.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Environment">Environment<a class="anchor-link" href="#Environment"> </a></h1><p>notebook environment.</p>
<h1 id="Prepare-training-and-test-data">Prepare training and test data<a class="anchor-link" href="#Prepare-training-and-test-data"> </a></h1><p>We will use <strong>Iris flower dataset</strong>. It includes three iris species (Iris setosa, Iris virginica, and Iris versicolor) with 50 samples each and some properties about each flower. You can read more about this dataset at <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set">Iris flower data set</a></p>
<ol>
<li>sepal length in cm</li>
<li>sepal width in cm</li>
<li>petal length in cm</li>
<li>petal width in cm</li>
<li>class: Iris Setosa, Iris Versicolour, Iris Virginica</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Download-and-preprocess-data">Download and preprocess data<a class="anchor-link" href="#Download-and-preprocess-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># download dataset</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
<span class="n">s3</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;sagemaker-sample-files&quot;</span><span class="p">,</span> <span class="s2">&quot;datasets/tabular/iris/iris.data&quot;</span><span class="p">,</span> <span class="s2">&quot;iris.data&quot;</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;iris.data&quot;</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sepal_len&quot;</span><span class="p">,</span> <span class="s2">&quot;sepal_wid&quot;</span><span class="p">,</span> <span class="s2">&quot;petal_len&quot;</span><span class="p">,</span> <span class="s2">&quot;petal_wid&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_len</th>
      <th>sepal_wid</th>
      <th>petal_len</th>
      <th>petal_wid</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Convert the three classes from strings to integers in {0,1,2}</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
<span class="n">categories_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">categories_map</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{0: &#39;Iris-setosa&#39;, 1: &#39;Iris-versicolor&#39;, 2: &#39;Iris-virginica&#39;}
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_len</th>
      <th>sepal_wid</th>
      <th>petal_len</th>
      <th>petal_wid</th>
      <th>class</th>
      <th>class_cat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>Iris-setosa</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prepare-and-store-train-and-test-sets-as-CSV-files">Prepare and store train and test sets as CSV files<a class="anchor-link" href="#Prepare-and-store-train-and-test-sets-as-CSV-files"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># split the data into train and test set</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train.shape: </span><span class="si">{</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test.shape: </span><span class="si">{</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>train.shape: (120, 6)
test.shape: (30, 6)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have our dataset ready. Let's define a local directory where we keep all the files and artifacts related to this post. I will refer to this directory as 'workspace'.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># `local_path` will be the root directory for this post.</span>
<span class="n">local_path</span> <span class="o">=</span> <span class="s2">&quot;./datasets/2022-07-07-sagemaker-script-mode&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have train and test sets ready. Let's create two more directories in our workspace and store our data in them.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># local paths</span>
<span class="n">local_train_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">/train&quot;</span>
<span class="n">local_test_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">/test&quot;</span>

<span class="c1"># create local directories</span>
<span class="n">Path</span><span class="p">(</span><span class="n">local_train_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Path</span><span class="p">(</span><span class="n">local_test_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;local_train_path: </span><span class="si">{</span><span class="n">local_train_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;local_test_path: </span><span class="si">{</span><span class="n">local_test_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># local file names</span>
<span class="n">local_train_file</span> <span class="o">=</span> <span class="n">local_train_path</span> <span class="o">+</span> <span class="s2">&quot;/train.csv&quot;</span>
<span class="n">local_test_file</span> <span class="o">=</span> <span class="n">local_test_path</span> <span class="o">+</span> <span class="s2">&quot;/test.csv&quot;</span>

<span class="c1"># write train and test CSV files</span>
<span class="n">train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">local_train_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">local_test_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;local_train_file: </span><span class="si">{</span><span class="n">local_train_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;local_test_file: </span><span class="si">{</span><span class="n">local_test_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>local_train_path: ./datasets/2022-07-07-sagemaker-script-mode/train
local_test_path: ./datasets/2022-07-07-sagemaker-script-mode/test
local_train_file: ./datasets/2022-07-07-sagemaker-script-mode/train/train.csv
local_test_file: ./datasets/2022-07-07-sagemaker-script-mode/test/test.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-SageMaker-session">Create SageMaker session<a class="anchor-link" href="#Create-SageMaker-session"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sagemaker</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">role</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">boto_region_name</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sagemaker.__version__: </span><span class="si">{</span><span class="n">sagemaker</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session: </span><span class="si">{</span><span class="n">session</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Role: </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bucket: </span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region: </span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What we have done is</p>
<ul>
<li>imported the SageMaker Python SDK into our runtime</li>
<li>get a session to work with SageMaker API and other AWS services</li>
<li>get the execution role associated with the user profile. It is the same profile that is available to the user to work from console UI and has <code>AmazonSageMakerFullAccess</code> policy attached to it.</li>
<li>create or get a default bucket to use and return its name. Default bucket name has the format <code>sagemaker-{region}-{account_id}</code>. If it doesn't exist then our session will automatically create it. You may also use any other bucket in its place given that you have enough permission for reading and writing.</li>
<li>get the region name attached to our session</li>
</ul>
<p>Next, we will use this session to upload data to our default bucket.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Upload-data-to-Amazon-S3-bucket">Upload data to Amazon S3 bucket<a class="anchor-link" href="#Upload-data-to-Amazon-S3-bucket"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># You may choose any other prefix for your bucket.</span>
<span class="c1"># All the data related to this post will be under this prefix.</span>
<span class="n">bucket_prefix</span> <span class="o">=</span> <span class="s2">&quot;2022-07-07-sagemaker-script-mode&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now upload the data. In the output, we will get the complete path (S3 URI) for our uploaded data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_train_uri</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">upload_data</span><span class="p">(</span><span class="n">local_train_file</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="n">bucket_prefix</span> <span class="o">+</span> <span class="s2">&quot;/data&quot;</span><span class="p">)</span>
<span class="n">s3_test_uri</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">upload_data</span><span class="p">(</span><span class="n">local_test_file</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="n">bucket_prefix</span> <span class="o">+</span> <span class="s2">&quot;/data&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3_train_uri: </span><span class="si">{</span><span class="n">s3_train_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3_test_uri: </span><span class="si">{</span><span class="n">s3_test_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>s3_train_uri: s3://sagemaker-us-east-1-801598032724/sklearn-iris/data/train.csv
s3_test_uri: s3://sagemaker-us-east-1-801598032724/sklearn-iris/data/test.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this point our data preparation step is complete. Training and test CSV files are available both on the local system, and in our default Amazon S3 bucket.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Prepare-SageMaker-local-environment">Prepare SageMaker local environment<a class="anchor-link" href="#Prepare-SageMaker-local-environment"> </a></h1><p>The Amazon SageMaker training environment is managed, but SageMaker Python SDK also supports <strong>local mode</strong>, allowing you to train and deploy models to your local environment. This is a great way to test training scripts before running them in SageMaker's managed training or hosting environment.</p>
<h2 id="How-SageMaker-managed-environment-works?">How SageMaker managed environment works?<a class="anchor-link" href="#How-SageMaker-managed-environment-works?"> </a></h2><p>When you send a request to SageMaker API (fit or deploy call)</p>
<ul>
<li>it spins up new instances with the provided specification</li>
<li>loads the algorithm container</li>
<li>pulls the data from S3</li>
<li>runs the training code</li>
<li>store the results and trained model artifacts to S3</li>
<li>terminates the new instances</li>
</ul>
<p>All this happens behind the scenes with a single line of code and is a huge advantage. Spinning up new hardware every time can be good for repeatability and security, but it can add some friction while testing and debugging our code. We can test our code on a small dataset in our local environment with SageMaker local mode and then switch seamlessly to SageMaker managed environment by changing a single line of code.</p>
<h2 id="Steps-to-prepare-Amazon-SageMaker-local-environment">Steps to prepare Amazon SageMaker local environment<a class="anchor-link" href="#Steps-to-prepare-Amazon-SageMaker-local-environment"> </a></h2><p>Install the following pre-requisites if you want to set up Amazon SageMaker on your local system.</p>
<ol>
<li>Install required Python packages:
<pre><code> pip install boto3 sagemaker pandas scikit-learn
 pip install 'sagemaker[local]'</code></pre>
</li>
<li>Docker Desktop installed and running on your computer:
<pre><code> docker ps</code></pre>
</li>
<li>You should have AWS credentials configured on your local machine to be able to pull the docker image from ECR.</li>
</ol>
<h3 id="Instructions-for-SageMaker-notebook-instances">Instructions for SageMaker notebook instances<a class="anchor-link" href="#Instructions-for-SageMaker-notebook-instances"> </a></h3><p>You can also set up SageMaker's local environment in SageMaker notebook instances. Required Python packages and Docker service is already there. You only need to upgrade the <code>sagemaker[local]</code> Python package.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this is required for SageMaker notebook instances</span>
<span class="o">!</span>pip install <span class="s1">&#39;sagemaker[local]&#39;</span> --upgrade
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Looking in indexes: https://pypi.org/simple, https://pip.repos.neuron.amazonaws.com
Requirement already satisfied: sagemaker[local] in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (2.99.0)
Requirement already satisfied: pandas in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.3.4)
Requirement already satisfied: google-pasta in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (0.2.0)
Requirement already satisfied: smdebug-rulesconfig==1.0.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.0.1)
Requirement already satisfied: protobuf&lt;4.0,&gt;=3.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (3.19.1)
Requirement already satisfied: attrs&lt;22,&gt;=20.3.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (20.3.0)
Requirement already satisfied: protobuf3-to-dict&lt;1.0,&gt;=0.1.5 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (0.1.5)
Requirement already satisfied: importlib-metadata&lt;5.0,&gt;=1.4.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (4.8.2)
Requirement already satisfied: packaging&gt;=20.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (21.3)
Requirement already satisfied: boto3&lt;2.0,&gt;=1.20.21 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.21.42)
Requirement already satisfied: pathos in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (0.2.8)
Requirement already satisfied: numpy&lt;2.0,&gt;=1.9.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.20.3)
Requirement already satisfied: urllib3==1.26.8 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.26.8)
Requirement already satisfied: PyYAML==5.4.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (5.4.1)
Requirement already satisfied: docker-compose==1.29.2 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (1.29.2)
Requirement already satisfied: docker~=5.0.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from sagemaker[local]) (5.0.3)
Requirement already satisfied: dockerpty&lt;1,&gt;=0.4.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (0.4.1)
Requirement already satisfied: websocket-client&lt;1,&gt;=0.32.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (0.59.0)
Requirement already satisfied: texttable&lt;2,&gt;=0.9.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (1.6.4)
Requirement already satisfied: jsonschema&lt;4,&gt;=2.5.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (3.2.0)
Requirement already satisfied: python-dotenv&lt;1,&gt;=0.13.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (0.20.0)
Requirement already satisfied: distro&lt;2,&gt;=1.5.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (1.7.0)
Requirement already satisfied: docopt&lt;1,&gt;=0.6.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (0.6.2)
Requirement already satisfied: requests&lt;3,&gt;=2.20.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker-compose==1.29.2-&gt;sagemaker[local]) (2.26.0)
Requirement already satisfied: botocore&lt;1.25.0,&gt;=1.24.42 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from boto3&lt;2.0,&gt;=1.20.21-&gt;sagemaker[local]) (1.24.46)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from boto3&lt;2.0,&gt;=1.20.21-&gt;sagemaker[local]) (0.10.0)
Requirement already satisfied: s3transfer&lt;0.6.0,&gt;=0.5.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from boto3&lt;2.0,&gt;=1.20.21-&gt;sagemaker[local]) (0.5.2)
Requirement already satisfied: zipp&gt;=0.5 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from importlib-metadata&lt;5.0,&gt;=1.4.0-&gt;sagemaker[local]) (3.6.0)
Requirement already satisfied: pyparsing!=3.0.5,&gt;=2.0.2 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from packaging&gt;=20.0-&gt;sagemaker[local]) (3.0.6)
Requirement already satisfied: six in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from protobuf3-to-dict&lt;1.0,&gt;=0.1.5-&gt;sagemaker[local]) (1.16.0)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pandas-&gt;sagemaker[local]) (2.8.2)
Requirement already satisfied: pytz&gt;=2017.3 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pandas-&gt;sagemaker[local]) (2021.3)
Requirement already satisfied: dill&gt;=0.3.4 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pathos-&gt;sagemaker[local]) (0.3.4)
Requirement already satisfied: pox&gt;=0.3.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pathos-&gt;sagemaker[local]) (0.3.0)
Requirement already satisfied: multiprocess&gt;=0.70.12 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pathos-&gt;sagemaker[local]) (0.70.12.2)
Requirement already satisfied: ppft&gt;=1.6.6.4 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from pathos-&gt;sagemaker[local]) (1.6.6.4)
Requirement already satisfied: paramiko&gt;=2.4.2 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from docker~=5.0.0-&gt;sagemaker[local]) (2.10.3)
Requirement already satisfied: pyrsistent&gt;=0.14.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from jsonschema&lt;4,&gt;=2.5.1-&gt;docker-compose==1.29.2-&gt;sagemaker[local]) (0.18.0)
Requirement already satisfied: setuptools in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from jsonschema&lt;4,&gt;=2.5.1-&gt;docker-compose==1.29.2-&gt;sagemaker[local]) (59.4.0)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from requests&lt;3,&gt;=2.20.0-&gt;docker-compose==1.29.2-&gt;sagemaker[local]) (3.1)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from requests&lt;3,&gt;=2.20.0-&gt;docker-compose==1.29.2-&gt;sagemaker[local]) (2021.10.8)
Requirement already satisfied: charset-normalizer~=2.0.0 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from requests&lt;3,&gt;=2.20.0-&gt;docker-compose==1.29.2-&gt;sagemaker[local]) (2.0.8)
Requirement already satisfied: bcrypt&gt;=3.1.3 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from paramiko&gt;=2.4.2-&gt;docker~=5.0.0-&gt;sagemaker[local]) (3.2.0)
Requirement already satisfied: pynacl&gt;=1.0.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from paramiko&gt;=2.4.2-&gt;docker~=5.0.0-&gt;sagemaker[local]) (1.5.0)
Requirement already satisfied: cryptography&gt;=2.5 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from paramiko&gt;=2.4.2-&gt;docker~=5.0.0-&gt;sagemaker[local]) (36.0.0)
Requirement already satisfied: cffi&gt;=1.1 in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from bcrypt&gt;=3.1.3-&gt;paramiko&gt;=2.4.2-&gt;docker~=5.0.0-&gt;sagemaker[local]) (1.15.0)
Requirement already satisfied: pycparser in /home/ec2-user/anaconda3/envs/python3/lib/python3.8/site-packages (from cffi&gt;=1.1-&gt;bcrypt&gt;=3.1.3-&gt;paramiko&gt;=2.4.2-&gt;docker~=5.0.0-&gt;sagemaker[local]) (2.21)
<span class="ansi-yellow-fg">WARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.
You should consider upgrading via the &#39;/home/ec2-user/anaconda3/envs/python3/bin/python -m pip install --upgrade pip&#39; command.</span><span class="ansi-yellow-fg">
</span></pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Instructions-for-SageMaker-Studio-environment">Instructions for SageMaker Studio environment<a class="anchor-link" href="#Instructions-for-SageMaker-Studio-environment"> </a></h4><p>Note that SageMaker local mode will not work in SageMaker Studio environment as it does not have docker service installed on instances.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-SageMaker-local-session">Create SageMaker local session<a class="anchor-link" href="#Create-SageMaker-local-session"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.local</span> <span class="kn">import</span> <span class="n">LocalSession</span>

<span class="n">session_local</span> <span class="o">=</span> <span class="n">LocalSession</span><span class="p">()</span>
<span class="n">session_local</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;sagemaker.local.local_session.LocalSession at 0x7f85747c6a30&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># configure local session</span>
<span class="n">session_local</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;local_code&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Prepare-SageMaker-training-script">Prepare SageMaker training script<a class="anchor-link" href="#Prepare-SageMaker-training-script"> </a></h1><p>We will call our training script <code>train_and_serve.py</code> and place it in our workspace under the <code>/src</code> folder. Then, we will start with a simple <code>Hello World</code> message code. After that, we will update and complete our training script as we learn more about the SageMaker <code>scikit-learn</code> container environment.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">script_file_name</span> <span class="o">=</span> <span class="s2">&quot;train_and_serve.py&quot;</span>
<span class="n">script_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">/src&quot;</span>
<span class="n">script_file</span> <span class="o">=</span> <span class="n">script_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">script_file_name</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;script_file_name: </span><span class="si">{</span><span class="n">script_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;script_path: </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;script_file: </span><span class="si">{</span><span class="n">script_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>script_file_name: train_and_serve.py
script_path: ./datasets/2022-07-07-sagemaker-script-mode/src
script_file: ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the training script.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*** Hello from the SageMaker script mode***&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Prepare-SageMaker-SKLearn-estimator">Prepare SageMaker SKLearn estimator<a class="anchor-link" href="#Prepare-SageMaker-SKLearn-estimator"> </a></h1><p>To use our <code>train_and_serve.py</code> script with SageMaker SKLearn estimator, we need to provide the following required items</p>
<ul>
<li><strong><code>entry_point (str)</code></strong> Path (absolute or relative) to the Python source file, which should be executed as the entry point to training. If source_dir is specified, then entry_point must point to a file located at the root of source_dir.</li>
<li><strong><code>framework_version (str)</code></strong> Scikit-learn version you want to use for executing your model training code.</li>
<li><strong><code>role (str)</code></strong> An AWS IAM role (either name or full ARN)</li>
<li><strong><code>instance_type (str)</code></strong> Type of instance to use for training. For local mode use string <strong><code>local</code></strong></li>
<li><strong><code>instance_count (int)</code></strong> Number of instances to use for training. Since we will train in the local environment and have a single instance, we will use '1' here.</li>
</ul>
<p>You can read more about the SKLearn Estimator class from the official documentation <a href="https://sagemaker.readthedocs.io/en/stable/frameworks/sklearn/sagemaker.sklearn.html">Scikit Learn Estimator</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's find the SKLearn framework version.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1.0.1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that version number <code>1.0.1</code> has to be provided to the SKLearn estimator class as <strong><code>1.0-1</code></strong>. Otherwise, you will get the following error message.</p>

<pre><code>ValueError: Unsupported sklearn version: 1.0.1. You may need to upgrade your SDK version (pip install -U sagemaker) for newer sklearn versions. Supported sklearn version(s): 0.20.0, 0.23-1, 1.0-1.</code></pre>
<p>Now let us create the SageMaker SKLearn estimator object and pass our training script to it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.sklearn</span> <span class="kn">import</span> <span class="n">SKLearn</span>

<span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating uws5uf81g1-algo-1-sboaf ... 
Creating uws5uf81g1-algo-1-sboaf ... done
Attaching to uws5uf81g1-algo-1-sboaf
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,717 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,722 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,731 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,886 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,899 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,912 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,922 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> Training Env:
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> {
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;channel_input_dirs&#34;: {},
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;current_host&#34;: &#34;algo-1-sboaf&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>         &#34;algo-1-sboaf&#34;
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     ],
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;hyperparameters&#34;: {},
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;input_data_config&#34;: {},
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-05-45-584&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;master_hostname&#34;: &#34;algo-1-sboaf&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-45-584/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>         &#34;current_host&#34;: &#34;algo-1-sboaf&#34;,
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>             &#34;algo-1-sboaf&#34;
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>         ]
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     },
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> }
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> Environment variables:
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_HOSTS=[&#34;algo-1-sboaf&#34;]
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_HPS={}
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-sboaf&#34;,&#34;hosts&#34;:[&#34;algo-1-sboaf&#34;]}
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_INPUT_DATA_CONFIG={}
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_CHANNELS=[]
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_CURRENT_HOST=algo-1-sboaf
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-45-584/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{},&#34;current_host&#34;:&#34;algo-1-sboaf&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-sboaf&#34;],&#34;hyperparameters&#34;:{},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-05-45-584&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-sboaf&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-45-584/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-sboaf&#34;,&#34;hosts&#34;:[&#34;algo-1-sboaf&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_USER_ARGS=[]
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> /miniconda3/bin/python train_and_serve.py
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> *** Hello from the SageMaker script mode***
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf |</span> 2022-07-13 13:05:47,950 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">uws5uf81g1-algo-1-sboaf exited with code 0
</span>Aborting on container exit...
===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When you first run the SKLearn estimator, executing it may take some time as it has to download the scikit-learn container to the local docker environment. You will get the container logs in the output when the container completes the execution. The logs show that the container has successfully run the training script, and the <code>hello</code> message is also printed. But there is a lot more information available in the logs. So in the coming section, we will discuss that.</p>
<p><img src="/myblog/images/copied_from_nb/images/2022-07-07-sagemaker-script-mode/sklearn-output-1.png" alt="sklearn-output-1"></p>
<h1 id="Understanding-SKLearn-container-output-and-environment-varaibles">Understanding SKLearn container output and environment varaibles<a class="anchor-link" href="#Understanding-SKLearn-container-output-and-environment-varaibles"> </a></h1><p>From the SKLearn estimator output, we can see that our <code>train_and_server.py</code> script is executed by the container with the following command.</p>

<pre><code>/miniconda3/bin/python train_and_server.py</code></pre>
<h2 id="Inspecting-SageMaker-SKLearn-docker-image">Inspecting SageMaker SKLearn docker image<a class="anchor-link" href="#Inspecting-SageMaker-SKLearn-docker-image"> </a></h2><p>Since the container was executed in the local environment, we can also inspect the SageMaker SKLearn local image.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>docker images
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>REPOSITORY                                                            TAG             IMAGE ID       CREATED       SIZE
683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn   1.0-1-cpu-py3   ff85d0034e62   5 weeks ago   3.63GB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's also inspect the docker image. Notice the multiple container environment variables and their default values.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>docker inspect ff85d0034e62
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[
    {
        &#34;Id&#34;: &#34;sha256:ff85d0034e624cce6f1114c32807437e2d5fd13b3593caeadb736db13bc7e2a8&#34;,
        &#34;RepoTags&#34;: [
            &#34;683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn:1.0-1-cpu-py3&#34;
        ],
        &#34;RepoDigests&#34;: [
            &#34;683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn@sha256:2ec1580756e6135455bcbcdff996c87bac72a0c8aa3bd924ff79372bd294f37a&#34;
        ],
        &#34;Parent&#34;: &#34;&#34;,
        &#34;Comment&#34;: &#34;&#34;,
        &#34;Created&#34;: &#34;2022-06-02T23:29:51.803646532Z&#34;,
        &#34;Container&#34;: &#34;24e79034ec0d3a22e1ef5059f99c18e3a496fd49beb41206560f5018de6f07f2&#34;,
        &#34;ContainerConfig&#34;: {
            &#34;Hostname&#34;: &#34;24e79034ec0d&#34;,
            &#34;Domainname&#34;: &#34;&#34;,
            &#34;User&#34;: &#34;&#34;,
            &#34;AttachStdin&#34;: false,
            &#34;AttachStdout&#34;: false,
            &#34;AttachStderr&#34;: false,
            &#34;ExposedPorts&#34;: {
                &#34;8080/tcp&#34;: {}
            },
            &#34;Tty&#34;: false,
            &#34;OpenStdin&#34;: false,
            &#34;StdinOnce&#34;: false,
            &#34;Env&#34;: [
                &#34;PATH=/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;,
                &#34;PYTHONDONTWRITEBYTECODE=1&#34;,
                &#34;PYTHONUNBUFFERED=1&#34;,
                &#34;PYTHONIOENCODING=UTF-8&#34;,
                &#34;LANG=C.UTF-8&#34;,
                &#34;LC_ALL=C.UTF-8&#34;,
                &#34;SAGEMAKER_SKLEARN_VERSION=1.0-1&#34;,
                &#34;SAGEMAKER_TRAINING_MODULE=sagemaker_sklearn_container.training:main&#34;,
                &#34;SAGEMAKER_SERVING_MODULE=sagemaker_sklearn_container.serving:main&#34;,
                &#34;SKLEARN_MMS_CONFIG=/home/model-server/config.properties&#34;,
                &#34;SM_INPUT=/opt/ml/input&#34;,
                &#34;SM_INPUT_TRAINING_CONFIG_FILE=/opt/ml/input/config/hyperparameters.json&#34;,
                &#34;SM_INPUT_DATA_CONFIG_FILE=/opt/ml/input/config/inputdataconfig.json&#34;,
                &#34;SM_CHECKPOINT_CONFIG_FILE=/opt/ml/input/config/checkpointconfig.json&#34;,
                &#34;SM_MODEL_DIR=/opt/ml/model&#34;,
                &#34;TEMP=/home/model-server/tmp&#34;
            ],
            &#34;Cmd&#34;: [
                &#34;/bin/sh&#34;,
                &#34;-c&#34;,
                &#34;#(nop) &#34;,
                &#34;LABEL transform_id=ad0946aa-4ca2-49f8-9952-dfd9be087cb0_sagemaker-scikit-learn-1_0&#34;
            ],
            &#34;Image&#34;: &#34;sha256:86938f6074c305d134f2bcdc30467bf73711ff8181f632c8044ab06ec3360984&#34;,
            &#34;Volumes&#34;: null,
            &#34;WorkingDir&#34;: &#34;&#34;,
            &#34;Entrypoint&#34;: null,
            &#34;OnBuild&#34;: null,
            &#34;Labels&#34;: {
                &#34;TRANSFORM_TYPE&#34;: &#34;Aggregate-1.0&#34;,
                &#34;VERSION_SET_NAME&#34;: &#34;SMFrameworksSKLearn/release-cdk&#34;,
                &#34;VERSION_SET_REVISION&#34;: &#34;6083519883&#34;,
                &#34;com.amazonaws.sagemaker.capabilities.accept-bind-to-port&#34;: &#34;true&#34;,
                &#34;com.amazonaws.sagemaker.capabilities.multi-models&#34;: &#34;true&#34;,
                &#34;transform_id&#34;: &#34;ad0946aa-4ca2-49f8-9952-dfd9be087cb0_sagemaker-scikit-learn-1_0&#34;
            }
        },
        &#34;DockerVersion&#34;: &#34;20.10.11&#34;,
        &#34;Author&#34;: &#34;&#34;,
        &#34;Config&#34;: {
            &#34;Hostname&#34;: &#34;&#34;,
            &#34;Domainname&#34;: &#34;&#34;,
            &#34;User&#34;: &#34;&#34;,
            &#34;AttachStdin&#34;: false,
            &#34;AttachStdout&#34;: false,
            &#34;AttachStderr&#34;: false,
            &#34;ExposedPorts&#34;: {
                &#34;8080/tcp&#34;: {}
            },
            &#34;Tty&#34;: false,
            &#34;OpenStdin&#34;: false,
            &#34;StdinOnce&#34;: false,
            &#34;Env&#34;: [
                &#34;PATH=/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;,
                &#34;PYTHONDONTWRITEBYTECODE=1&#34;,
                &#34;PYTHONUNBUFFERED=1&#34;,
                &#34;PYTHONIOENCODING=UTF-8&#34;,
                &#34;LANG=C.UTF-8&#34;,
                &#34;LC_ALL=C.UTF-8&#34;,
                &#34;SAGEMAKER_SKLEARN_VERSION=1.0-1&#34;,
                &#34;SAGEMAKER_TRAINING_MODULE=sagemaker_sklearn_container.training:main&#34;,
                &#34;SAGEMAKER_SERVING_MODULE=sagemaker_sklearn_container.serving:main&#34;,
                &#34;SKLEARN_MMS_CONFIG=/home/model-server/config.properties&#34;,
                &#34;SM_INPUT=/opt/ml/input&#34;,
                &#34;SM_INPUT_TRAINING_CONFIG_FILE=/opt/ml/input/config/hyperparameters.json&#34;,
                &#34;SM_INPUT_DATA_CONFIG_FILE=/opt/ml/input/config/inputdataconfig.json&#34;,
                &#34;SM_CHECKPOINT_CONFIG_FILE=/opt/ml/input/config/checkpointconfig.json&#34;,
                &#34;SM_MODEL_DIR=/opt/ml/model&#34;,
                &#34;TEMP=/home/model-server/tmp&#34;
            ],
            &#34;Cmd&#34;: [
                &#34;bash&#34;
            ],
            &#34;Image&#34;: &#34;sha256:86938f6074c305d134f2bcdc30467bf73711ff8181f632c8044ab06ec3360984&#34;,
            &#34;Volumes&#34;: null,
            &#34;WorkingDir&#34;: &#34;&#34;,
            &#34;Entrypoint&#34;: null,
            &#34;OnBuild&#34;: null,
            &#34;Labels&#34;: {
                &#34;TRANSFORM_TYPE&#34;: &#34;Aggregate-1.0&#34;,
                &#34;VERSION_SET_NAME&#34;: &#34;SMFrameworksSKLearn/release-cdk&#34;,
                &#34;VERSION_SET_REVISION&#34;: &#34;6083519883&#34;,
                &#34;com.amazonaws.sagemaker.capabilities.accept-bind-to-port&#34;: &#34;true&#34;,
                &#34;com.amazonaws.sagemaker.capabilities.multi-models&#34;: &#34;true&#34;,
                &#34;transform_id&#34;: &#34;ad0946aa-4ca2-49f8-9952-dfd9be087cb0_sagemaker-scikit-learn-1_0&#34;
            }
        },
        &#34;Architecture&#34;: &#34;amd64&#34;,
        &#34;Os&#34;: &#34;linux&#34;,
        &#34;Size&#34;: 3633153014,
        &#34;VirtualSize&#34;: 3633153014,
        &#34;GraphDriver&#34;: {
            &#34;Data&#34;: {
                &#34;LowerDir&#34;: &#34;/var/lib/docker/overlay2/ba43580e98522f6446e7e8c598a703e1b9d4402d348c882895a7b5b95a1566d6/diff:/var/lib/docker/overlay2/50a931ea97e482a3df2865dc9febfe9d66ce4a3eb13276ff4b98b8eca23f0c54/diff:/var/lib/docker/overlay2/4ee2abdd56b16502e59ba13afa7cd3c1e9d2f4a2a4dfca4f5d0f0a6c9c992c6f/diff:/var/lib/docker/overlay2/47c80d1ead4706a27636fbe20f358c87b4de2f1a9a7a37300db47d3dae28a487/diff:/var/lib/docker/overlay2/f2a6b5574fc15a12921526014d7a4162691adb93ab3bd9dada1cc64bd352f81f/diff:/var/lib/docker/overlay2/2b5977d59718be93248994ef216602a0665ac61956c835e1e79fda45424d7801/diff:/var/lib/docker/overlay2/e7fc0748fe6f1156af1aec9b26c43b77257e16bea097d57ff405e6c0de11f731/diff:/var/lib/docker/overlay2/a5d42940ebdef95c956d614d52ffd44a7d43a62744374f0eb83ff1d75f98637a/diff:/var/lib/docker/overlay2/b06cdff43faa546dec30bf1a44096d15336fd4efb5bd3c828a1c455784873578/diff:/var/lib/docker/overlay2/b5800ba058ba5bf79b5a434377d782132d625d8e7f082c60e46b0fdf9c709e36/diff:/var/lib/docker/overlay2/065338b19925092d20aaea802e5929e2c6bdfd0fdad08d170b74d49d7297b73d/diff:/var/lib/docker/overlay2/d8278fb7a7defdff2d4d6e9189ef46fd602d582c992e8faf6c405da50d35f583/diff:/var/lib/docker/overlay2/297d0dff1a65d2e6f8b3b9a2a8b61cb6003ee92e02c40cfb8cb41c41ffc5f656/diff:/var/lib/docker/overlay2/8f725a2f19d2d702ee0e14d9fef108f0898da19dc8f73102d6ee2df2f067ebcb/diff:/var/lib/docker/overlay2/836f3bf3e998ac88ba6aa93837e46c179e9165a2df5033f883a087d1e84472e8/diff:/var/lib/docker/overlay2/f6d6f1c038697949b761b6b9aca3b162cde671fc8be8a7dec3aacd93ee2b2a24/diff:/var/lib/docker/overlay2/99b502c354d5e45d665721d12e6769aab2569abc1f83f40d4c10c4f29ba83f93/diff&#34;,
                &#34;MergedDir&#34;: &#34;/var/lib/docker/overlay2/170b58f4a0e77fccd1ab733da2ab790b94ce89b949e89d22c7c5c9abb81302de/merged&#34;,
                &#34;UpperDir&#34;: &#34;/var/lib/docker/overlay2/170b58f4a0e77fccd1ab733da2ab790b94ce89b949e89d22c7c5c9abb81302de/diff&#34;,
                &#34;WorkDir&#34;: &#34;/var/lib/docker/overlay2/170b58f4a0e77fccd1ab733da2ab790b94ce89b949e89d22c7c5c9abb81302de/work&#34;
            },
            &#34;Name&#34;: &#34;overlay2&#34;
        },
        &#34;RootFS&#34;: {
            &#34;Type&#34;: &#34;layers&#34;,
            &#34;Layers&#34;: [
                &#34;sha256:1dc52a6b4de8561423dd3ec5a1f7f77f5309fd8cb340f80b8bc3d87fa112003e&#34;,
                &#34;sha256:99ca1a32584a06316ff1b48bb8ce664807566aa3017ef4b3dad53fd712f89de6&#34;,
                &#34;sha256:ed3fdfb46cd962aa39f6fb6c48e17f759f264cf338e153c5d4199f3bd3481bd0&#34;,
                &#34;sha256:787a104db1820509b4b8d20746d0b9df387498c8138a412ffc8fa698199118d8&#34;,
                &#34;sha256:68b766b62ca39331143f1d19dcaca6ebae2eebc1200fff1990a7ca47743be384&#34;,
                &#34;sha256:218bd4cc4fbdb5e30c78992d909cd556a4625d32a928970a697cc9e89d71846b&#34;,
                &#34;sha256:6ce2a9fe1d6ba9f9b9b4116b4ea8be89ffc2e7a14b9a886cce3534c83d69a313&#34;,
                &#34;sha256:68f522e62b787a7af4210caa9f1c16f9324cf94920c0e9a47eecd6baf744c123&#34;,
                &#34;sha256:9ddd41c83df357d4ac64043bcd27e338cb46047fef7e5c336fce8c7e603409a2&#34;,
                &#34;sha256:817e3a683251861369a12cb28add2f92104d34ed9e38e82213a1885815fe424f&#34;,
                &#34;sha256:d743afac96f62a3135874ee777eadf51cf5380a5c8017f60ab59123cd0e7e34e&#34;,
                &#34;sha256:b30a1fd61124bc41cb6431d6e228d0f7ba93e491777dd5b6b329de9b0e2677d7&#34;,
                &#34;sha256:99eb2741d927b6b109cd56edeb0787fb50b4df98d2fd39e3bd14edd25cbe5cfe&#34;,
                &#34;sha256:748916b673b3a238c9302c6146d0808e9116e6ae80a6a80b45dca8cf5a69d736&#34;,
                &#34;sha256:77fabbe5cc9110fa755db3ff256b41296ce839b2a49a37588bf7821a2e9667f6&#34;,
                &#34;sha256:33436664608d4569966290856ed7ecb5c4217717d22567db57435805e0798b3b&#34;,
                &#34;sha256:60a7b116599276fc04f16e84359319dacf4854e559c1a89d2688f6c384e9b3ce&#34;,
                &#34;sha256:82debf3a36033f35f4cb85c295a187ca0d84d47a3c4e01e4806ff8def7d25276&#34;
            ]
        },
        &#34;Metadata&#34;: {
            &#34;LastTagTime&#34;: &#34;0001-01-01T00:00:00Z&#34;
        }
    }
]
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pass-hyperparameters-to-SKLearn-estimator">Pass hyperparameters to SKLearn estimator<a class="anchor-link" href="#Pass-hyperparameters-to-SKLearn-estimator"> </a></h2><p>Let's pass some dummy hyperparameters to the estimator and see how it affects the output.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dummy_param_1&quot;</span><span class="p">:</span><span class="s2">&quot;val1&quot;</span><span class="p">,</span><span class="s2">&quot;dummy_param_2&quot;</span><span class="p">:</span><span class="s2">&quot;val2&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating vatky0ulv7-algo-1-79qnt ... 
Creating vatky0ulv7-algo-1-79qnt ... done
Attaching to vatky0ulv7-algo-1-79qnt
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:50,867 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:50,871 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:50,880 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:51,053 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:51,067 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:51,083 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:51,092 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> Training Env:
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> {
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;channel_input_dirs&#34;: {},
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;current_host&#34;: &#34;algo-1-79qnt&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         &#34;algo-1-79qnt&#34;
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     ],
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         &#34;dummy_param_1&#34;: &#34;val1&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         &#34;dummy_param_2&#34;: &#34;val2&#34;
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     },
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;input_data_config&#34;: {},
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-05-48-675&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;master_hostname&#34;: &#34;algo-1-79qnt&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-48-675/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         &#34;current_host&#34;: &#34;algo-1-79qnt&#34;,
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>             &#34;algo-1-79qnt&#34;
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>         ]
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     },
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> }
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> Environment variables:
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_HOSTS=[&#34;algo-1-79qnt&#34;]
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_HPS={&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;}
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-79qnt&#34;,&#34;hosts&#34;:[&#34;algo-1-79qnt&#34;]}
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_INPUT_DATA_CONFIG={}
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_CHANNELS=[]
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_CURRENT_HOST=algo-1-79qnt
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-48-675/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{},&#34;current_host&#34;:&#34;algo-1-79qnt&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-79qnt&#34;],&#34;hyperparameters&#34;:{&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-05-48-675&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-79qnt&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-48-675/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-79qnt&#34;,&#34;hosts&#34;:[&#34;algo-1-79qnt&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_USER_ARGS=[&#34;--dummy_param_1&#34;,&#34;val1&#34;,&#34;--dummy_param_2&#34;,&#34;val2&#34;]
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_HP_DUMMY_PARAM_1=val1
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> SM_HP_DUMMY_PARAM_2=val2
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> /miniconda3/bin/python train_and_serve.py --dummy_param_1 val1 --dummy_param_2 val2
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> *** Hello from the SageMaker script mode***
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt |</span> 2022-07-13 13:05:51,121 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">vatky0ulv7-algo-1-79qnt exited with code 0
</span>Aborting on container exit...
===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-07-07-sagemaker-script-mode/sklearn-output-hyperparams.png" alt="sklearn-output-hyperparams"></p>
<p>From the output we can see that our hyperparameters were passed to our training script as command line arguments. This is an important point and we will update our script using this information.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SageMaker-SKLearn-container-environment-variables">SageMaker SKLearn container environment variables<a class="anchor-link" href="#SageMaker-SKLearn-container-environment-variables"> </a></h2><p>Let's now discuss the essential environment variables we see in the output.</p>
<h3 id="SM_MODULE_DIR">SM_MODULE_DIR<a class="anchor-link" href="#SM_MODULE_DIR"> </a></h3>
<pre><code>SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-48-675/source/sourcedir.tar.gz</code></pre>
<p><code>SM_MODULE_DIR</code> points to a location in the S3 bucket where SageMaker will automatically backup our source code for that particular run. SageMaker will create a separate folder in the default bucket for each new run. The default value is <code>s3://sagemaker-{aws-region}-{aws-id}/{training-job-name}/source/sourcedir.tar.gz</code></p>
<h3 id="SM_MODEL_DIR">SM_MODEL_DIR<a class="anchor-link" href="#SM_MODEL_DIR"> </a></h3>
<pre><code>SM_MODEL_DIR=/opt/ml/model</code></pre>
<p><code>SM_MODEL_DIR</code> points to a directory located inside the container. When the training job finishes, the container and its file system will be deleted, except for the <code>/opt/ml/model</code> and <code>/opt/ml/output</code> directories. Use <code>/opt/ml/model</code> to save the trained model artifacts. These artifacts are uploaded to S3 for model hosting.</p>
<h3 id="SM_OUTPUT_DATA_DIR">SM_OUTPUT_DATA_DIR<a class="anchor-link" href="#SM_OUTPUT_DATA_DIR"> </a></h3>
<pre><code>SM_OUTPUT_DIR=/opt/ml/output</code></pre>
<p><code>SM_OUTPUT_DIR</code> points to a directory in the container to write output artifacts. Output artifacts may include checkpoints, graphs, and other files to save, not including model artifacts. These artifacts are compressed and uploaded to S3 to the same S3 prefix as the model artifacts.</p>
<h3 id="SM_CHANNELS">SM_CHANNELS<a class="anchor-link" href="#SM_CHANNELS"> </a></h3><p>From the SKLearn estimator output</p>

<pre><code>SM_CHANNELS='["testing","training"]'</code></pre>
<p>A channel is a named input source that training algorithms can consume. You can partition your training data into different logical "channels" when you run training. Depending on your problem, some common channel ideas are: "training", "testing", "evaluation" or "images" and "labels". You can read more about the channels from SageMaker API reference <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_Channel.html">Channel</a></p>
<h3 id="SMCHANNEL{channel_name}">SM<em>CHANNEL</em>{channel_name}<a class="anchor-link" href="#SMCHANNEL{channel_name}"> </a></h3>
<pre><code>SM_CHANNEL_TRAIN='/opt/ml/input/data/train'
SM_CHANNEL_TEST='/opt/ml/input/data/test'</code></pre>
<p>Supposing that you have passed two input channels, 'train' and 'test', to the Scikit-learn estimator's <code>fit()</code> method, the following will be set, following the format <code>SM_CHANNEL_[channel_name]</code>:</p>
<ul>
<li><strong><code>SM_CHANNEL_TRAIN</code></strong>: it points to the directory in the container that has the <em>train</em> channel data downloaded</li>
<li><strong><code>SM_CHANNEL_TEST</code></strong>: Same as above, but for the <em>test</em> channel</li>
</ul>
<p>Note that the channel names <code>train</code> and <code>test</code> are the conventions. Still, you can use any name here, and the environment variables will be created accordingly. It is important to know that the SageMaker container automatically downloads the data from the provided input channels and makes them available in the respective local directories once it starts executing. The training script can then load the data from the local container directories.</p>
<p>There are more environment variables available, and you can read about them from <a href="https://github.com/aws/sagemaker-training-toolkit/blob/master/ENVIRONMENT_VARIABLES.md">Environment variables</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Pass-input-channel-to-SKLearn-estimator">Pass input channel to SKLearn estimator<a class="anchor-link" href="#Pass-input-channel-to-SKLearn-estimator"> </a></h1><p>Now that we understand the SKLearn container environment more let's pass the training data channel to the estimator and see if the data becomes available inside the container directory.</p>
<p>Update our script to list all the files in the <code>SM_CHANNEL_TRAIN</code> directory.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file
<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; *** Hello from SageMaker script container *** &quot;</span><span class="p">)</span>

    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">)</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;training_dir files list: &quot;</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dummy_param_1&quot;</span><span class="p">:</span><span class="s2">&quot;val1&quot;</span><span class="p">,</span><span class="s2">&quot;dummy_param_2&quot;</span><span class="p">:</span><span class="s2">&quot;val2&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">local_train_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating ajvs4neawf-algo-1-vcoo5 ... 
Creating ajvs4neawf-algo-1-vcoo5 ... done
Attaching to ajvs4neawf-algo-1-vcoo5
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:53,961 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:53,966 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:53,975 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:54,165 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:54,179 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:54,193 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:54,202 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> Training Env:
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;channel_input_dirs&#34;: {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;train&#34;: &#34;/opt/ml/input/data/train&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     },
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;current_host&#34;: &#34;algo-1-vcoo5&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;algo-1-vcoo5&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     ],
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;dummy_param_1&#34;: &#34;val1&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;dummy_param_2&#34;: &#34;val2&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     },
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;input_data_config&#34;: {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;train&#34;: {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         }
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     },
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-05-51-514&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;master_hostname&#34;: &#34;algo-1-vcoo5&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-51-514/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;current_host&#34;: &#34;algo-1-vcoo5&#34;,
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>             &#34;algo-1-vcoo5&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>         ]
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     },
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> }
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> Environment variables:
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_HOSTS=[&#34;algo-1-vcoo5&#34;]
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_HPS={&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;}
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-vcoo5&#34;,&#34;hosts&#34;:[&#34;algo-1-vcoo5&#34;]}
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_INPUT_DATA_CONFIG={&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}}
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_CHANNELS=[&#34;train&#34;]
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_CURRENT_HOST=algo-1-vcoo5
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-51-514/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{&#34;train&#34;:&#34;/opt/ml/input/data/train&#34;},&#34;current_host&#34;:&#34;algo-1-vcoo5&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-vcoo5&#34;],&#34;hyperparameters&#34;:{&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-05-51-514&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-vcoo5&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-51-514/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-vcoo5&#34;,&#34;hosts&#34;:[&#34;algo-1-vcoo5&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_USER_ARGS=[&#34;--dummy_param_1&#34;,&#34;val1&#34;,&#34;--dummy_param_2&#34;,&#34;val2&#34;]
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_CHANNEL_TRAIN=/opt/ml/input/data/train
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_HP_DUMMY_PARAM_1=val1
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> SM_HP_DUMMY_PARAM_2=val2
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> /miniconda3/bin/python train_and_serve.py --dummy_param_1 val1 --dummy_param_2 val2
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span>  *** Hello from SageMaker script container *** 
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> training_dir files list:  [&#39;train.csv&#39;, &#39;.ipynb_checkpoints&#39;]
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 |</span> 2022-07-13 13:05:54,246 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">ajvs4neawf-algo-1-vcoo5 exited with code 0
</span>Aborting on container exit...
===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>[image here]</strong>
From the output, we can see that <code>train.csv</code>, which was in our local environment, is now available inside the container on path <code>SM_CHANNEL_TRAIN=/opt/ml/input/data/train</code>.</p>
<p>Let's also test the same with our training data on the S3 bucket.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dummy_param_1&quot;</span><span class="p">:</span><span class="s2">&quot;val1&quot;</span><span class="p">,</span><span class="s2">&quot;dummy_param_2&quot;</span><span class="p">:</span><span class="s2">&quot;val2&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating ej721wg4x0-algo-1-4b1nb ... 
Creating ej721wg4x0-algo-1-4b1nb ... done
Attaching to ej721wg4x0-algo-1-4b1nb
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:56,826 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:56,833 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:56,842 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:57,027 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:57,041 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:57,054 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:57,063 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> Training Env:
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;channel_input_dirs&#34;: {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;train&#34;: &#34;/opt/ml/input/data/train&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     },
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;current_host&#34;: &#34;algo-1-4b1nb&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;algo-1-4b1nb&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     ],
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;dummy_param_1&#34;: &#34;val1&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;dummy_param_2&#34;: &#34;val2&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     },
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;input_data_config&#34;: {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;train&#34;: {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         }
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     },
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-05-54-602&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;master_hostname&#34;: &#34;algo-1-4b1nb&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-54-602/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;current_host&#34;: &#34;algo-1-4b1nb&#34;,
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>             &#34;algo-1-4b1nb&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>         ]
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     },
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> }
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> Environment variables:
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_HOSTS=[&#34;algo-1-4b1nb&#34;]
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_HPS={&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;}
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-4b1nb&#34;,&#34;hosts&#34;:[&#34;algo-1-4b1nb&#34;]}
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_INPUT_DATA_CONFIG={&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}}
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_CHANNELS=[&#34;train&#34;]
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_CURRENT_HOST=algo-1-4b1nb
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-54-602/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{&#34;train&#34;:&#34;/opt/ml/input/data/train&#34;},&#34;current_host&#34;:&#34;algo-1-4b1nb&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-4b1nb&#34;],&#34;hyperparameters&#34;:{&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-05-54-602&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-4b1nb&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-54-602/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-4b1nb&#34;,&#34;hosts&#34;:[&#34;algo-1-4b1nb&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_USER_ARGS=[&#34;--dummy_param_1&#34;,&#34;val1&#34;,&#34;--dummy_param_2&#34;,&#34;val2&#34;]
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_CHANNEL_TRAIN=/opt/ml/input/data/train
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_HP_DUMMY_PARAM_1=val1
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> SM_HP_DUMMY_PARAM_2=val2
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> /miniconda3/bin/python train_and_serve.py --dummy_param_1 val1 --dummy_param_2 val2
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span>  *** Hello from SageMaker script container *** 
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> training_dir files list:  [&#39;train.csv&#39;]
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb |</span> 2022-07-13 13:05:57,104 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">ej721wg4x0-algo-1-4b1nb exited with code 0
</span>Aborting on container exit...
===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again the results are the same. SageMaker will download the data from the S3 bucket and make it available in the container. In the environment variables section we also learned that two directories are special <code>/opt/ml/model</code> and <code>/opt/ml/output</code>. Container environment variables <code>SM_MODEL_DIR</code> and <code>SM_OUTPUT_DATA_DIR</code> point to them, respectively. Whatever artifacts we put on them will be stored on the S3 bucket when the training job finishes. "SM_MODEL_DIR" is for trained models, and "SM_OUTPUT_DATA_DIR" is for other artifacts like logs, graphs, plots, resutls, etc. Let's update our training script and put some dummy data in these directories. Once the job is complete, we will verify the stored artifacts on the S3 bucket.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file
<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; *** Hello from SageMaker script container *** &quot;</span><span class="p">)</span>

    <span class="c1"># list files in SM_CHANNEL_TRAIN</span>
    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">)</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;training_dir files list: &quot;</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>

    <span class="c1"># write dummy model file to SM_MODEL_DIR</span>
    <span class="n">sm_model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_MODEL_DIR&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">/dummy-model.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;this is a dummy model&quot;</span><span class="p">)</span>

    <span class="c1"># write dummy artifact file to SM_OUTPUT_DATA_DIR</span>
    <span class="n">sm_output_data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_OUTPUT_DATA_DIR&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sm_output_data_dir</span><span class="si">}</span><span class="s2">/dummy-output-data.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;this is a dummy output data&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dummy_param_1&quot;</span><span class="p">:</span><span class="s2">&quot;val1&quot;</span><span class="p">,</span><span class="s2">&quot;dummy_param_2&quot;</span><span class="p">:</span><span class="s2">&quot;val2&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating 7kxyzpqlld-algo-1-w41kb ... 
Creating 7kxyzpqlld-algo-1-w41kb ... done
Attaching to 7kxyzpqlld-algo-1-w41kb
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:05:59,899 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:05:59,903 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:05:59,913 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:06:00,115 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:06:00,129 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:06:00,142 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:06:00,151 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> Training Env:
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;channel_input_dirs&#34;: {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;train&#34;: &#34;/opt/ml/input/data/train&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     },
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;current_host&#34;: &#34;algo-1-w41kb&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;algo-1-w41kb&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     ],
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;dummy_param_1&#34;: &#34;val1&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;dummy_param_2&#34;: &#34;val2&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     },
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;input_data_config&#34;: {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;train&#34;: {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         }
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     },
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-05-57-790&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;master_hostname&#34;: &#34;algo-1-w41kb&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;current_host&#34;: &#34;algo-1-w41kb&#34;,
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>             &#34;algo-1-w41kb&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>         ]
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     },
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> }
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> Environment variables:
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_HOSTS=[&#34;algo-1-w41kb&#34;]
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_HPS={&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;}
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-w41kb&#34;,&#34;hosts&#34;:[&#34;algo-1-w41kb&#34;]}
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_INPUT_DATA_CONFIG={&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}}
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_CHANNELS=[&#34;train&#34;]
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_CURRENT_HOST=algo-1-w41kb
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{&#34;train&#34;:&#34;/opt/ml/input/data/train&#34;},&#34;current_host&#34;:&#34;algo-1-w41kb&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-w41kb&#34;],&#34;hyperparameters&#34;:{&#34;dummy_param_1&#34;:&#34;val1&#34;,&#34;dummy_param_2&#34;:&#34;val2&#34;},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-05-57-790&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-w41kb&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-w41kb&#34;,&#34;hosts&#34;:[&#34;algo-1-w41kb&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_USER_ARGS=[&#34;--dummy_param_1&#34;,&#34;val1&#34;,&#34;--dummy_param_2&#34;,&#34;val2&#34;]
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_CHANNEL_TRAIN=/opt/ml/input/data/train
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_HP_DUMMY_PARAM_1=val1
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> SM_HP_DUMMY_PARAM_2=val2
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> /miniconda3/bin/python train_and_serve.py --dummy_param_1 val1 --dummy_param_2 val2
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span>  *** Hello from SageMaker script container *** 
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> training_dir files list:  [&#39;train.csv&#39;]
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb |</span> 2022-07-13 13:06:00,192 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">7kxyzpqlld-algo-1-w41kb exited with code 0
</span>Aborting on container exit...
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Failed to delete: /tmp/tmpgsc_yr3n/algo-1-w41kb Please remove it manually.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our training job is now complete. Let us check the S3 bucket to see if our dummy model and other artifacts are present.</p>
<p>First, we need the S3 URI for these artifacts. For our dummy model (from SM_MODEL_DIR), we can use our estimator object to get the URI. Let's call it <code>model_data</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_data</span> <span class="o">=</span> <span class="n">sk_estimator</span><span class="o">.</span><span class="n">model_data</span>
<span class="n">model_data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/model.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>model_data</code> from S3 will be downloaded to a local directory for verification. Let's create a local <code>tmp</code> to store these downloaded files.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">local_tmp_path</span> <span class="o">=</span> <span class="n">local_path</span> <span class="o">+</span> <span class="s2">&quot;/tmp&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">local_tmp_path</span><span class="p">)</span>

<span class="c1"># create the local &#39;/tmp&#39; directory</span>
<span class="n">Path</span><span class="p">(</span><span class="n">local_tmp_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;./datasets/2022-07-07-sagemaker-script-mode/model&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use SageMaker <code>S3Downloader</code> object to download the model file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sagemaker.s3</span> <span class="kn">import</span> <span class="n">S3Downloader</span>

<span class="n">S3Downloader</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
    <span class="n">s3_uri</span><span class="o">=</span><span class="n">model_data</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="n">local_tmp_path</span><span class="p">,</span> <span class="n">sagemaker_session</span><span class="o">=</span><span class="n">session</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>File is downloaded. Let's uncompress it to verify the model file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tar -xzvf <span class="nv">$local_model_path</span>/model.tar.gz -C <span class="nv">$local_tmp_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dummy-model.txt
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Yes, the "dummy-model.txt" file is present. This tells us that SageMaker will automatically upload the files from the model directory (SM_MODEL_DIR) to the S3 bucket. Let's do the same for the output data directory (SM_OUTPUT_DATA_DIR). There is no direct way to get the S3 URI from the estimator object for the output data directory. But we can prepare it ourselves. So let's do that next.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimator.output_path: &quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimator.latest_training_job.name: &quot;</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">latest_training_job</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_s3_output_uri</span><span class="p">(</span><span class="n">estimator</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">estimator</span><span class="o">.</span><span class="n">output_path</span> <span class="o">+</span> <span class="n">estimator</span><span class="o">.</span><span class="n">latest_training_job</span><span class="o">.</span><span class="n">name</span>
    
<span class="n">get_s3_output_uri</span><span class="p">(</span><span class="n">sk_estimator</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># S3 URI for output data artifacts</span>
<span class="n">s3_output_uri</span> <span class="o">=</span> <span class="n">get_s3_output_uri</span><span class="p">(</span><span class="n">sk_estimator</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/output.tar.gz&#39;</span>
<span class="n">s3_output_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/output.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># S3 URI for model artifact. We have already veirifed it.</span>
<span class="n">s3_model_uri</span> <span class="o">=</span> <span class="n">get_s3_output_uri</span><span class="p">(</span><span class="n">sk_estimator</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/model.tar.gz&#39;</span>
<span class="n">s3_model_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/model.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># S3 URI for source code</span>
<span class="n">s3_source_uri</span>  <span class="n">get_s3_output_uri</span><span class="p">(</span><span class="n">sk_estimator</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/source/sourcedir.tar.gz&#39;</span>
<span class="n">s3_source_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-05-57-790/source/sourcedir.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's download these artifacts to our local '/tmp' directory for verification.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws s3 cp <span class="nv">$s3_output_uri</span> <span class="nv">$local_tmp_path</span>
<span class="o">!</span>aws s3 cp <span class="nv">$s3_source_uri</span> <span class="nv">$local_tmp_path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># extract the output data files from &#39;output.tar.gz&#39;</span>
<span class="o">!</span>tar -xzvf <span class="nv">$local_tmp_path</span>/output.tar.gz -C <span class="nv">$local_tmp_path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># extract the source code files from &#39;sourcedir.tar.gz&#39;</span>
<span class="o">!</span>tar -xzvf <span class="nv">$local_tmp_path</span>/sourcedir.tar.gz -C <span class="nv">$local_tmp_path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Summary-till-now">Summary till now<a class="anchor-link" href="#Summary-till-now"> </a></h1><p>Let's summarize what we have learned till now.</p>
<ul>
<li>We can use SageMaker SKLearn local mode to test our code in a local environment</li>
<li>SKLearn container executes our provided script with the command <code>/miniconda3/bin/python train_and_server.py</code></li>
<li>Hyperparameters passed to the container are passed to our script as command line arguments</li>
<li>Data from input channels will be downloaded by the container and made available for our script to load and process</li>
<li>'/opt/ml/model' and '/opt/ml/output' directories are special. Anything stored on them will be automatically backed up on the S3 bucket when the job finishes. These directories are defined in the container environment variables 'SM_MODEL_DIR' and 'SM_OUTPUT_DATA_DIR', respectively. SM_MODEL_DIR should be used to write model artifacts. SM_OUTPUT_DATA_DIR should be used to write any other supporting artifact.</li>
</ul>
<p>Let's use this knowledge to update our script to train a RandomForrestClassifier on the Iris flower dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm -r <span class="nv">$local_tmp_path</span>/*
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file


<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Pass in environment variables and hyperparameters</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="c1"># Hyperparameters</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--estimators&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># sm_model_dir: model artifacts stored here after training</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-model-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_MODEL_DIR&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-channel-train&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-channel-test&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TEST&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-output-data-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_OUTPUT_DATA_DIR&quot;</span><span class="p">))</span>
    
    <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;command line arguments: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    
    <span class="n">estimators</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">estimators</span>
    <span class="n">sm_model_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_model_dir</span>
    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_channel_train</span>
    <span class="n">testing_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_channel_test</span>
    <span class="n">output_data_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_output_data_dir</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir: </span><span class="si">{</span><span class="n">training_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir files list</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;testing_dir: </span><span class="si">{</span><span class="n">testing_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print testing_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;testing_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">testing_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print testing_dir files list</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_data_dir: </span><span class="si">{</span><span class="n">output_data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    
    <span class="c1"># Read in data</span>
    <span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">training_dir</span> <span class="o">+</span> <span class="s2">&quot;/train.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">testing_dir</span> <span class="o">+</span> <span class="s2">&quot;/test.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="c1"># Preprocess data</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train.shape: </span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train.shape: </span><span class="si">{</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train.shape: </span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train.shape: </span><span class="si">{</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Build model</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">estimators</span><span class="p">)</span>
    <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Save the model</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">sm_model_dir</span><span class="o">+</span><span class="s2">&quot;/model.joblib&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save the results</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_data_dir</span><span class="o">+</span><span class="s2">&quot;/y_pred.csv&quot;</span><span class="p">)</span>
    
    <span class="c1"># print sm_model_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir files list</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>chmod +x <span class="nv">$script_file</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm -r <span class="nv">$local_model_path</span>/*
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 <span class="nv">$script_file</span> <span class="err">\</span>
    <span class="o">--</span><span class="n">sm</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="nb">dir</span> <span class="err">$</span><span class="n">local_model_path</span> \
    <span class="o">--</span><span class="n">sm</span><span class="o">-</span><span class="n">channel</span><span class="o">-</span><span class="n">train</span> <span class="err">$</span><span class="n">local_train_path</span> \
    <span class="o">--</span><span class="n">sm</span><span class="o">-</span><span class="n">channel</span><span class="o">-</span><span class="n">test</span> <span class="err">$</span><span class="n">local_test_path</span> \
    <span class="o">--</span><span class="n">sm</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="nb">dir</span> <span class="err">$</span><span class="n">local_output_data_path</span> \
    <span class="o">--</span><span class="n">estimators</span> <span class="mi">10</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>command line arguments:  Namespace(estimators=10, sm_channel_test=&#39;./datasets/2022-07-07-sagemaker-script-mode/test&#39;, sm_channel_train=&#39;./datasets/2022-07-07-sagemaker-script-mode/train&#39;, sm_model_dir=&#39;./datasets/2022-07-07-sagemaker-script-mode/model&#39;, sm_output_data_dir=&#39;./datasets/2022-07-07-sagemaker-script-mode/output/data&#39;)
training_dir: ./datasets/2022-07-07-sagemaker-script-mode/train
training_dir files list: [&#39;train.csv&#39;, &#39;.ipynb_checkpoints&#39;]
testing_dir: ./datasets/2022-07-07-sagemaker-script-mode/test
testing_dir files list: [&#39;.ipynb_checkpoints&#39;, &#39;test.csv&#39;]
sm_model_dir: ./datasets/2022-07-07-sagemaker-script-mode/model
output_data_dir: ./datasets/2022-07-07-sagemaker-script-mode/output/data
X_train.shape: (120, 4)
y_train.shape: (120,)
X_train.shape: (30, 4)
y_train.shape: (30,)
sm_model_dir: ./datasets/2022-07-07-sagemaker-script-mode/model
sm_model_dir files list: [&#39;.ipynb_checkpoints&#39;, &#39;model.joblib&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">local_model_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;./datasets/2022-07-07-sagemaker-script-mode/model&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;estimators&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Train the estimator</span>
<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">s3_test_uri</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating 0b3yb3qvjt-algo-1-n90bz ... 
Creating 0b3yb3qvjt-algo-1-n90bz ... done
Attaching to 0b3yb3qvjt-algo-1-n90bz
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,304 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,308 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,317 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,498 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,512 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,525 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:06,534 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> Training Env:
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;channel_input_dirs&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;train&#34;: &#34;/opt/ml/input/data/train&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;test&#34;: &#34;/opt/ml/input/data/test&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     },
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;current_host&#34;: &#34;algo-1-n90bz&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;algo-1-n90bz&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     ],
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;estimators&#34;: 10
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     },
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;input_data_config&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;train&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         },
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;test&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         }
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     },
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-06-03-671&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;master_hostname&#34;: &#34;algo-1-n90bz&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;current_host&#34;: &#34;algo-1-n90bz&#34;,
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>             &#34;algo-1-n90bz&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>         ]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     },
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> }
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> Environment variables:
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_HOSTS=[&#34;algo-1-n90bz&#34;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_HPS={&#34;estimators&#34;:10}
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-n90bz&#34;,&#34;hosts&#34;:[&#34;algo-1-n90bz&#34;]}
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_INPUT_DATA_CONFIG={&#34;test&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;},&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}}
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_CHANNELS=[&#34;test&#34;,&#34;train&#34;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_CURRENT_HOST=algo-1-n90bz
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{&#34;test&#34;:&#34;/opt/ml/input/data/test&#34;,&#34;train&#34;:&#34;/opt/ml/input/data/train&#34;},&#34;current_host&#34;:&#34;algo-1-n90bz&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-n90bz&#34;],&#34;hyperparameters&#34;:{&#34;estimators&#34;:10},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{&#34;test&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;},&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-06-03-671&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-n90bz&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-n90bz&#34;,&#34;hosts&#34;:[&#34;algo-1-n90bz&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_USER_ARGS=[&#34;--estimators&#34;,&#34;10&#34;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_CHANNEL_TRAIN=/opt/ml/input/data/train
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_CHANNEL_TEST=/opt/ml/input/data/test
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> SM_HP_ESTIMATORS=10
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> /miniconda3/bin/python train_and_serve.py --estimators 10
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> command line arguments:  Namespace(estimators=10, sm_channel_test=&#39;/opt/ml/input/data/test&#39;, sm_channel_train=&#39;/opt/ml/input/data/train&#39;, sm_model_dir=&#39;/opt/ml/model&#39;, sm_output_data_dir=&#39;/opt/ml/output/data&#39;)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> training_dir: /opt/ml/input/data/train
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> training_dir files list: [&#39;train.csv&#39;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> testing_dir: /opt/ml/input/data/test
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> testing_dir files list: [&#39;test.csv&#39;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> sm_model_dir: /opt/ml/model
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> output_data_dir: /opt/ml/output/data
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> X_train.shape: (120, 4)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> y_train.shape: (120,)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> X_train.shape: (30, 4)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> y_train.shape: (30,)
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> sm_model_dir: /opt/ml/model
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> sm_model_dir files list: [&#39;model.joblib&#39;]
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz |</span> 2022-07-13 13:06:07,727 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">0b3yb3qvjt-algo-1-n90bz exited with code 0
</span>Aborting on container exit...
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Failed to delete: /tmp/tmp5kv1g_u7/algo-1-n90bz Please remove it manually.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span><span class="o">.</span><span class="n">model_data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/model.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_output_uri</span> <span class="o">=</span> <span class="n">get_s3_output_uri</span><span class="p">(</span><span class="n">sk_estimator</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/output.tar.gz&#39;</span>
<span class="n">s3_output_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/output.tar.gz&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">local_output_data_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;./datasets/2022-07-07-sagemaker-script-mode/output/data&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">local_output_data_path</span><span class="p">)</span>

<span class="o">!</span>rm -r <span class="nv">$local_output_data_path</span>/*
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>./datasets/2022-07-07-sagemaker-script-mode/output/data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws s3 cp <span class="nv">$s3_output_uri</span> <span class="nv">$local_output_data_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>download: s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-06-03-671/output.tar.gz to datasets/2022-07-07-sagemaker-script-mode/output/data/output.tar.gz
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tar -xzvf <span class="nv">$local_output_data_path</span>/output.tar.gz -C <span class="nv">$local_output_data_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>data/
data/y_pred.csv
success
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># create </span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">custom_library_path</span> <span class="o">=</span> <span class="n">local_path</span><span class="o">+</span><span class="s2">&quot;/my_custom_library&quot;</span>
<span class="n">custom_library_file</span> <span class="o">=</span> <span class="n">custom_library_path</span><span class="o">+</span><span class="s2">&quot;/seaborn_confusion_matrix.py&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;custom_library_path: </span><span class="si">{</span><span class="n">custom_library_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;custom_library_file: </span><span class="si">{</span><span class="n">custom_library_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>custom_library_path: ./datasets/2022-07-07-sagemaker-script-mode/my_custom_library
custom_library_file: ./datasets/2022-07-07-sagemaker-script-mode/my_custom_library/seaborn_confusion_matrix.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="p">(</span><span class="n">custom_library_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $custom_library_file

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">save_confusion_matrix</span><span class="p">(</span><span class="n">cf_matrix</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
    <span class="n">sns_plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cf_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns_plot</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/output_cm.png&quot;</span><span class="p">)</span>
    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--path&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">)</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">path</span>
    
    <span class="n">dummy_cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">23</span><span class="p">,</span>  <span class="mi">5</span><span class="p">],[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">]])</span>
    <span class="n">save_confusion_matrix</span><span class="p">(</span><span class="n">dummy_cm</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/my_custom_library/seaborn_confusion_matrix.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $custom_library_path/__init__.py

<span class="kn">from</span> <span class="nn">.seaborn_confusion_matrix</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/my_custom_library/__init__.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python3 <span class="nv">$custom_library_file</span> --path <span class="nv">$local_output_data_path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file


<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="kn">from</span> <span class="nn">my_custom_library</span> <span class="kn">import</span> <span class="n">save_confusion_matrix</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Pass in environment variables and hyperparameters</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="c1"># Hyperparameters</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--estimators&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># sm_model_dir: model artifacts stored here after training</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-model-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_MODEL_DIR&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-channel-train&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-channel-test&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TEST&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-output-data-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_OUTPUT_DATA_DIR&quot;</span><span class="p">))</span>
    
    <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;command line arguments: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    
    <span class="n">estimators</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">estimators</span>
    <span class="n">sm_model_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_model_dir</span>
    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_channel_train</span>
    <span class="n">testing_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_channel_test</span>
    <span class="n">output_data_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_output_data_dir</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir: </span><span class="si">{</span><span class="n">training_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir files list</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;testing_dir: </span><span class="si">{</span><span class="n">testing_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print testing_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;testing_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">testing_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print testing_dir files list</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_data_dir: </span><span class="si">{</span><span class="n">output_data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    
    <span class="c1"># Read in data</span>
    <span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">training_dir</span> <span class="o">+</span> <span class="s2">&quot;/train.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">testing_dir</span> <span class="o">+</span> <span class="s2">&quot;/test.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="c1"># Preprocess data</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train.shape: </span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train.shape: </span><span class="si">{</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train.shape: </span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train.shape: </span><span class="si">{</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Build model</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">estimators</span><span class="p">)</span>
    <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Save the model</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">sm_model_dir</span><span class="o">+</span><span class="s2">&quot;/model.joblib&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save the results</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_data_dir</span><span class="o">+</span><span class="s2">&quot;/y_pred.csv&quot;</span><span class="p">)</span>
    
    <span class="c1"># save the confusion matrix</span>
    <span class="n">cf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">save_confusion_matrix</span><span class="p">(</span><span class="n">cf_matrix</span><span class="p">,</span> <span class="n">output_data_dir</span><span class="p">)</span>
    
    <span class="c1"># print sm_model_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir files list</span>
    
    <span class="c1"># print output_data_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_data_dir: </span><span class="si">{</span><span class="n">output_data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_data_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_data_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir files list</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/train_and_serve.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">script_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;./datasets/2022-07-07-sagemaker-script-mode/src&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_path/requirements.txt

<span class="n">matplotlib</span><span class="o">==</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span>
<span class="n">seaborn</span><span class="o">==</span><span class="mf">0.11</span><span class="o">.</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting ./datasets/2022-07-07-sagemaker-script-mode/src/requirements.txt
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file_name</span><span class="p">,</span>
    <span class="n">source_dir</span><span class="o">=</span><span class="n">script_path</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">custom_library_path</span><span class="p">],</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;estimators&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Train the estimator</span>
<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">s3_test_uri</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating 96mwnip853-algo-1-gcn8f ... 
Creating 96mwnip853-algo-1-gcn8f ... done
Attaching to 96mwnip853-algo-1-gcn8f
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:46,389 sagemaker-containers INFO     Imported framework sagemaker_sklearn_container.training
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:46,393 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:46,403 sagemaker_sklearn_container.training INFO     Invoking user training script.
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:46,574 sagemaker-training-toolkit INFO     Installing dependencies from requirements.txt:
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> /miniconda3/bin/python -m pip install -r requirements.txt
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting matplotlib==3.5.2
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading matplotlib-3.5.2-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.whl (11.3 MB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">11.3/11.3 MB</span> <span class="ansi-red-fg">98.0 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>00:0100:01:--:--
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting seaborn==0.11.2
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading seaborn-0.11.2-py3-none-any.whl (292 kB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">292.8/292.8 kB</span> <span class="ansi-red-fg">51.8 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>31m? eta <span class="ansi-cyan-fg">-:--:--</span>
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting pyparsing&gt;=2.2.1
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading pyparsing-3.0.9-py3-none-any.whl (98 kB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">98.3/98.3 kB</span> <span class="ansi-red-fg">24.3 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>1m? eta <span class="ansi-cyan-fg">-:--:--</span>
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: pillow&gt;=6.2.0 in /miniconda3/lib/python3.8/site-packages (from matplotlib==3.5.2-&gt;-r requirements.txt (line 2)) (9.1.1)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: python-dateutil&gt;=2.7 in /miniconda3/lib/python3.8/site-packages (from matplotlib==3.5.2-&gt;-r requirements.txt (line 2)) (2.8.1)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting cycler&gt;=0.10
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading cycler-0.11.0-py3-none-any.whl (6.4 kB)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: numpy&gt;=1.17 in /miniconda3/lib/python3.8/site-packages (from matplotlib==3.5.2-&gt;-r requirements.txt (line 2)) (1.21.0)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting packaging&gt;=20.0
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading packaging-21.3-py3-none-any.whl (40 kB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">40.8/40.8 kB</span> <span class="ansi-red-fg">11.4 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>1m? eta <span class="ansi-cyan-fg">-:--:--</span>
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting kiwisolver&gt;=1.0.1
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading kiwisolver-1.4.3-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.whl (1.2 MB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">1.2/1.2 MB</span> <span class="ansi-red-fg">93.6 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>31m? eta <span class="ansi-cyan-fg">-:--:--</span>
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Collecting fonttools&gt;=4.22.0
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>   Downloading fonttools-4.34.4-py3-none-any.whl (944 kB)
     <span class="ansi-black-intense-fg"></span> <span class="ansi-green-fg">944.1/944.1 kB</span> <span class="ansi-red-fg">11.6 MB/s</span> eta <span class="ansi-cyan-fg">0:00:00</span>00:01eta <span class="ansi-cyan-fg">-:--:--</span>
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: scipy&gt;=1.0 in /miniconda3/lib/python3.8/site-packages (from seaborn==0.11.2-&gt;-r requirements.txt (line 3)) (1.5.3)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: pandas&gt;=0.23 in /miniconda3/lib/python3.8/site-packages (from seaborn==0.11.2-&gt;-r requirements.txt (line 3)) (1.1.3)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: pytz&gt;=2017.2 in /miniconda3/lib/python3.8/site-packages (from pandas&gt;=0.23-&gt;seaborn==0.11.2-&gt;-r requirements.txt (line 3)) (2022.1)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Requirement already satisfied: six&gt;=1.5 in /miniconda3/lib/python3.8/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib==3.5.2-&gt;-r requirements.txt (line 2)) (1.15.0)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Installing collected packages: pyparsing, kiwisolver, fonttools, cycler, packaging, matplotlib, seaborn
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Successfully installed cycler-0.11.0 fonttools-4.34.4 kiwisolver-1.4.3 matplotlib-3.5.2 packaging-21.3 pyparsing-3.0.9 seaborn-0.11.2
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> <span class="ansi-yellow-fg">WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span><span class="ansi-yellow-fg">
</span><span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:51,183 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:51,197 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:51,210 sagemaker-training-toolkit INFO     No GPUs detected (normal if no gpus installed)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:51,219 sagemaker-training-toolkit INFO     Invoking user script
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Training Env:
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;additional_framework_parameters&#34;: {},
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;channel_input_dirs&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;train&#34;: &#34;/opt/ml/input/data/train&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;test&#34;: &#34;/opt/ml/input/data/test&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     },
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;current_host&#34;: &#34;algo-1-gcn8f&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;framework_module&#34;: &#34;sagemaker_sklearn_container.training:main&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;hosts&#34;: [
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;algo-1-gcn8f&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     ],
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;hyperparameters&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;estimators&#34;: 10
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     },
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;input_config_dir&#34;: &#34;/opt/ml/input/config&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;input_data_config&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;train&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         },
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;test&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>             &#34;TrainingInputMode&#34;: &#34;File&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         }
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     },
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;input_dir&#34;: &#34;/opt/ml/input&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;is_master&#34;: true,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;job_name&#34;: &#34;sagemaker-scikit-learn-2022-07-13-13-07-43-761&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;log_level&#34;: 20,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;master_hostname&#34;: &#34;algo-1-gcn8f&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;model_dir&#34;: &#34;/opt/ml/model&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;module_dir&#34;: &#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-07-43-761/source/sourcedir.tar.gz&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;module_name&#34;: &#34;train_and_serve&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;network_interface_name&#34;: &#34;eth0&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;num_cpus&#34;: 2,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;num_gpus&#34;: 0,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;output_data_dir&#34;: &#34;/opt/ml/output/data&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;output_dir&#34;: &#34;/opt/ml/output&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;output_intermediate_dir&#34;: &#34;/opt/ml/output/intermediate&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;resource_config&#34;: {
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;current_host&#34;: &#34;algo-1-gcn8f&#34;,
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         &#34;hosts&#34;: [
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>             &#34;algo-1-gcn8f&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>         ]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     },
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span>     &#34;user_entry_point&#34;: &#34;train_and_serve.py&#34;
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> }
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Environment variables:
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_HOSTS=[&#34;algo-1-gcn8f&#34;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_NETWORK_INTERFACE_NAME=eth0
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_HPS={&#34;estimators&#34;:10}
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_USER_ENTRY_POINT=train_and_serve.py
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_FRAMEWORK_PARAMS={}
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_RESOURCE_CONFIG={&#34;current_host&#34;:&#34;algo-1-gcn8f&#34;,&#34;hosts&#34;:[&#34;algo-1-gcn8f&#34;]}
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_INPUT_DATA_CONFIG={&#34;test&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;},&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}}
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_OUTPUT_DATA_DIR=/opt/ml/output/data
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_CHANNELS=[&#34;test&#34;,&#34;train&#34;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_CURRENT_HOST=algo-1-gcn8f
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_MODULE_NAME=train_and_serve
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_LOG_LEVEL=20
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_FRAMEWORK_MODULE=sagemaker_sklearn_container.training:main
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_INPUT_DIR=/opt/ml/input
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_INPUT_CONFIG_DIR=/opt/ml/input/config
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_OUTPUT_DIR=/opt/ml/output
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_NUM_CPUS=2
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_NUM_GPUS=0
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_MODEL_DIR=/opt/ml/model
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_MODULE_DIR=s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-07-43-761/source/sourcedir.tar.gz
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_TRAINING_ENV={&#34;additional_framework_parameters&#34;:{},&#34;channel_input_dirs&#34;:{&#34;test&#34;:&#34;/opt/ml/input/data/test&#34;,&#34;train&#34;:&#34;/opt/ml/input/data/train&#34;},&#34;current_host&#34;:&#34;algo-1-gcn8f&#34;,&#34;framework_module&#34;:&#34;sagemaker_sklearn_container.training:main&#34;,&#34;hosts&#34;:[&#34;algo-1-gcn8f&#34;],&#34;hyperparameters&#34;:{&#34;estimators&#34;:10},&#34;input_config_dir&#34;:&#34;/opt/ml/input/config&#34;,&#34;input_data_config&#34;:{&#34;test&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;},&#34;train&#34;:{&#34;TrainingInputMode&#34;:&#34;File&#34;}},&#34;input_dir&#34;:&#34;/opt/ml/input&#34;,&#34;is_master&#34;:true,&#34;job_name&#34;:&#34;sagemaker-scikit-learn-2022-07-13-13-07-43-761&#34;,&#34;log_level&#34;:20,&#34;master_hostname&#34;:&#34;algo-1-gcn8f&#34;,&#34;model_dir&#34;:&#34;/opt/ml/model&#34;,&#34;module_dir&#34;:&#34;s3://sagemaker-us-east-1-801598032724/sagemaker-scikit-learn-2022-07-13-13-07-43-761/source/sourcedir.tar.gz&#34;,&#34;module_name&#34;:&#34;train_and_serve&#34;,&#34;network_interface_name&#34;:&#34;eth0&#34;,&#34;num_cpus&#34;:2,&#34;num_gpus&#34;:0,&#34;output_data_dir&#34;:&#34;/opt/ml/output/data&#34;,&#34;output_dir&#34;:&#34;/opt/ml/output&#34;,&#34;output_intermediate_dir&#34;:&#34;/opt/ml/output/intermediate&#34;,&#34;resource_config&#34;:{&#34;current_host&#34;:&#34;algo-1-gcn8f&#34;,&#34;hosts&#34;:[&#34;algo-1-gcn8f&#34;]},&#34;user_entry_point&#34;:&#34;train_and_serve.py&#34;}
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_USER_ARGS=[&#34;--estimators&#34;,&#34;10&#34;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_CHANNEL_TRAIN=/opt/ml/input/data/train
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_CHANNEL_TEST=/opt/ml/input/data/test
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> SM_HP_ESTIMATORS=10
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> PYTHONPATH=/opt/ml/code:/miniconda3/bin:/miniconda3/lib/python38.zip:/miniconda3/lib/python3.8:/miniconda3/lib/python3.8/lib-dynload:/miniconda3/lib/python3.8/site-packages
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> Invoking script with the following command:
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> /miniconda3/bin/python train_and_serve.py --estimators 10
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> command line arguments:  Namespace(estimators=10, sm_channel_test=&#39;/opt/ml/input/data/test&#39;, sm_channel_train=&#39;/opt/ml/input/data/train&#39;, sm_model_dir=&#39;/opt/ml/model&#39;, sm_output_data_dir=&#39;/opt/ml/output/data&#39;)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> training_dir: /opt/ml/input/data/train
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> training_dir files list: [&#39;train.csv&#39;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> testing_dir: /opt/ml/input/data/test
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> testing_dir files list: [&#39;test.csv&#39;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> sm_model_dir: /opt/ml/model
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> output_data_dir: /opt/ml/output/data
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> X_train.shape: (120, 4)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> y_train.shape: (120,)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> X_train.shape: (30, 4)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> y_train.shape: (30,)
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> sm_model_dir: /opt/ml/model
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> sm_model_dir files list: [&#39;model.joblib&#39;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> output_data_dir: /opt/ml/output/data
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> output_data_dir files list: [&#39;y_pred.csv&#39;, &#39;output_cm.png&#39;]
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f |</span> 2022-07-13 13:07:53,296 sagemaker-containers INFO     Reporting training SUCCESS
<span class="ansi-cyan-fg">96mwnip853-algo-1-gcn8f exited with code 0
</span>Aborting on container exit...
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Failed to delete: /tmp/tmp58lfmx49/algo-1-gcn8f Please remove it manually.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>===== Job Complete =====
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this point we have a trained model. Can we deploy this model already?</p>
<p>If I try to deploy this model using command</p>

<pre><code>sk_predictor = sk_estimator.deploy(
    initial_instance_count=1,
    instance_type='local'
)</code></pre>
<p>i will get exception messages</p>

<pre><code>[2022-07-09 06:15:45 +0000] [31] [ERROR] Error handling request /ping
Traceback (most recent call last):
  File "/miniconda3/lib/python3.8/site-packages/sagemaker_containers/_functions.py", line 93, in wrapper
    return fn(*args, **kwargs)
  File "/miniconda3/lib/python3.8/site-packages/sagemaker_sklearn_container/serving.py", line 43, in default_model_fn
    return transformer.default_model_fn(model_dir)
  File "/miniconda3/lib/python3.8/site-packages/sagemaker_containers/_transformer.py", line 35, in default_model_fn
    raise NotImplementedError(
NotImplementedError: 
Please provide a model_fn implementation.
See documentation for model_fn at https://github.com/aws/sagemaker-python-sdk</code></pre>
<p>this is because Before a model can be served, it must be loaded. The SageMaker Scikit-learn model server loads your model by invoking a model_fn function that you must provide in your script. The model_fn should have the following signature:</p>
<p>def model_fn(model_dir)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file

<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Pass in environment variables and hyperparameters</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="c1"># Hyperparameters</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--estimators&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># sm_model_dir: model artifacts stored here after training</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-model-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_MODEL_DIR&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">))</span>

    <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="n">estimators</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">estimators</span>
    <span class="n">sm_model_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_model_dir</span>
    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">train</span>
    
    <span class="c1"># print training_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir: </span><span class="si">{</span><span class="n">training_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir files list</span>
    
    <span class="c1"># Read in data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">training_dir</span> <span class="o">+</span> <span class="s2">&quot;/train.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="c1"># Preprocess data</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Build model</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">estimators</span><span class="p">)</span>
    <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Save model</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">,</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">))</span>
    
    <span class="c1"># print sm_model_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir files list</span>

    
<span class="c1"># Model serving</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Deserialize fitted model</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">model_fn</span><span class="p">(</span><span class="n">model_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;model_fn model_dir: </span><span class="si">{</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">predict_fn</span>
<span class="sd">    input_data: returned array from input_fn above</span>
<span class="sd">    model (sklearn model) returned model loaded from model_fn above</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">predict_fn</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;estimators&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Train the estimator</span>
<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_predictor</span> <span class="o">=</span> <span class="n">sk_estimator</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span>
    <span class="n">initial_instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mi">3571</span><span class="p">,</span> <span class="mi">1976</span><span class="p">,</span> <span class="mf">0.525</span><span class="p">]]</span>

<span class="n">response</span>  <span class="o">=</span> <span class="n">sk_predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">response</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted class category </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">categories_map</span><span class="p">[</span><span class="n">response</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_predictor</span><span class="o">.</span><span class="n">delete_endpoint</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note:</p>
<ul>
<li>if you are already running a local endpoint then you will not be able to create a new one. if you have lost the kernel session then you can delete the running endpoint from terminal using kill command.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># input in json and output in json</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> $script_file

<span class="kn">import</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span> <span class="c1"># do i need this?</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Pass in environment variables and hyperparameters</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="c1"># Hyperparameters</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--estimators&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># sm_model_dir: model artifacts stored here after training</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sm-model-dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_MODEL_DIR&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SM_CHANNEL_TRAIN&quot;</span><span class="p">))</span>

    <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="n">estimators</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">estimators</span>
    <span class="n">sm_model_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sm_model_dir</span>
    <span class="n">training_dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">train</span>
    
    <span class="c1"># print training_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir: </span><span class="si">{</span><span class="n">training_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;training_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">training_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print training_dir files list</span>
    
    <span class="c1"># Read in data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">training_dir</span> <span class="o">+</span> <span class="s2">&quot;/train.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="c1"># Preprocess data</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;class_cat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;class_cat&quot;</span><span class="p">]</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Build model</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">estimators</span><span class="p">)</span>
    <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Save model</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">,</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">))</span>
    
    <span class="c1"># print sm_model_dir info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir: </span><span class="si">{</span><span class="n">sm_model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir path</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sm_model_dir files list: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sm_model_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># print sm_model_dir files list</span>

    
<span class="c1"># Model serving</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Deserialize fitted model</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">model_fn</span><span class="p">(</span><span class="n">model_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;model_fn model_dir: </span><span class="si">{</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">predict_fn</span>
<span class="sd">    input_data: returned array from input_fn above</span>
<span class="sd">    model (sklearn model) returned model loaded from model_fn above</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">predict_fn</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">input_fn</span>
<span class="sd">    request_body: The body of the request sent to the model.</span>
<span class="sd">    request_content_type: (string) specifies the format/variable type of the request</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">input_fn</span><span class="p">(</span><span class="n">request_body</span><span class="p">,</span> <span class="n">request_content_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request_content_type</span> <span class="o">==</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="n">inpVar</span> <span class="o">=</span> <span class="n">request_body</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inpVar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This model only supports application/json input&quot;</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">output_fn</span>
<span class="sd">    prediction: the returned value from predict_fn above</span>
<span class="sd">    content_type: the content type the endpoint expects to be returned. Ex: JSON, string</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">output_fn</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">content_type</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">respJSON</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Output&quot;</span><span class="p">:</span> <span class="n">res</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">respJSON</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_estimator</span> <span class="o">=</span> <span class="n">SKLearn</span><span class="p">(</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="n">script_file</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="n">framework_version</span><span class="o">=</span><span class="s2">&quot;1.0-1&quot;</span><span class="p">,</span>
    <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;estimators&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Train the estimator</span>
<span class="n">sk_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">s3_train_uri</span><span class="p">})</span>

<span class="n">sk_predictor</span> <span class="o">=</span> <span class="n">sk_estimator</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span>
    <span class="n">initial_instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sk_endpoint_name</span> <span class="o">=</span> <span class="n">sk_predictor</span><span class="o">.</span><span class="n">endpoint_name</span>
<span class="n">sk_endpoint_name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">session_local</span><span class="o">.</span><span class="n">sagemaker_runtime_client</span>

<span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Input&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mi">3571</span><span class="p">,</span> <span class="mi">1976</span><span class="p">,</span> <span class="mf">0.525</span><span class="p">]]}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request_body</span><span class="p">))</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_endpoint</span><span class="p">(</span>
    <span class="n">EndpointName</span><span class="o">=</span><span class="n">sk_endpoint_name</span><span class="p">,</span> <span class="n">ContentType</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="n">Body</span><span class="o">=</span><span class="n">payload</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())[</span><span class="s2">&quot;Output&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted class category </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">categories_map</span><span class="p">[</span><span class="n">result</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

