<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Building a Feature Repository with SageMaker Feature Store | Random Thoughts</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Building a Feature Repository with SageMaker Feature Store" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features." />
<meta property="og:description" content="This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features." />
<link rel="canonical" href="https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/08/05/sagemaker-feature-store.html" />
<meta property="og:url" content="https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/08/05/sagemaker-feature-store.html" />
<meta property="og:site_name" content="Random Thoughts" />
<meta property="og:image" content="https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-05T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store.jpeg" />
<meta property="twitter:title" content="Building a Feature Repository with SageMaker Feature Store" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-05T00:00:00-05:00","datePublished":"2022-08-05T00:00:00-05:00","description":"This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.","headline":"Building a Feature Repository with SageMaker Feature Store","image":"https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/08/05/sagemaker-feature-store.html"},"url":"https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/08/05/sagemaker-feature-store.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/myblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://hassaanbinaslam.github.io/myblog/feed.xml" title="Random Thoughts" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMJ59ZML0G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TMJ59ZML0G');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/myblog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /><script src="https://hypothes.is/embed.js" async></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/myblog/">Random Thoughts</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/myblog/about/">About Me</a><a class="page-link" href="/myblog/search/">Search</a><a class="page-link" href="/myblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building a Feature Repository with SageMaker Feature Store</h1><p class="page-description">This notebook demonstrates how to build a central feature repository using Amazon SageMaker Feature Store. Feature Store is used to store, retrieve, and share machine learning features.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-08-05T00:00:00-05:00" itemprop="datePublished">
        Aug 5, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      22 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/myblog/categories/#aws">aws</a>
        &nbsp;
      
        <a class="category-tags-link" href="/myblog/categories/#ml">ml</a>
        &nbsp;
      
        <a class="category-tags-link" href="/myblog/categories/#sagemaker">sagemaker</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/hassaanbinaslam/myblog/tree/master/_notebooks/2022-08-05-sagemaker-feature-store.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/myblog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/hassaanbinaslam/myblog/master?filepath=_notebooks%2F2022-08-05-sagemaker-feature-store.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/myblog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/hassaanbinaslam/myblog/blob/master/_notebooks/2022-08-05-sagemaker-feature-store.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/myblog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fhassaanbinaslam%2Fmyblog%2Fblob%2Fmaster%2F_notebooks%2F2022-08-05-sagemaker-feature-store.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/myblog/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h1"><a href="#Environment">Environment </a></li>
<li class="toc-entry toc-h1"><a href="#Dataset-used-for-this-notebook">Dataset used for this notebook </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Data-source">Data source </a></li>
<li class="toc-entry toc-h2"><a href="#Data-link">Data link </a></li>
<li class="toc-entry toc-h2"><a href="#Data-classification-goal/target">Data classification goal/target </a></li>
<li class="toc-entry toc-h2"><a href="#Data-attributes-information">Data attributes information </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Input-variables">Input variables </a></li>
<li class="toc-entry toc-h3"><a href="#Output-variable-(desired-target)">Output variable (desired target) </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Load-and-explore-data">Load and explore data </a></li>
<li class="toc-entry toc-h1"><a href="#Creating-a-feature-group">Creating a feature group </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Considerations-for-creating-a-feature-group">Considerations for creating a feature group </a></li>
<li class="toc-entry toc-h2"><a href="#Create-feature-group-from-SageMaker-studio-IDE">Create feature group from SageMaker studio IDE </a></li>
<li class="toc-entry toc-h2"><a href="#Create-feature-group-from-SageMaker-SDK">Create feature group from SageMaker SDK </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Ingest-data-to-feature-group">Ingest data to feature group </a></li>
<li class="toc-entry toc-h1"><a href="#Accessing-features-from-feature-store">Accessing features from feature store </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Accessing-online-feature-store-from-SDK">Accessing online feature store from SDK </a></li>
<li class="toc-entry toc-h2"><a href="#Accessing-offline-feature-store-from-SDK">Accessing offline feature store from SDK </a></li>
<li class="toc-entry toc-h2"><a href="#Accessing-offline-store-from-Athena">Accessing offline store from Athena </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Clean-up">Clean up </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-08-05-sagemaker-feature-store.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store.jpeg" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h1>
<p>Amazon SageMaker Feature Store is a fully managed, purpose-built repository to store, share, and manage features for machine learning (ML) models. Features are inputs to ML models used during training and inference. For example, in an application that recommends a music playlist, features could include song ratings, listening duration, and listener demographics. Features are used repeatedly by multiple teams and feature quality is critical to ensure a highly accurate model. Also, when features used to train models offline in batch are made available for real-time inference, itâ€™s hard to keep the two feature stores synchronized. SageMaker Feature Store provides a secured and unified store for feature use across the ML lifecycle.</p>
<p><a href="https://aws.amazon.com/sagemaker/feature-store/">https://aws.amazon.com/sagemaker/feature-store/</a></p>
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store/feature-store.png" alt="feature-store.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Environment">
<a class="anchor" href="#Environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environment<a class="anchor-link" href="#Environment"> </a>
</h1>
<p>This notebook is prepared using Amazon SageMaker studio using <code>Python 3 (Data Science)</code> kernel running on <code>ml.t3.medium</code> instance.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws --version
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>aws-cli/1.25.27 Python/3.7.10 Linux/4.14.281-212.502.amzn2.x86_64 botocore/1.27.27
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Dataset-used-for-this-notebook">
<a class="anchor" href="#Dataset-used-for-this-notebook" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataset used for this notebook<a class="anchor-link" href="#Dataset-used-for-this-notebook"> </a>
</h1>
<p>We will use a publically available bank marketing dataset. The data is related to direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact with the same client was required to access if the product (bank term deposit) would be ('yes') or not ('no') subscribed.</p>
<h2 id="Data-source">
<a class="anchor" href="#Data-source" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data source<a class="anchor-link" href="#Data-source"> </a>
</h2>
<p>[Moro et al., 2014] S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014</p>
<h2 id="Data-link">
<a class="anchor" href="#Data-link" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data link<a class="anchor-link" href="#Data-link"> </a>
</h2>
<p>UCI Machine Learning Repository: <a href="https://archive.ics.uci.edu/ml/datasets/bank+marketing">https://archive.ics.uci.edu/ml/datasets/bank+marketing</a>. Dataset has multiple files. we will use <code>bank-additional-full.csv</code> file that has all examples (41188) and 20 inputs, ordered by date.</p>
<h2 id="Data-classification-goal/target">
<a class="anchor" href="#Data-classification-goal/target" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data classification goal/target<a class="anchor-link" href="#Data-classification-goal/target"> </a>
</h2>
<p>The classification goal is to predict if the client will subscribe (yes/no) a term deposit (variable <code>y</code>)</p>
<h2 id="Data-attributes-information">
<a class="anchor" href="#Data-attributes-information" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data attributes information<a class="anchor-link" href="#Data-attributes-information"> </a>
</h2>
<h3 id="Input-variables">
<a class="anchor" href="#Input-variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Input variables<a class="anchor-link" href="#Input-variables"> </a>
</h3>
<p><strong>attributes from bank client data</strong></p>
<ol>
<li>age (numeric)</li>
<li>job : type of job (categorical: 'admin.', 'blue-collar', 'entrepreneur', 'housemaid', 'management', 'retired', 'self-employed', 'services','student', 'technician', 'unemployed', 'unknown')</li>
<li>marital : marital status (categorical: 'divorced', 'married', 'single', 'unknown'; note: 'divorced' means divorced or widowed)</li>
<li>education (categorical: 'basic.4y', 'basic.6y', 'basic.9y', 'high.school', 'illiterate','professional.course', 'university.degree','unknown')</li>
<li>default: has credit in default? (categorical: 'no','yes','unknown')</li>
<li>housing: has housing loan? (categorical: 'no','yes','unknown')</li>
<li>loan: has personal loan? (categorical: 'no','yes','unknown')</li>
</ol>
<p><strong>attributes related with the last contact of the current campaign</strong></p>
<ol>
<li>contact: contact communication type (categorical: 'cellular','telephone')</li>
<li>month: last contact month of year (categorical: 'jan', 'feb', 'mar', ..., 'nov', 'dec')</li>
<li>day_of_week: last contact day of the week (categorical: 'mon','tue','wed','thu','fri')</li>
<li>duration: last contact duration, in seconds (numeric). Important note: this attribute highly affects the output target (e.g., if duration=0 then y='no'). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.</li>
</ol>
<p><strong>other attributes</strong></p>
<ol>
<li>campaign: number of contacts performed during this campaign and for this client (numeric, includes last contact)</li>
<li>pdays: number of days that passed by after the client was last contacted from a previous campaign (numeric; 999 means client was not previously contacted)</li>
<li>previous: number of contacts performed before this campaign and for this client (numeric)</li>
<li>poutcome: outcome of the previous marketing campaign (categorical: 'failure','nonexistent','success')</li>
</ol>
<p><strong>social and economic context attributes</strong></p>
<ol>
<li>emp.var.rate: employment variation rate - quarterly indicator (numeric)</li>
<li>cons.price.idx: consumer price index - monthly indicator (numeric)</li>
<li>cons.conf.idx: consumer confidence index - monthly indicator (numeric)</li>
<li>euribor3m: euribor 3 month rate - daily indicator (numeric)</li>
<li>nr.employed: number of employees - quarterly indicator (numeric)</li>
</ol>
<h3 id="Output-variable-(desired-target)">
<a class="anchor" href="#Output-variable-(desired-target)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Output variable (desired target)<a class="anchor-link" href="#Output-variable-(desired-target)"> </a>
</h3>
<ol>
<li>y: has the client subscribed a term deposit? (binary: 'yes','no')</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Load-and-explore-data">
<a class="anchor" href="#Load-and-explore-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Load and explore data<a class="anchor-link" href="#Load-and-explore-data"> </a>
</h1>
<p>Let's define a local directory <code>local_path</code> to keep all the files and artifacts related to this post.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># local path will be the root directory for this post</span>
<span class="n">local_path</span> <span class="o">=</span> <span class="s2">"./datasets/2022-08-05-sagemaker-feature-store/"</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's make sure that the local directory folder exists.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now download the data file to the <code>local_path</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>wget <span class="s1">'https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip'</span> -P <span class="o">{</span>local_path<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--2022-08-08 06:05:57--  https://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank-additional.zip
Resolving archive.ics.uci.edu (archive.ics.uci.edu)... 128.195.10.252
Connecting to archive.ics.uci.edu (archive.ics.uci.edu)|128.195.10.252|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 444572 (434K) [application/x-httpd-php]
Saving to: â€˜./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zipâ€™

bank-additional.zip 100%[===================&gt;] 434.15K  1.55MB/s    in 0.3s    

2022-08-08 06:05:58 (1.55 MB/s) - â€˜./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zipâ€™ saved [444572/444572]

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unzip the downloaded file.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>unzip -o <span class="o">{</span>local_path<span class="o">}</span>bank-additional.zip -d <span class="o">{</span>local_path<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Archive:  ./datasets/2022-08-05-sagemaker-feature-store/bank-additional.zip
   creating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/.DS_Store  
   creating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/
   creating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/bank-additional/
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/bank-additional/._.DS_Store  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/.Rhistory  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-full.csv  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-names.txt  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional.csv  
  inflating: ./datasets/2022-08-05-sagemaker-feature-store/__MACOSX/._bank-additional  
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Extracted files contains multiple datasets. We will use <code>bank-additional-full.csv</code> which has all the examples (41188) and 20 inputs, ordered by date.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># define data file path</span>
<span class="n">local_data_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">bank-additional/bank-additional-full.csv"</span>
<span class="n">local_data_file</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'./datasets/2022-08-05-sagemaker-feature-store/bank-additional/bank-additional-full.csv'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's read the dataset and explore it.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"display.max_columns"</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"display.width"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">local_data_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">";"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"df.shape: "</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>df.shape:  (41188, 21)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp.var.rate</th>
      <th>cons.price.idx</th>
      <th>cons.conf.idx</th>
      <th>euribor3m</th>
      <th>nr.employed</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56</td>
      <td>housemaid</td>
      <td>married</td>
      <td>basic.4y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>261</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>unknown</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>149</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>226</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>admin.</td>
      <td>married</td>
      <td>basic.6y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>151</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
    </tr>
    <tr>
      <th>4</th>
      <td>56</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>307</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Creating-a-feature-group">
<a class="anchor" href="#Creating-a-feature-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a feature group<a class="anchor-link" href="#Creating-a-feature-group"> </a>
</h1>
<p>A feature group in the SageMaker feature store defines the metadata, feature definition, unique identifier for data entries, and other store configurations.</p>
<p>There are two ways to create a feature group in SageMaker.</p>
<ul>
<li>Using SageMaker Studio IDE</li>
<li>SageMaker Python SDK</li>
</ul>
<h2 id="Considerations-for-creating-a-feature-group">
<a class="anchor" href="#Considerations-for-creating-a-feature-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Considerations for creating a feature group<a class="anchor-link" href="#Considerations-for-creating-a-feature-group"> </a>
</h2>
<ul>
<li>Supported data types in feature group are: string, integral, and fractional</li>
<li>There should be a feature that can uniquely identify each row</li>
<li>There should be a feature that defines event time (event_time). This feature is required for versioning and time travel. Excepted data types for this feature are string or fractional.<ul>
<li>For <code>String</code> type event time has to be ISO-8601 format in UTC time with the <code>yyyy-MM-dd'T'HH:mm:ssZ</code> or <code>yyyy-MM-dd'T'HH:mm:ss.SSSZ</code> patterns</li>
<li>For <code>Fractional</code> type, the values are expected to be in seconds from Unix epoch time with millisecond precision</li>
</ul>
</li>
</ul>
<p>Our dataset does not have a feature that can uniquely identify each row. So let's create one.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 'FS_id' defines unique id for each row</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'FS_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, we also need to create an event time feature. For this, we will use string type with <code>yyyy-MM-dd'T'HH:mm:ss.SSSZ</code> pattern.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">generate_event_timestamp</span><span class="p">():</span>
    <span class="c1"># naive datetime representing local time</span>
    <span class="n">naive_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="c1"># take timezone into account</span>
    <span class="n">aware_dt</span> <span class="o">=</span> <span class="n">naive_dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span>
    <span class="c1"># time in UTC</span>
    <span class="n">utc_dt</span> <span class="o">=</span> <span class="n">aware_dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="c1"># transform to ISO-8601 format</span>
    <span class="n">event_time</span> <span class="o">=</span> <span class="n">utc_dt</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s2">"milliseconds"</span><span class="p">)</span>
    <span class="n">event_time</span> <span class="o">=</span> <span class="n">event_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"+00:00"</span><span class="p">,</span> <span class="s2">"Z"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">event_time</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">generate_event_timestamp</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'2022-08-08T06:06:07.059Z'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># `FS_event_time` contains event timestamps</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'FS_event_time'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_event_timestamp</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check our dataset with two new features.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp.var.rate</th>
      <th>cons.price.idx</th>
      <th>cons.conf.idx</th>
      <th>euribor3m</th>
      <th>nr.employed</th>
      <th>y</th>
      <th>FS_id</th>
      <th>FS_event_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56</td>
      <td>housemaid</td>
      <td>married</td>
      <td>basic.4y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>261</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>0</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>unknown</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>149</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>1</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>226</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>2</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>admin.</td>
      <td>married</td>
      <td>basic.6y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>151</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>3</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>4</th>
      <td>56</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>307</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>4</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Initialize SageMaker session.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sagemaker</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">role</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">boto_region_name</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"sagemaker.__version__: "</span><span class="p">,</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Session: "</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Role: "</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Bucket: "</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Region: "</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>sagemaker.__version__:  2.99.0
Session:  &lt;sagemaker.session.Session object at 0x7fb40934c890&gt;
Role:  arn:aws:iam::801598032724:role/service-role/AmazonSageMaker-ExecutionRole-20220804T174502
Bucket:  sagemaker-us-east-1-801598032724
Region:  us-east-1
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># All the data related to this post will be under this prefix.</span>
<span class="n">bucket_prefix</span> <span class="o">=</span> <span class="s2">"2022-08-05-sagemaker-feature-store"</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Feature store requires an S3 location for storing the ingested data. Let's define it as well.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fs_offline_bucket_studio</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"s3://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bucket_prefix</span><span class="si">}</span><span class="s2">/fs_offline/studio"</span>
<span class="n">fs_offline_bucket_studio</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'s3://sagemaker-us-east-1-801598032724/2022-08-05-sagemaker-feature-store/fs_offline/studio'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-feature-group-from-SageMaker-studio-IDE">
<a class="anchor" href="#Create-feature-group-from-SageMaker-studio-IDE" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create feature group from SageMaker studio IDE<a class="anchor-link" href="#Create-feature-group-from-SageMaker-studio-IDE"> </a>
</h2>
<p>Let's see how we can create a feature group using SageMaker Studio IDE. You don't need to write any code while creating a feature group using Studio IDE. From the left sidebar, use the <code>SageMaker Resources</code> menu to open the <code>Feature Group</code> pane, and click the <code>create feature group</code> option. This will open a new tab in IDE to create a feature group.</p>
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store/create-feature-group.PNG" alt="create-feature-group.PNG"></p>
<p>On the <code>create feature group</code> tab, define the following settings:</p>
<ul>
<li>Feature group name : "bank-marketing-studio"</li>
<li>Description (optional) : "The data is related to direct marketing campaigns (phone calls) of a Portuguese banking institution."</li>
<li>Feature group storage configurations<ul>
<li>Enable online store : Check this box. Note that for the online store there is no S3 bucket requirement.</li>
<li>Enable offline store : Check this box too. <ul>
<li>Enter S3 location from <code>fs_offline_bucket_studio</code>
</li>
<li>IAM Role ARN : Default SageMaker role.</li>
</ul>
</li>
<li>Enable Data Catalog for offline store</li>
</ul>
</li>
<li>Select <code>continue</code>
</li>
</ul>
<p>On the next page, you will be asked to specify feature definitions. There are two ways to define them.</p>
<ul>
<li>Using Table, and manually fill each feature and its type</li>
<li>Using JSON. We will use this option to define the features and their types.</li>
</ul>
<p>Remember that the feature group only supports three data types: string, integral, and fractional. So we need to create a mapping between Pandas Dataframe data types and that of a feature store.</p>
<ul>
<li>"object" -&gt; "String"</li>
<li>"int64" -&gt; "Integral"</li>
<li>"float64" -&gt; "Fractional"</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># map DataFrame types to feature group.</span>
<span class="k">def</span> <span class="nf">get_mapping</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>

    <span class="n">feature_store_dtype_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"object"</span><span class="p">:</span> <span class="s2">"String"</span><span class="p">,</span>
        <span class="s2">"int64"</span><span class="p">:</span> <span class="s2">"Integral"</span><span class="p">,</span>
        <span class="s2">"float64"</span><span class="p">:</span> <span class="s2">"Fractional"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">feature_store_dtype_mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># DataFrame feature data types</span>
<span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>age                 int64
job                object
marital            object
education          object
default            object
housing            object
loan               object
contact            object
month              object
day_of_week        object
duration            int64
campaign            int64
pdays               int64
previous            int64
poutcome           object
emp.var.rate      float64
cons.price.idx    float64
cons.conf.idx     float64
euribor3m         float64
nr.employed       float64
y                  object
FS_id               int64
FS_event_time      object
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># prepare list of feature names and correct data types</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">feature_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Feature names allow alphanumeric characters including dashes and underscores. So let's remove the "." character from the feature names.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># fix feature names</span>
<span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)):</span>
    <span class="n">feature_names</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_names</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># corrected feature names</span>
<span class="n">feature_names</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>['age',
 'job',
 'marital',
 'education',
 'default',
 'housing',
 'loan',
 'contact',
 'month',
 'day_of_week',
 'duration',
 'campaign',
 'pdays',
 'previous',
 'poutcome',
 'emp_var_rate',
 'cons_price_idx',
 'cons_conf_idx',
 'euribor3m',
 'nr_employed',
 'y',
 'FS_id',
 'FS_event_time']</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we are ready to prepare JSON for feature definitions. JSON created should be of the following format.</p>

<pre><code>[
    {
        "FeatureName": "age",
        "FeatureType": "Integral"
    }
]</code></pre>
<p>Let's prepare it.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"FeatureName"</span><span class="p">:</span> <span class="n">feature_names</span><span class="p">,</span> <span class="s2">"FeatureType"</span><span class="p">:</span> <span class="n">feature_types</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_features</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"records"</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[{"FeatureName":"age","FeatureType":"Integral"},{"FeatureName":"job","FeatureType":"String"},{"FeatureName":"marital","FeatureType":"String"},{"FeatureName":"education","FeatureType":"String"},{"FeatureName":"default","FeatureType":"String"},{"FeatureName":"housing","FeatureType":"String"},{"FeatureName":"loan","FeatureType":"String"},{"FeatureName":"contact","FeatureType":"String"},{"FeatureName":"month","FeatureType":"String"},{"FeatureName":"day_of_week","FeatureType":"String"},{"FeatureName":"duration","FeatureType":"Integral"},{"FeatureName":"campaign","FeatureType":"Integral"},{"FeatureName":"pdays","FeatureType":"Integral"},{"FeatureName":"previous","FeatureType":"Integral"},{"FeatureName":"poutcome","FeatureType":"String"},{"FeatureName":"emp_var_rate","FeatureType":"Fractional"},{"FeatureName":"cons_price_idx","FeatureType":"Fractional"},{"FeatureName":"cons_conf_idx","FeatureType":"Fractional"},{"FeatureName":"euribor3m","FeatureType":"Fractional"},{"FeatureName":"nr_employed","FeatureType":"Fractional"},{"FeatureName":"y","FeatureType":"String"},{"FeatureName":"FS_id","FeatureType":"Integral"},{"FeatureName":"FS_event_time","FeatureType":"String"}]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Copy the JSON from the last cell output and past it in feature definition JSON input. Click <code>continue</code></p>
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store/feature-definition.PNG" alt="feature-definition.PNG"></p>
<p>On the next page, it will ask for the required features.</p>
<ul>
<li>record identifier feature name : select <code>FS_ID</code>
</li>
<li>event type feature name : select <code>FS_event_time</code>
</li>
</ul>
<p>Click <code>continue</code> and create the feature group.</p>
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store/feature-group-created.PNG" alt="feature-group-created.PNG"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-feature-group-from-SageMaker-SDK">
<a class="anchor" href="#Create-feature-group-from-SageMaker-SDK" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create feature group from SageMaker SDK<a class="anchor-link" href="#Create-feature-group-from-SageMaker-SDK"> </a>
</h2>
<p>We have seen how we can create a feature group from SageMaker studio IDE. Let's also see how to create it using SageMaker SDK.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># define a feature group</span>
<span class="kn">from</span> <span class="nn">sagemaker.feature_store.feature_group</span> <span class="kn">import</span> <span class="n">FeatureGroup</span>

<span class="n">feature_group_name</span> <span class="o">=</span> <span class="s2">"bank-marketing-sdk"</span>
<span class="n">feature_group</span> <span class="o">=</span> <span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">feature_group_name</span><span class="p">,</span> <span class="n">sagemaker_session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have created a FeatureGroup, now we need to define its schema (FeatureDefinitions). When I check the <a href="https://sagemaker.readthedocs.io/en/stable/api/prep_data/feature_store.html">SageMaker Python SDK Feature Store APIs reference</a>, I could not find any method to provide <code>FeatureDefinitions</code> to a feature group. But feature store documentation examples <a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_featurestore.html">amazon_sagemaker_featurestore</a> mention that we can use <code>feature_group.load_feature_definitions()</code> method to load the feature definitions from Pandas dataframe. When I checked the <code>sagemaker-python-sdk</code> GitHub page there is an <a href="https://github.com/aws/sagemaker-python-sdk/issues/2677">open issue</a> that says "The documentation does not include the load_feature_definitions() method for the FeatureGroup class", and is still open.</p>
<p>To get more understanding of this method we can check the source code for sagemaker feature group class <a href="https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/feature_store/feature_group.py">github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/feature_store/feature_group.py</a>. If we check the signature and documentation for this method it says:</p>

<pre><code>def load_feature_definitions(
        self,
        data_frame: DataFrame,
    ) -&gt; Sequence[FeatureDefinition]:

        """Load feature definitions from a Pandas DataFrame.
        Column name is used as feature name. Feature type is inferred from the dtype
        of the column. Dtype int_, int8, int16, int32, int64, uint8, uint16, uint32
        and uint64 are mapped to Integral feature type. Dtype float_, float16, float32
        and float64 are mapped to Fractional feature type. string dtype is mapped to
        String feature type.
        No feature definitions will be loaded if the given data_frame contains
        unsupported dtypes.
        Args:
            data_frame (DataFrame):
        Returns:
            list of FeatureDefinition
        """</code></pre>
<p>That is</p>
<ul>
<li>It loads feature definitions from a Pandas DataFrame</li>
<li>DataFrame column names are used as feature names</li>
<li>Feature types are inferred from the dtype of columns<ul>
<li>Dtype int_, int8, int16, int32, int64, uint8, uint16, uint32 and uint64 are mapped to <code>Integral</code> feature type</li>
<li>Dtype float_, float16, float32 and float64 are mapped to <code>Fractional</code> feature type</li>
<li>Dtype string is mapped to <code>String</code> feature type</li>
<li>No feature definitions will be loaded if the given data_frame contains unsupported dtypes</li>
</ul>
</li>
</ul>
<p>In the last section, we have seen that our dataframe has <code>object</code> data types that are not supported. For backward compatibility reasons, Pandas DataFrame infers columns with strings as <code>object</code> data type. With Pandas 1.0 onwards we can explicitly use <code>string</code> type for such columns.</p>
<p>Let's see what happens when we use unsupported data types for feature definition.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># load unsupported feature definitions. This will generate an error.</span>
<span class="n">feature_group</span><span class="o">.</span><span class="n">load_feature_definitions</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-24-f77a8abe3ce7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg">##</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-fg"># load unsupported feature definitions. This will generate an error.</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>feature_group<span class="ansi-blue-fg">.</span>load_feature_definitions<span class="ansi-blue-fg">(</span>data_frame<span class="ansi-blue-fg">=</span>df<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/feature_store/feature_group.py</span> in <span class="ansi-cyan-fg">load_feature_definitions</span><span class="ansi-blue-fg">(self, data_frame)</span>
<span class="ansi-green-intense-fg ansi-bold">    570</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    571</span>                 raise ValueError(
<span class="ansi-green-fg">--&gt; 572</span><span class="ansi-red-fg">                     </span><span class="ansi-blue-fg">f"Failed to infer Feature type based on dtype {data_frame[column].dtype} "</span>
<span class="ansi-green-intense-fg ansi-bold">    573</span>                     <span class="ansi-blue-fg">f"for column {column}."</span>
<span class="ansi-green-intense-fg ansi-bold">    574</span>                 )

<span class="ansi-red-fg">ValueError</span>: Failed to infer Feature type based on dtype object for column job.</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It throws an error, "ValueError: Failed to infer Feature type based on dtype object for column job."</p>
<p>Okay, let's convet columns to proper data types.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># list of columns with `object` data type</span>
<span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">"object"</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>['job',
 'marital',
 'education',
 'default',
 'housing',
 'loan',
 'contact',
 'month',
 'day_of_week',
 'poutcome',
 'y',
 'FS_event_time']</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># covert `object` columns to `string` data type</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">"object"</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"string"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's verify the data types of all columns.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>age                 int64
job                string
marital            string
education          string
default            string
housing            string
loan               string
contact            string
month              string
day_of_week        string
duration            int64
campaign            int64
pdays               int64
previous            int64
poutcome           string
emp.var.rate      float64
cons.price.idx    float64
cons.conf.idx     float64
euribor3m         float64
nr.employed       float64
y                  string
FS_id               int64
FS_event_time      string
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp.var.rate</th>
      <th>cons.price.idx</th>
      <th>cons.conf.idx</th>
      <th>euribor3m</th>
      <th>nr.employed</th>
      <th>y</th>
      <th>FS_id</th>
      <th>FS_event_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56</td>
      <td>housemaid</td>
      <td>married</td>
      <td>basic.4y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>261</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>0</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>unknown</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>149</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>1</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>226</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>2</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>admin.</td>
      <td>married</td>
      <td>basic.6y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>151</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>3</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>4</th>
      <td>56</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>307</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>4</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's load the feature definitions again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_group</span><span class="o">.</span><span class="n">load_feature_definitions</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[FeatureDefinition(feature_name='age', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='job', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='marital', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='education', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='default', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='housing', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='loan', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='contact', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='month', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='day_of_week', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='duration', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='campaign', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='pdays', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='previous', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='poutcome', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='emp.var.rate', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons.price.idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons.conf.idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='euribor3m', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='nr.employed', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='y', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='FS_id', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='FS_event_time', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have defined our feature group and its feature definitions, but it has not been created. To create it we need to call <code>create</code> method on the feature group. For this let's define s3 URI for our feature store offline data storage.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fs_offline_bucket_sdk</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"s3://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bucket_prefix</span><span class="si">}</span><span class="s2">/fs_offline/sdk"</span>
<span class="n">fs_offline_bucket_sdk</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'s3://sagemaker-us-east-1-801598032724/2022-08-05-sagemaker-feature-store/fs_offline/sdk'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Now create feature group</span>
<span class="n">record_identifier_name</span> <span class="o">=</span> <span class="s2">"FS_id"</span>
<span class="n">event_time_feature_name</span> <span class="o">=</span> <span class="s2">"FS_event_time"</span>
<span class="n">description</span> <span class="o">=</span> <span class="s2">"The data is related with direct marketing campaigns (phone calls) of a Portuguese banking institution"</span>

<span class="n">feature_group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">record_identifier_name</span><span class="o">=</span><span class="n">record_identifier_name</span><span class="p">,</span>
    <span class="n">event_time_feature_name</span><span class="o">=</span><span class="n">event_time_feature_name</span><span class="p">,</span>
    <span class="n">enable_online_store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">s3_uri</span><span class="o">=</span><span class="n">fs_offline_bucket_sdk</span><span class="p">,</span>
    <span class="n">role_arn</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ClientError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-5459ca8fa447&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>     s3_uri<span class="ansi-blue-fg">=</span>fs_offline_bucket_sdk<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>     role_arn<span class="ansi-blue-fg">=</span>role<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg">     </span>description<span class="ansi-blue-fg">=</span>description<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span> )

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/feature_store/feature_group.py</span> in <span class="ansi-cyan-fg">create</span><span class="ansi-blue-fg">(self, s3_uri, record_identifier_name, event_time_feature_name, role_arn, online_store_kms_key_id, enable_online_store, offline_store_kms_key_id, disable_glue_table_creation, data_catalog_config, description, tags)</span>
<span class="ansi-green-intense-fg ansi-bold">    519</span>             )
<span class="ansi-green-intense-fg ansi-bold">    520</span> 
<span class="ansi-green-fg">--&gt; 521</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>sagemaker_session<span class="ansi-blue-fg">.</span>create_feature_group<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>create_feature_store_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    522</span> 
<span class="ansi-green-intense-fg ansi-bold">    523</span>     <span class="ansi-green-fg">def</span> delete<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/sagemaker/session.py</span> in <span class="ansi-cyan-fg">create_feature_group</span><span class="ansi-blue-fg">(self, feature_group_name, record_identifier_name, event_time_feature_name, feature_definitions, role_arn, online_store_config, offline_store_config, description, tags)</span>
<span class="ansi-green-intense-fg ansi-bold">   4076</span>             Tags<span class="ansi-blue-fg">=</span>tags<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   4077</span>         )
<span class="ansi-green-fg">-&gt; 4078</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>sagemaker_client<span class="ansi-blue-fg">.</span>create_feature_group<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   4079</span> 
<span class="ansi-green-intense-fg ansi-bold">   4080</span>     def describe_feature_group(

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/botocore/client.py</span> in <span class="ansi-cyan-fg">_api_call</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    506</span>                 )
<span class="ansi-green-intense-fg ansi-bold">    507</span>             <span class="ansi-red-fg"># The "self" in this scope is referring to the BaseClient.</span>
<span class="ansi-green-fg">--&gt; 508</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_make_api_call<span class="ansi-blue-fg">(</span>operation_name<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    509</span> 
<span class="ansi-green-intense-fg ansi-bold">    510</span>         _api_call<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>py_operation_name<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/lib/python3.7/site-packages/botocore/client.py</span> in <span class="ansi-cyan-fg">_make_api_call</span><span class="ansi-blue-fg">(self, operation_name, api_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    913</span>             error_code <span class="ansi-blue-fg">=</span> parsed_response<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Error"</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Code"</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    914</span>             error_class <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>exceptions<span class="ansi-blue-fg">.</span>from_code<span class="ansi-blue-fg">(</span>error_code<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 915</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> error_class<span class="ansi-blue-fg">(</span>parsed_response<span class="ansi-blue-fg">,</span> operation_name<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    916</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    917</span>             <span class="ansi-green-fg">return</span> parsed_response

<span class="ansi-red-fg">ClientError</span>: An error occurred (ValidationException) when calling the CreateFeatureGroup operation: 4 validation errors detected: Value 'emp.var.rate' at 'featureDefinitions.16.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'cons.price.idx' at 'featureDefinitions.17.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'cons.conf.idx' at 'featureDefinitions.18.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}; Value 'nr.employed' at 'featureDefinitions.20.member.featureName' failed to satisfy constraint: Member must satisfy regular expression pattern: ^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We got an error as we have not fixed feature names. Error is saying that the feature name should satisfy the regular expression pattern: <code>^[a-zA-Z0-9]([-_]*[a-zA-Z0-9]){0,63}</code>. Let's fix our column names.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">col_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)):</span>
    <span class="n">col_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col_names</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp_var_rate</th>
      <th>cons_price_idx</th>
      <th>cons_conf_idx</th>
      <th>euribor3m</th>
      <th>nr_employed</th>
      <th>y</th>
      <th>FS_id</th>
      <th>FS_event_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56</td>
      <td>housemaid</td>
      <td>married</td>
      <td>basic.4y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>261</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>0</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>unknown</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>149</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>1</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>226</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>2</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>admin.</td>
      <td>married</td>
      <td>basic.6y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>151</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>3</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
    <tr>
      <th>4</th>
      <td>56</td>
      <td>services</td>
      <td>married</td>
      <td>high.school</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>telephone</td>
      <td>may</td>
      <td>mon</td>
      <td>307</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>1.1</td>
      <td>93.994</td>
      <td>-36.4</td>
      <td>4.857</td>
      <td>5191.0</td>
      <td>no</td>
      <td>4</td>
      <td>2022-08-08T06:06:07.524Z</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After updating feature names, load the feature group definitions again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_group</span><span class="o">.</span><span class="n">load_feature_definitions</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[FeatureDefinition(feature_name='age', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='job', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='marital', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='education', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='default', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='housing', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='loan', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='contact', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='month', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='day_of_week', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='duration', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='campaign', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='pdays', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='previous', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='poutcome', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='emp_var_rate', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons_price_idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='cons_conf_idx', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='euribor3m', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='nr_employed', feature_type=&lt;FeatureTypeEnum.FRACTIONAL: 'Fractional'&gt;),
 FeatureDefinition(feature_name='y', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;),
 FeatureDefinition(feature_name='FS_id', feature_type=&lt;FeatureTypeEnum.INTEGRAL: 'Integral'&gt;),
 FeatureDefinition(feature_name='FS_event_time', feature_type=&lt;FeatureTypeEnum.STRING: 'String'&gt;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now create the feature group.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># create feature group</span>
<span class="n">feature_group</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">record_identifier_name</span><span class="o">=</span><span class="n">record_identifier_name</span><span class="p">,</span>
    <span class="n">event_time_feature_name</span><span class="o">=</span><span class="n">event_time_feature_name</span><span class="p">,</span>
    <span class="n">enable_online_store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">s3_uri</span><span class="o">=</span><span class="n">fs_offline_bucket_sdk</span><span class="p">,</span>
    <span class="n">role_arn</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'FeatureGroupArn': 'arn:aws:sagemaker:us-east-1:801598032724:feature-group/bank-marketing-sdk',
 'ResponseMetadata': {'RequestId': '5c2afeb1-fa03-442b-a3ee-80b1b0ae1069',
  'HTTPStatusCode': 200,
  'HTTPHeaders': {'x-amzn-requestid': '5c2afeb1-fa03-442b-a3ee-80b1b0ae1069',
   'content-type': 'application/x-amz-json-1.1',
   'content-length': '95',
   'date': 'Mon, 08 Aug 2022 06:06:32 GMT'},
  'RetryAttempts': 0}}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Feature group creation is an async method, and you need to wait for its creation before ingesting any data into it. For this you can use <code>feature_group.describe</code> method to get feature store creation status.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_group</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'FeatureGroupStatus'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'Creating'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can create a wrapper function around this method to wait till the feature group is ready.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">wait_for_feature_group_creation_complete</span><span class="p">(</span><span class="n">feature_group</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">feature_group</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"FeatureGroupStatus"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Initial status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"Creating"</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Waiting for feature group: </span><span class="si">{</span><span class="n">feature_group</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to be created ..."</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">feature_group</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"FeatureGroupStatus"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"FeatureGroup </span><span class="si">{</span><span class="n">feature_group</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> was successfully created."</span><span class="p">)</span>


<span class="n">wait_for_feature_group_creation_complete</span><span class="p">(</span><span class="n">feature_group</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Initial status: Creating
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
Waiting for feature group: bank-marketing-sdk to be created ...
FeatureGroup bank-marketing-sdk was successfully created.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Ingest-data-to-feature-group">
<a class="anchor" href="#Ingest-data-to-feature-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ingest data to feature group<a class="anchor-link" href="#Ingest-data-to-feature-group"> </a>
</h1>
<p>Let's ingest our data frame into this feature group.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_group</span><span class="o">.</span><span class="n">ingest</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_processes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>IngestionManagerPandas(feature_group_name='bank-marketing-sdk', sagemaker_fs_runtime_client_config=&lt;botocore.config.Config object at 0x7fb406ab9450&gt;, max_workers=5, max_processes=1, profile_name=None, _async_result=&lt;multiprocess.pool.MapResult object at 0x7fb405669810&gt;, _processing_pool=&lt;pool ProcessPool(ncpus=1)&gt;, _failed_indices=[])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can control the ingestion run time with <code>max_processes</code> and <code>max_workers</code> arguments.</p>
<ul>
<li>
<code>max_processes</code> defines the number of processes that will be created to ingest different partitions of the DataFrame in parallel</li>
<li>
<code>max_workers</code> defines the number threads for each processor</li>
</ul>
<p>For large datasets, instead of using ingestion API we can place the data directly on feature group S3 bucket offline storage location. For a detailed discussion on this topic follow the post from <a href="https://www.linkedin.com/in/heikohotz/">Heiko Hotz</a>: <a href="https://towardsdatascience.com/ingesting-historical-feature-data-into-sagemaker-feature-store-5618e41a11e6">ingesting-historical-feature-data-into-sagemaker-feature-store</a></p>
<h1 id="Accessing-features-from-feature-store">
<a class="anchor" href="#Accessing-features-from-feature-store" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing features from feature store<a class="anchor-link" href="#Accessing-features-from-feature-store"> </a>
</h1>
<p>Now that we have our data available in the feature repository, we can access it from online and offline feature stores.</p>
<h2 id="Accessing-online-feature-store-from-SDK">
<a class="anchor" href="#Accessing-online-feature-store-from-SDK" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing online feature store from SDK<a class="anchor-link" href="#Accessing-online-feature-store-from-SDK"> </a>
</h2>
<p>Boto3 SDK <code>sagemaker-featurestore-runtime</code> allows us to interact with the online feature store. These are the available methods:</p>
<ul>
<li>batch_get_record()</li>
<li>can_paginate()</li>
<li>close()</li>
<li>delete_record()</li>
<li>get_paginator()</li>
<li>get_record()</li>
<li>get_waiter()</li>
<li>put_record()</li>
</ul>
<p>To read more about them use <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-featurestore-runtime.html">Boto3 SageMakerFeatureStoreRuntime</a> documentation.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">featurestore_runtime_client</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
    <span class="s2">"sagemaker-featurestore-runtime"</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># select any random id to query online store</span>
<span class="n">sample_feature_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sample_feature_id</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'37156'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now query the online store.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>it

<span class="n">featurestore_runtime_client</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="n">FeatureGroupName</span><span class="o">=</span><span class="n">feature_group_name</span><span class="p">,</span> 
                                                        <span class="n">RecordIdentifierValueAsString</span><span class="o">=</span><span class="n">sample_feature_id</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8.37 ms Â± 238 Âµs per loop (mean Â± std. dev. of 7 runs, 100 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_record</span> <span class="o">=</span> <span class="n">featurestore_runtime_client</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span>
    <span class="n">FeatureGroupName</span><span class="o">=</span><span class="n">feature_group_name</span><span class="p">,</span> <span class="n">RecordIdentifierValueAsString</span><span class="o">=</span><span class="n">sample_feature_id</span>
<span class="p">)</span>

<span class="n">feature_record</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'ResponseMetadata': {'RequestId': '946376b7-7745-4b25-9885-e93ba7a284a5',
  'HTTPStatusCode': 200,
  'HTTPHeaders': {'x-amzn-requestid': '946376b7-7745-4b25-9885-e93ba7a284a5',
   'content-type': 'application/json',
   'content-length': '1189',
   'date': 'Mon, 08 Aug 2022 06:08:49 GMT'},
  'RetryAttempts': 0},
 'Record': [{'FeatureName': 'age', 'ValueAsString': '39'},
  {'FeatureName': 'job', 'ValueAsString': 'blue-collar'},
  {'FeatureName': 'marital', 'ValueAsString': 'married'},
  {'FeatureName': 'education', 'ValueAsString': 'basic.9y'},
  {'FeatureName': 'default', 'ValueAsString': 'no'},
  {'FeatureName': 'housing', 'ValueAsString': 'no'},
  {'FeatureName': 'loan', 'ValueAsString': 'no'},
  {'FeatureName': 'contact', 'ValueAsString': 'cellular'},
  {'FeatureName': 'month', 'ValueAsString': 'aug'},
  {'FeatureName': 'day_of_week', 'ValueAsString': 'wed'},
  {'FeatureName': 'duration', 'ValueAsString': '394'},
  {'FeatureName': 'campaign', 'ValueAsString': '1'},
  {'FeatureName': 'pdays', 'ValueAsString': '999'},
  {'FeatureName': 'previous', 'ValueAsString': '0'},
  {'FeatureName': 'poutcome', 'ValueAsString': 'nonexistent'},
  {'FeatureName': 'emp_var_rate', 'ValueAsString': '-2.9'},
  {'FeatureName': 'cons_price_idx', 'ValueAsString': '92.201'},
  {'FeatureName': 'cons_conf_idx', 'ValueAsString': '-31.4'},
  {'FeatureName': 'euribor3m', 'ValueAsString': '0.884'},
  {'FeatureName': 'nr_employed', 'ValueAsString': '5076.2'},
  {'FeatureName': 'y', 'ValueAsString': 'yes'},
  {'FeatureName': 'FS_id', 'ValueAsString': '37156'},
  {'FeatureName': 'FS_event_time',
   'ValueAsString': '2022-08-08T06:06:07.834Z'}]}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Accessing-offline-feature-store-from-SDK">
<a class="anchor" href="#Accessing-offline-feature-store-from-SDK" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing offline feature store from SDK<a class="anchor-link" href="#Accessing-offline-feature-store-from-SDK"> </a>
</h2>
<p>Let's query the offline store to get the same data. For offline feature storage, SageMaker stages the data in S3 bucket and creates AWS Data Catalog on it. This catalog is registered in AWS Athena and we can use Athena APIs to query offline store.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">feature_group</span><span class="o">.</span><span class="n">athena_query</span><span class="p">()</span>
<span class="n">query</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>AthenaQuery(catalog='AwsDataCatalog', database='sagemaker_featurestore', table_name='bank-marketing-sdk-1659938792', sagemaker_session=&lt;sagemaker.session.Session object at 0x7fb40934c890&gt;, _current_query_execution_id=None, _result_bucket=None, _result_file_prefix=None)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">table_name</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">table_name</span>
<span class="n">table_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'bank-marketing-sdk-1659938792'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'SELECT * FROM "</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">" WHERE FS_id = </span><span class="si">{</span><span class="n">sample_feature_id</span><span class="si">}</span><span class="s1">'</span>
<span class="n">query_string</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'SELECT * FROM "bank-marketing-sdk-1659938792" WHERE FS_id = 37156'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>it
<span class="n">query</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query_string</span><span class="o">=</span><span class="n">query_string</span><span class="p">,</span><span class="n">output_location</span><span class="o">=</span><span class="sa">f</span><span class="s1">'s3://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bucket_prefix</span><span class="si">}</span><span class="s1">/query_results/'</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5.21 s Â± 29.4 ms per loop (mean Â± std. dev. of 7 runs, 1 loop each)
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that the offline store has taken a much longer time to return the results compared to the online store.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp_var_rate</th>
      <th>cons_price_idx</th>
      <th>cons_conf_idx</th>
      <th>euribor3m</th>
      <th>nr_employed</th>
      <th>y</th>
      <th>fs_id</th>
      <th>fs_event_time</th>
      <th>write_time</th>
      <th>api_invocation_time</th>
      <th>is_deleted</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Data in an online store becomes available immediately but it can take a few minutes to become available in an offline store. That is why we have not received any data in the last cell. Let's run the same query again after a few minutes.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># run query again</span>
<span class="n">query</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query_string</span><span class="o">=</span><span class="n">query_string</span><span class="p">,</span><span class="n">output_location</span><span class="o">=</span><span class="sa">f</span><span class="s1">'s3://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bucket_prefix</span><span class="si">}</span><span class="s1">/query_results/'</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

<span class="c1"># get query response</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>contact</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>duration</th>
      <th>campaign</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>emp_var_rate</th>
      <th>cons_price_idx</th>
      <th>cons_conf_idx</th>
      <th>euribor3m</th>
      <th>nr_employed</th>
      <th>y</th>
      <th>fs_id</th>
      <th>fs_event_time</th>
      <th>write_time</th>
      <th>api_invocation_time</th>
      <th>is_deleted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>39</td>
      <td>blue-collar</td>
      <td>married</td>
      <td>basic.9y</td>
      <td>no</td>
      <td>no</td>
      <td>no</td>
      <td>cellular</td>
      <td>aug</td>
      <td>wed</td>
      <td>394</td>
      <td>1</td>
      <td>999</td>
      <td>0</td>
      <td>nonexistent</td>
      <td>-2.9</td>
      <td>92.201</td>
      <td>-31.4</td>
      <td>0.884</td>
      <td>5076.2</td>
      <td>yes</td>
      <td>37156</td>
      <td>2022-08-08T06:06:07.834Z</td>
      <td>2022-08-08 06:13:03.665</td>
      <td>2022-08-08 06:07:43.000</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Accessing-offline-store-from-Athena">
<a class="anchor" href="#Accessing-offline-store-from-Athena" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing offline store from Athena<a class="anchor-link" href="#Accessing-offline-store-from-Athena"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This time lets query the offline feature store directly from AWS Athena service.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-08-05-sagemaker-feature-store/feature_store_athena.PNG" alt="feature_store_athena.PNG"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Clean-up">
<a class="anchor" href="#Clean-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clean up<a class="anchor-link" href="#Clean-up"> </a>
</h1>
<p>Run the last cell to delete the feature store if no longer needed.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_group</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="hassaanbinaslam/myblog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/myblog/aws/ml/sagemaker/2022/08/05/sagemaker-feature-store.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/myblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/myblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/myblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A log of my mistakes, thoughts, and learning.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/hassaanbinaslam" target="_blank" title="hassaanbinaslam"><svg class="svg-icon grey"><use xlink:href="/myblog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/hassaanbinaslam" target="_blank" title="hassaanbinaslam"><svg class="svg-icon grey"><use xlink:href="/myblog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
