<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Sklearn Pipeline and Transformers Deep Dive | Random Thoughts</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Sklearn Pipeline and Transformers Deep Dive" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer." />
<meta property="og:description" content="A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer." />
<link rel="canonical" href="https://hassaanbinaslam.github.io/myblog/ml/sklearn/2022/03/04/sklearn-pipeline-deep-dive.html" />
<meta property="og:url" content="https://hassaanbinaslam.github.io/myblog/ml/sklearn/2022/03/04/sklearn-pipeline-deep-dive.html" />
<meta property="og:site_name" content="Random Thoughts" />
<meta property="og:image" content="https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-03-04-sklearn-pipeline-deep-dive.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-04T00:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-03-04-sklearn-pipeline-deep-dive.jpeg" />
<meta property="twitter:title" content="Sklearn Pipeline and Transformers Deep Dive" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-04T00:00:00-06:00","datePublished":"2022-03-04T00:00:00-06:00","description":"A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.","headline":"Sklearn Pipeline and Transformers Deep Dive","image":"https://hassaanbinaslam.github.io/myblog/images/copied_from_nb/images/2022-03-04-sklearn-pipeline-deep-dive.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://hassaanbinaslam.github.io/myblog/ml/sklearn/2022/03/04/sklearn-pipeline-deep-dive.html"},"url":"https://hassaanbinaslam.github.io/myblog/ml/sklearn/2022/03/04/sklearn-pipeline-deep-dive.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/myblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://hassaanbinaslam.github.io/myblog/feed.xml" title="Random Thoughts" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMJ59ZML0G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TMJ59ZML0G');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/myblog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /><script src="https://hypothes.is/embed.js" async></script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/myblog/">Random Thoughts</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/myblog/about/">About Me</a><a class="page-link" href="/myblog/search/">Search</a><a class="page-link" href="/myblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sklearn Pipeline and Transformers Deep Dive</h1><p class="page-description">A detailed tutorial on Sklearn Pipeline, ColumnTransformer, FunctionTransformer, and a custom transformer.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-03-04T00:00:00-06:00" itemprop="datePublished">
        Mar 4, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      33 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/myblog/categories/#ml">ml</a>
        &nbsp;
      
        <a class="category-tags-link" href="/myblog/categories/#sklearn">sklearn</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/hassaanbinaslam/myblog/tree/master/_notebooks/2022-03-04-sklearn-pipeline-deep-dive.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/myblog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/hassaanbinaslam/myblog/master?filepath=_notebooks%2F2022-03-04-sklearn-pipeline-deep-dive.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/myblog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/hassaanbinaslam/myblog/blob/master/_notebooks/2022-03-04-sklearn-pipeline-deep-dive.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/myblog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fhassaanbinaslam%2Fmyblog%2Fblob%2Fmaster%2F_notebooks%2F2022-03-04-sklearn-pipeline-deep-dive.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/myblog/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#About">About </a></li>
<li class="toc-entry toc-h2"><a href="#Setup">Setup </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Environment-Details">Environment Details </a></li>
<li class="toc-entry toc-h3"><a href="#Loading-Data">Loading Data </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Some-Terminology-First">Some Terminology First </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Datasets">Datasets </a></li>
<li class="toc-entry toc-h3"><a href="#Estimator">Estimator </a></li>
<li class="toc-entry toc-h3"><a href="#Transformer">Transformer </a></li>
<li class="toc-entry toc-h3"><a href="#Fit">Fit </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Sklearn-Pipeline">Sklearn Pipeline </a></li>
<li class="toc-entry toc-h2"><a href="#ColumnTransformer">ColumnTransformer </a>
<ul>
<li class="toc-entry toc-h4"><a href="#get_feature_names_out(input_features=None)">get_feature_names_out(input_features=None) </a></li>
<li class="toc-entry toc-h4"><a href="#make_column_transformer">make_column_transformer </a></li>
<li class="toc-entry toc-h4"><a href="#Important-difference-between-Pipeline-and-ColumnTransformer">Important difference between Pipeline and ColumnTransformer </a></li>
<li class="toc-entry toc-h4"><a href="#Open-questions?">Open questions? </a>
<ul>
<li class="toc-entry toc-h5"><a href="#Why-is-the-output-not-a-dataframe?">Why is the output not a dataframe? </a></li>
<li class="toc-entry toc-h5"><a href="#Can-we-get-the-feature-names-back?">Can we get the feature names back? </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#FunctionTransformer">FunctionTransformer </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Where-are-the-rest-of-the-columns?">Where are the rest of the columns? </a></li>
<li class="toc-entry toc-h3"><a href="#What-happens-if-I-change-the-sequence-in-ColumnTranformer?">What happens if I change the sequence in ColumnTranformer? </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Pipeline-inside-ColumnTransformer">Pipeline inside ColumnTransformer </a></li>
<li class="toc-entry toc-h2"><a href="#Custom-Transformer">Custom Transformer </a></li>
<li class="toc-entry toc-h2"><a href="#Feature-Engineering-with-Custom-Transformer">Feature Engineering with Custom Transformer </a></li>
<li class="toc-entry toc-h2"><a href="#Sklean-Pipeline-with-Feature-Importance">Sklean Pipeline with Feature Importance </a></li>
<li class="toc-entry toc-h2"><a href="#The-complete-Pipeline">The complete Pipeline </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Load-Data">Load Data </a></li>
<li class="toc-entry toc-h3"><a href="#Train-Model">Train Model </a></li>
<li class="toc-entry toc-h3"><a href="#Plot-Feature-Importance">Plot Feature Importance </a></li>
<li class="toc-entry toc-h3"><a href="#Pickle-Test">Pickle Test </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-03-04-sklearn-pipeline-deep-dive.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/myblog/images/copied_from_nb/images/2022-03-04-sklearn-pipeline-deep-dive.jpeg" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="About">
<a class="anchor" href="#About" aria-hidden="true"><span class="octicon octicon-link"></span></a>About<a class="anchor-link" href="#About"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This notebook shows various ways to work with Skearn Pipelines.</p>
<ul>
<li>We will start with some of the limitations of pipelines and how to overcome them</li>
<li>We will discuss getting a dataframe from a pipeline instead of a NumPy array, and the benefits of this approach</li>
<li>We will learn how to use CustomTransformer and a FunctionTransformer</li>
<li>We will also build a custom transformer to do some feature engineering</li>
<li>Along the way, we will also see how to avoid common mistakes while creating pipelines</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h2>
<h3 id="Environment-Details">
<a class="anchor" href="#Environment-Details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environment Details<a class="anchor-link" href="#Environment-Details"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">python_version</span>
<span class="kn">import</span> <span class="nn">sklearn</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">matplotlib</span><span class="o">,</span> <span class="nn">pandas</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"python=="</span> <span class="o">+</span> <span class="n">python_version</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"sklearn=="</span> <span class="o">+</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"numpy=="</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"pandas=="</span> <span class="o">+</span> <span class="n">pandas</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"matplotlib=="</span> <span class="o">+</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>python==3.8.8
sklearn==1.0.2
numpy==1.20.1
pandas==1.2.3
matplotlib==3.5.1
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Loading-Data">
<a class="anchor" href="#Loading-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading Data<a class="anchor-link" href="#Loading-Data"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For this example we will use the original <code>Titanic</code> dataset, describing the survival status of individual passengers on the Titanic ship.</p>
<p>Some notes from original source:</p>
<ul>
<li>The variables on our extracted dataset are 'pclass', 'name', 'sex', 'age', 'sibsp', 'parch', 'ticket', 'fare','cabin', 'embarked', 'boat', 'body', and 'home.dest'. </li>
<li>pclass refers to passenger class (1st, 2nd, 3rd), and is a proxy for socio-economic class. </li>
<li>Age is in years, and some infants had fractional values.</li>
<li>sibsp = Number of Siblings/Spouses aboard</li>
<li>parch = Number of Parents/Children aboard</li>
<li>The target is either a person survived or not (1 or 0)</li>
</ul>
<p><strong>Important note</strong>: The purpose of this notebook is not to train a best model on titanic data, but to understand the working of Sklearn pipeline and transformers. So please be mindful of that.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_openml</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># for consistency</span>

<span class="c1"># Load data from https://www.openml.org/d/40945</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s2">"titanic"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>cabin</th>
      <th>embarked</th>
      <th>boat</th>
      <th>body</th>
      <th>home.dest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>Allen, Miss. Elisabeth Walton</td>
      <td>female</td>
      <td>29.0000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24160</td>
      <td>211.3375</td>
      <td>B5</td>
      <td>S</td>
      <td>2</td>
      <td>NaN</td>
      <td>St Louis, MO</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>Allison, Master. Hudson Trevor</td>
      <td>male</td>
      <td>0.9167</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>11</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>Allison, Miss. Helen Loraine</td>
      <td>female</td>
      <td>2.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>Allison, Mr. Hudson Joshua Creighton</td>
      <td>male</td>
      <td>30.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>135.0</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>Allison, Mrs. Hudson J C (Bessie Waldo Daniels)</td>
      <td>female</td>
      <td>25.0000</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>113781</td>
      <td>151.5500</td>
      <td>C22 C26</td>
      <td>S</td>
      <td>None</td>
      <td>NaN</td>
      <td>Montreal, PQ / Chesterville, ON</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># let's check the frequency of missing values in each feature</span>
<span class="n">X</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>body         1188
cabin        1014
boat          823
home.dest     564
age           263
embarked        2
fare            1
pclass          0
name            0
sex             0
sibsp           0
parch           0
ticket          0
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># let's drop top 4 features with highest percentage of missing data</span>
<span class="c1"># This step is done to make our working with pipeline simpler and easier to understand</span>

<span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'body'</span><span class="p">,</span> <span class="s1">'cabin'</span><span class="p">,</span> <span class="s1">'boat'</span><span class="p">,</span> <span class="s1">'home.dest'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>999</th>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>female</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>7.7500</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>392</th>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>female</td>
      <td>24.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>27.7208</td>
      <td>C</td>
    </tr>
    <tr>
      <th>628</th>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>female</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>31.2750</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1165</th>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>male</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>7.2250</td>
      <td>C</td>
    </tr>
    <tr>
      <th>604</th>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>female</td>
      <td>16.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>7.6500</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Some-Terminology-First">
<a class="anchor" href="#Some-Terminology-First" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some Terminology First<a class="anchor-link" href="#Some-Terminology-First"> </a>
</h2>
<h3 id="Datasets">
<a class="anchor" href="#Datasets" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/tutorial/statistical_inference/settings.html#datasets">Datasets</a><a class="anchor-link" href="#Datasets"> </a>
</h3>
<p>Scikit-learn deals with learning information from one or more datasets that are represented as 2D arrays. They can be understood as a list of multi-dimensional observations. We say that the first axis of these arrays is the <strong>samples axis</strong>, while the second is the <strong>features axis</strong>.</p>
<blockquote>
<p>(n_samples, n_features)</p>
</blockquote>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># for our titanic dataset:</span>
<span class="c1"># n_samples = 1309</span>
<span class="c1"># n_features = 9</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1309, 9)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Estimator">
<a class="anchor" href="#Estimator" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/tutorial/statistical_inference/settings.html#estimators-objects">Estimator</a><a class="anchor-link" href="#Estimator"> </a>
</h3>
<p>An estimator is any object that learns from data; it may be a classification, regression or clustering algorithm or a transformer that extracts/filters useful features from raw data.</p>
<p>All estimator objects expose a fit method that takes a dataset (usually a 2-d array)</p>
<blockquote>
<p>estimator.fit(data)</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transformer">
<a class="anchor" href="#Transformer" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/glossary.html#term-transformer">Transformer</a><a class="anchor-link" href="#Transformer"> </a>
</h3>
<p>An estimator supporting <code>transform</code> and/or <code>fit_transform</code> methods.</p>
<p>A transformer, transforms the input, usually only X, into some transformed space. Output is an array or sparse matrix of length n_samples and with the number of columns fixed after <strong>fitting</strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fit">
<a class="anchor" href="#Fit" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/glossary.html#term-fit">Fit</a><a class="anchor-link" href="#Fit"> </a>
</h3>
<p>The fit method is provided on every estimator. It usually takes some samples X, targets y if the model is supervised, and potentially other sample properties such as sample_weight.</p>
<p>It should:</p>
<ul>
<li>clear any prior attributes stored on the estimator, unless warm_start is used</li>
<li>validate and interpret any parameters, ideally raising an error if invalid</li>
<li>validate the input data</li>
<li>estimate and store model attributes from the estimated parameters and provided data; and</li>
<li>return the now fitted estimator to facilitate method chaining</li>
</ul>
<p>Note:</p>
<ul>
<li>
<strong>Fitting</strong> = Calling <code>fit</code> (or <code>fit_transform</code>, <code>fit_predict</code>) method on an estimator.</li>
<li>
<strong>Fitted</strong> = The state of an estimator after fitting.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sklearn-Pipeline">
<a class="anchor" href="#Sklearn-Pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline">Sklearn Pipeline</a><a class="anchor-link" href="#Sklearn-Pipeline"> </a>
</h2>
<blockquote>
<p>class sklearn.pipeline.Pipeline(steps, *, memory=None, verbose=False)</p>
</blockquote>
<p>It is a <em>pipeline of transformers with a final estimator</em>.</p>
<p>It sequentially applies a list of <strong>transforms</strong> and a final <strong>estimator</strong>. Intermediate steps of the pipeline must be <strong>transforms</strong>, that is, they must implement <strong>fit</strong> and <strong>transform</strong> methods. The final estimator only needs to implement <strong>fit</strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets create a simple pipeline to better understand its componets. Steps in our pipeline will be</p>
<ul>
<li>replace missing values using the mean along each <em>numerical feature</em> column; and</li>
<li>then scale them</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">'imputer'</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">'scaler'</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># our first pipeline has been initialized</span>
<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also visualize the pipeline as a diagram. It has two steps: imputer and scaler in sequence.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">"diagram"</span><span class="p">)</span>

<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf {color: black;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf pre{padding: 0;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable {background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-estimator:hover {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-item {z-index: 1;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-parallel-item:only-child::after {width: 0;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-ff729026-9b6d-4f2d-a23c-337f0fbe40bf" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="389aae22-0524-4e0c-b66e-f1a4ef5f4e21" type="checkbox"><label for="389aae22-0524-4e0c-b66e-f1a4ef5f4e21" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('imputer', SimpleImputer()), ('scaler', StandardScaler())])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="2e19aeb3-49b0-4aaa-80df-65cd4ecfe474" type="checkbox"><label for="2e19aeb3-49b0-4aaa-80df-65cd4ecfe474" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="438d0fc7-aaa5-4cc1-a34e-6a7d8c32dba4" type="checkbox"><label for="438d0fc7-aaa5-4cc1-a34e-6a7d8c32dba4" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>now lets call <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline.fit_transform"><strong>fit_transform</strong></a> method to run this pipeline, and preprocess our loaded data</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
</p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [8]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)">#collapse-output</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 2</span> <span class="ansi-yellow-bg">pipe</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X_train</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y_train</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:426</span>, in <span class="ansi-cyan-fg">Pipeline.fit_transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params)</span>
<span class="ansi-green-fg">    399</span> <span style="color: rgb(175,0,0)">"""Fit the model and transform with the final estimator.</span>
<span class="ansi-green-fg">    400</span> 
<span class="ansi-green-fg">    401</span> <span style="color: rgb(175,0,0)">Fits all the transformers one after the other and transform the</span>
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    423</span> <span style="color: rgb(175,0,0)">    Transformed samples.</span>
<span class="ansi-green-fg">    424</span> <span style="color: rgb(175,0,0)">"""</span>
<span class="ansi-green-fg">    425</span> fit_params_steps <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_check_fit_params(<span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 426</span> Xt <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params_steps</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    428</span> last_step <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_final_estimator
<span class="ansi-green-fg">    429</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> _print_elapsed_time(<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">Pipeline</span><span style="color: rgb(175,0,0)">"</span>, <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_log_message(<span style="color: rgb(0,135,0)">len</span>(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>steps) <span style="color: rgb(98,98,98)">-</span> <span style="color: rgb(98,98,98)">1</span>)):

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:348</span>, in <span class="ansi-cyan-fg">Pipeline._fit</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params_steps)</span>
<span class="ansi-green-fg">    346</span>     cloned_transformer <span style="color: rgb(98,98,98)">=</span> clone(transformer)
<span class="ansi-green-fg">    347</span> <span style="color: rgb(95,135,135)"># Fit or load from cache the current transformer</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 348</span> X, fitted_transformer <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">fit_transform_one_cached</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    349</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">cloned_transformer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    350</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    351</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    352</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">None</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    353</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">message_clsname</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">"</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Pipeline</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">"</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    354</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">message</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_log_message</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">step_idx</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    355</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params_steps</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">name</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    356</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    357</span> <span style="color: rgb(95,135,135)"># Replace the transformer of the step with the fitted</span>
<span class="ansi-green-fg">    358</span> <span style="color: rgb(95,135,135)"># transformer. This is necessary when loading the transformer</span>
<span class="ansi-green-fg">    359</span> <span style="color: rgb(95,135,135)"># from the cache.</span>
<span class="ansi-green-fg">    360</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>steps[step_idx] <span style="color: rgb(98,98,98)">=</span> (name, fitted_transformer)

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\joblib\memory.py:352</span>, in <span class="ansi-cyan-fg">NotMemorizedFunc.__call__</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwargs)</span>
<span class="ansi-green-fg">    351</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">__call__</span>(<span style="color: rgb(0,135,0)">self</span>, <span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 352</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:893</span>, in <span class="ansi-cyan-fg">_fit_transform_one</span><span class="ansi-blue-intense-fg ansi-bold">(transformer, X, y, weight, message_clsname, message, **fit_params)</span>
<span class="ansi-green-fg">    891</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> _print_elapsed_time(message_clsname, message):
<span class="ansi-green-fg">    892</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">hasattr</span>(transformer, <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">fit_transform</span><span style="color: rgb(175,0,0)">"</span>):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 893</span>         res <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">transformer</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    894</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    895</span>         res <span style="color: rgb(98,98,98)">=</span> transformer<span style="color: rgb(98,98,98)">.</span>fit(X, y, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params)<span style="color: rgb(98,98,98)">.</span>transform(X)

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\base.py:855</span>, in <span class="ansi-cyan-fg">TransformerMixin.fit_transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params)</span>
<span class="ansi-green-fg">    852</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>fit(X, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params)<span style="color: rgb(98,98,98)">.</span>transform(X)
<span class="ansi-green-fg">    853</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    854</span>     <span style="color: rgb(95,135,135)"># fit method of arity 2 (supervised transformation)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 855</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params</span><span class="ansi-yellow-bg">)</span><span style="color: rgb(98,98,98)">.</span>transform(X)

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\impute\_base.py:319</span>, in <span class="ansi-cyan-fg">SimpleImputer.fit</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y)</span>
<span class="ansi-green-fg">    302</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">fit</span>(<span style="color: rgb(0,135,0)">self</span>, X, y<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">None</span>):
<span class="ansi-green-fg">    303</span>     <span style="color: rgb(175,0,0)">"""Fit the imputer on `X`.</span>
<span class="ansi-green-fg">    304</span> 
<span class="ansi-green-fg">    305</span> <span style="color: rgb(175,0,0)">    Parameters</span>
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    317</span> <span style="color: rgb(175,0,0)">        Fitted estimator.</span>
<span class="ansi-green-fg">    318</span> <span style="color: rgb(175,0,0)">    """</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 319</span>     X <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_validate_input</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">in_fit</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    321</span>     <span style="color: rgb(95,135,135)"># default fill_value is 0 for numerical input and "missing_value"</span>
<span class="ansi-green-fg">    322</span>     <span style="color: rgb(95,135,135)"># otherwise</span>
<span class="ansi-green-fg">    323</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>fill_value <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\impute\_base.py:285</span>, in <span class="ansi-cyan-fg">SimpleImputer._validate_input</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, in_fit)</span>
<span class="ansi-green-fg">    279</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">could not convert</span><span style="color: rgb(175,0,0)">"</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">str</span>(ve):
<span class="ansi-green-fg">    280</span>     new_ve <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg">    281</span>         <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">Cannot use </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> strategy with non-numeric data:</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)">"</span><span style="color: rgb(98,98,98)">.</span>format(
<span class="ansi-green-fg">    282</span>             <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>strategy, ve
<span class="ansi-green-fg">    283</span>         )
<span class="ansi-green-fg">    284</span>     )
<span class="ansi-green-intense-fg ansi-bold">--&gt; 285</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> new_ve <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">    286</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    287</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ve

<span class="ansi-red-intense-fg ansi-bold">ValueError</span>: Cannot use mean strategy with non-numeric data:
could not convert string to float: "McCarthy, Miss. Catherine 'Katie'"</pre>
</div>
</div>

</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Aaargh! this is not what we intended. Let us try to understand why our pipeline did not work and then fix it. The exception message says:</p>

<pre><code>ValueError: Cannot use mean strategy with non-numeric data: could not convert string to float: "McCarthy, Miss. Catherine 'Katie'</code></pre>
<p>From the error message we can deduce that Pipeline is trying to apply its transformers on all columns in the dataset. This was not our intention, as we wanted to apply the transformers to numeric data only. Let's limit our simple pipeline to numerical columns and run again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">num_cols</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ 0.        , -0.49963779],
       [-0.43641134, -0.09097855],
       [-1.44872891, -0.01824953],
       ...,
       [-0.98150542, -0.49349894],
       [-0.82576425, -0.44336498],
       [-0.59215251, -0.49349894]])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alright, our pipeline has run now and we can also observe a few outcomes.</p>
<ul>
<li>When we apply a pipeline to a dataset it will run transformers to all features in the dataset. </li>
<li>Output from one transformer will be passed on to the next one until we reach the end of the pipeline</li>
<li>If we want to apply different transformers for numerical and categorical features (heterogeneous data) then the pipeline will not work for us. We would have to create separate pipelines for the different feature sets and then join the output.</li>
</ul>
<p>To overcome the limitation of a pipeline for heterogeneous data, Sklearn recommends using <code>ColumnTransformer</code>. With ColumnTransformer we can provide column names against the transformers on which we want to apply them.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ColumnTransformer">
<a class="anchor" href="#ColumnTransformer" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html">ColumnTransformer</a><a class="anchor-link" href="#ColumnTransformer"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see our first ColumnTransformer in action.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="c1"># Note the sequence when creating a ColumnTransformer</span>
<span class="c1"># 1. a name for the transformer</span>
<span class="c1"># 2. the transformer</span>
<span class="c1"># 3. the column names</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">'standardscaler'</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]</span> <span class="p">),</span>
    <span class="p">(</span><span class="s1">'onehotencoder'</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">])</span>
    <span class="p">])</span>

<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d {color: black;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d pre{padding: 0;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable {background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-estimator:hover {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-item {z-index: 1;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-parallel-item:only-child::after {width: 0;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-7a0edb81-5adc-45aa-b695-a59d4edb3d0d" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="21a9ab6a-cd1c-46d6-805e-5a6f5e959d4a" type="checkbox"><label for="21a9ab6a-cd1c-46d6-805e-5a6f5e959d4a" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])])</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="462d9f3e-0bfe-4465-97b6-04434fba3f13" type="checkbox"><label for="462d9f3e-0bfe-4465-97b6-04434fba3f13" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="d040066d-e670-468f-a54c-a2b680ce0092" type="checkbox"><label for="d040066d-e670-468f-a54c-a2b680ce0092" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="63db649c-2bf6-43a1-8f64-4150194536ea" type="checkbox"><label for="63db649c-2bf6-43a1-8f64-4150194536ea" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="2e78c3d5-e5e0-472a-bfc4-975c93357c49" type="checkbox"><label for="2e78c3d5-e5e0-472a-bfc4-975c93357c49" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Let's execute our pipeline to see the output.</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[        nan, -0.49939913,  1.        ,  0.        ],
       [-0.39043136, -0.09093509,  1.        ,  0.        ],
       [-1.2960919 , -0.01824081,  1.        ,  0.        ],
       ...,
       [-0.87809473, -0.49326321,  0.        ,  1.        ],
       [-0.73876234, -0.4431532 ,  0.        ,  1.        ],
       [-0.52976375, -0.49326321,  0.        ,  1.        ]])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="get_feature_names_out(input_features=None)">
<a class="anchor" href="#get_feature_names_out(input_features=None)" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer.get_feature_names_out">get_feature_names_out(input_features=None)</a><a class="anchor-link" href="#get_feature_names_out(input_features=None)"> </a>
</h4>
<p>At this point I will also introduce a very useful function <code>get_feature_names_out(input_features=None)</code>.
Using this method we can get output feature names as well.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array(['standardscaler__age', 'standardscaler__fare',
       'onehotencoder__sex_female', 'onehotencoder__sex_male'],
      dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice the output</p>
<ul>
<li>Output feature names appear as <code>&lt;transformer_name&gt;__&lt;feature_name&gt;</code>
</li>
<li>For OneHotEncoded feature "sex", output feature names have the label attached to them</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="make_column_transformer">
<a class="anchor" href="#make_column_transformer" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.make_column_transformer.html">make_column_transformer</a><a class="anchor-link" href="#make_column_transformer"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sklean also provides a wrapper function for <code>ColumnTransformer</code> where we don't have to provide names for the transformers.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>

<span class="c1"># Note the sequence when using make_column_transformer</span>
<span class="c1"># 1. the transformer</span>
<span class="c1"># 2. the column names</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span> <span class="p">),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># to keep output feature names simple</span>
<span class="p">)</span>

<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e {color: black;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e pre{padding: 0;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable {background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-estimator:hover {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-item {z-index: 1;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-parallel-item:only-child::after {width: 0;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-49b26e74-1e32-4f57-ac80-d53883a6b13e div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-49b26e74-1e32-4f57-ac80-d53883a6b13e" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="ddaf98b5-df69-409b-86f6-a26fae31b4dd" type="checkbox"><label for="ddaf98b5-df69-409b-86f6-a26fae31b4dd" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="bc47c38d-0fbd-4cfc-ae01-bc12ecd46658" type="checkbox"><label for="bc47c38d-0fbd-4cfc-ae01-bc12ecd46658" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="8c04b557-0f7c-4228-962d-1e3b3535f7b8" type="checkbox"><label for="8c04b557-0f7c-4228-962d-1e3b3535f7b8" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="09d678b6-4e36-4d96-a707-a8074fe889e0" type="checkbox"><label for="09d678b6-4e36-4d96-a707-a8074fe889e0" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="d3cd275c-c821-4111-b8d4-304a90fdbf15" type="checkbox"><label for="d3cd275c-c821-4111-b8d4-304a90fdbf15" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Let's execute our pipeline.</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[        nan, -0.49939913,  1.        ,  0.        ],
       [-0.39043136, -0.09093509,  1.        ,  0.        ],
       [-1.2960919 , -0.01824081,  1.        ,  0.        ],
       ...,
       [-0.87809473, -0.49326321,  0.        ,  1.        ],
       [-0.73876234, -0.4431532 ,  0.        ,  1.        ],
       [-0.52976375, -0.49326321,  0.        ,  1.        ]])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># notice the feature names this time. they are shorter.</span>
<span class="c1"># we have used attribute "verbose_feature_names_out=False" in our pipeline above.</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array(['age', 'fare', 'sex_female', 'sex_male'], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Important-difference-between-Pipeline-and-ColumnTransformer">
<a class="anchor" href="#Important-difference-between-Pipeline-and-ColumnTransformer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Important difference between Pipeline and ColumnTransformer<a class="anchor-link" href="#Important-difference-between-Pipeline-and-ColumnTransformer"> </a>
</h4>
<ul>
<li>Pipeline applies transformer in sequence on all columns</li>
<li>ColumnTranformer applies transformers in parallel to specified columns and then concats the output</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Open-questions?">
<a class="anchor" href="#Open-questions?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Open questions?<a class="anchor-link" href="#Open-questions?"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So our ColumnTransformer is working. But we have a few more questions to address.</p>
<ul>
<li>Why is the output from our pipeline or ColumnTransformer not shown as a dataframe with output features nicely separated in different columns?</li>
<li>Our input dataset had more features besides age, fare, and sex. Why are they not present in the output?</li>
<li>What happens if I change the sequence of transformers, and feature names in my ColumnTransformer?</li>
</ul>
<p>In the coming sections, we will try to address these questions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Why-is-the-output-not-a-dataframe?">
<a class="anchor" href="#Why-is-the-output-not-a-dataframe?" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Why is the output not a dataframe?</strong><a class="anchor-link" href="#Why-is-the-output-not-a-dataframe?"> </a>
</h5>
<p>The output from a pipeline or a ColumnTransformer is an nd-array where the first index is the number of samples, and second index are the output features <code>(n_samples, n_output_features)</code>. Since we are only getting numpy array as an output, we are losing information about the column names.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'numpy.ndarray'&gt;
(1047, 4)
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Can-we-get-the-feature-names-back?">
<a class="anchor" href="#Can-we-get-the-feature-names-back?" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Can we get the feature names back?</strong><a class="anchor-link" href="#Can-we-get-the-feature-names-back?"> </a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have already seen that we can get the output feature names using method <code>get_feature_names_out</code>. But this time let's try to analyze our ColumnsTransformer more closely. The transformer attributes discussed here also applies to Pipeline object.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># print the internals of ColumnTransformer</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">'text'</span><span class="p">)</span>
<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ColumnTransformer has an attribute 'transformers' that is keeping a list of all the provided transformers. Let's print it.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">transformers</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[('standardscaler', StandardScaler(), ['age', 'fare']),
 ('onehotencoder', OneHotEncoder(), ['sex'])]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These are the transformers list at the initialization time. If we want to check the transformers after <code>fit</code> function has been called, then we need to print a different attribute <code>transformers_</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">transformers_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[('standardscaler', StandardScaler(), ['age', 'fare']),
 ('onehotencoder', OneHotEncoder(), ['sex']),
 ('remainder', 'drop', [0, 1, 4, 5, 6, 8])]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see the difference. There is an extra transformer with the name <code>remainder</code> at the end. It was not present at the initialization time. What it does is that it drops all remaining columns from the dataset that have not been explicitly used in the ColumnTransformer. Since, at the initialization time, ColumnTransformer does not know about the <strong>other columns</strong> that it needs to drop this transformer is missing. During fit it sees the dataset and knows about the other columns, it then keeps a list of them to drop <strong>(0, 1, 4, 5, 6, 8)</strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also index through the transformers as well to fetch anyone from the list.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># second transformer from the list</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>('onehotencoder', OneHotEncoder(), ['sex'])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice the tuple sequence.</p>
<ul>
<li>First is the name</li>
<li>Second is the <strong>transformer</strong>
</li>
<li>Third are the column names</li>
</ul>
<p>We can also call <code>get_feature_names_out</code> method on a separate transformer from the list.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># output features from second tranformer</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array(['sex_female', 'sex_male'], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># output features from last tranformer</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="c1"># No. We cannot do this on last transformer (remainder).</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>                            Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [22]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)">#collapse-output</span>
<span class="ansi-green-fg">      2</span> <span style="color: rgb(95,135,135)"># output features from last tranformer</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 3</span> <span class="ansi-yellow-bg">pipe</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">transformers_</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">-</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_feature_names_out</span>()

<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>: 'str' object has no attribute 'get_feature_names_out'</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now have output feature names, and the output (nd-array). Can we convert them to a DataFrame?</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">col_names</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">col_names</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">output</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="FunctionTransformer">
<a class="anchor" href="#FunctionTransformer" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html">FunctionTransformer</a><a class="anchor-link" href="#FunctionTransformer"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We know how to convert the transformer output to a DataFrame. It would be much simpler if we don't have to do an extra step, and can directly get a Dataframe from our fitted ColumnTransformer.</p>
<p>For this we can take the help of <code>FunctionTransformer</code></p>
<blockquote>
<p>A FunctionTransformer forwards its X (and optionally y) arguments to a user-defined function or function object and returns the result of this function.</p>
</blockquote>
<p>Let's see a FunctionTransformer in action.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span> <span class="p">),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())))</span>
                    <span class="p">])</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">"diagram"</span><span class="p">)</span>
<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-dc5aef48-8c2a-4f33-9085-34090768e983 {color: black;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 pre{padding: 0;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable {background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-estimator:hover {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-item {z-index: 1;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-parallel-item:only-child::after {width: 0;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-dc5aef48-8c2a-4f33-9085-34090768e983 div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-dc5aef48-8c2a-4f33-9085-34090768e983" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;))])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="49d0b146-1bc2-4c8c-b4c2-432107121872" type="checkbox"><label for="49d0b146-1bc2-4c8c-b4c2-432107121872" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;))])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="b9c9c9fd-6abd-464a-a965-4eee6608e760" type="checkbox"><label for="b9c9c9fd-6abd-464a-a965-4eee6608e760" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="18e37f3b-5e1e-43a5-bdbc-98386493f20a" type="checkbox"><label for="18e37f3b-5e1e-43a5-bdbc-98386493f20a" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="39144de1-a891-4e83-8278-614246a7e0a1" type="checkbox"><label for="39144de1-a891-4e83-8278-614246a7e0a1" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="687bb43d-5c04-4da5-adbe-0700e7186fa5" type="checkbox"><label for="687bb43d-5c04-4da5-adbe-0700e7186fa5" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="0378e35b-0d19-4235-81fd-855750059d41" type="checkbox"><label for="0378e35b-0d19-4235-81fd-855750059d41" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="d18eac3c-4f6f-4f6e-8830-e1122927172d" type="checkbox"><label for="d18eac3c-4f6f-4f6e-8830-e1122927172d" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;)</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that we have applied FunctionTransformer after ColumnTransformer in a Pipeline. When we fit our pipeline on the dataset, ColumnTransformer will be fitted first and then the FunctionTransformer. Since the ColumnTransformer has been fitted first, we will be able to call <code>get_feature_names_out</code> on it while passing data to FunctionTransformer.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># let's run our pipeline again</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is looking good. We are now getting back a dataframe directly from the pipeline. With a dataframe it is a lot easier to view and verify the output from the preprocessor.</p>
<p>But we have to be very careful with FunctionTransformer. In Sklearn docs, it says</p>
<p><strong>Note: If a lambda is used as the function, then the resulting transformer will not be pickleable.</strong></p>
<p>Huh! that is a very concerning point. We have also used a lambda function, and we will not be able to pickle it. Let's check it first.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># save our pipeline</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>

<span class="c1"># reload it</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">s2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">PicklingError</span>                             Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [26]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pickle</span>
<span class="ansi-green-fg">      3</span> <span style="color: rgb(95,135,135)"># save our pipeline</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 4</span> s1 <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">pickle</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">dumps</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">pipe</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      6</span> <span style="color: rgb(95,135,135)"># reload it</span>
<span class="ansi-green-fg">      7</span> s2 <span style="color: rgb(98,98,98)">=</span> pickle<span style="color: rgb(98,98,98)">.</span>loads(s1)

<span class="ansi-red-intense-fg ansi-bold">PicklingError</span>: Can't pickle &lt;function &lt;lambda&gt; at 0x0000016196A1B040&gt;: attribute lookup &lt;lambda&gt; on __main__ failed</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The documentation was right about it. We have used a Lambda function in our FunctionTranformer and we got a pickle error. Since, the limitation is said for Lambda function, changing it with a normal function should work. Let's do that.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_dataframe</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformer</span><span class="p">):</span>
    <span class="sd">""" </span>
<span class="sd">    x: an nd-array</span>
<span class="sd">    transformer: fitted transformer</span>
<span class="sd">    """</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">col_names</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span> <span class="p">),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">"diagram"</span><span class="p">)</span>
<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 {color: black;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 pre{padding: 0;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable {background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-estimator:hover {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-item {z-index: 1;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-parallel-item:only-child::after {width: 0;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602 div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-65ffa3d3-3cf8-409e-8fec-4432dbf9e602" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="c1dd7b9c-8051-437c-a176-950e15eec6bc" type="checkbox"><label for="c1dd7b9c-8051-437c-a176-950e15eec6bc" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="73b087ba-e430-4766-a778-60104e03bc77" type="checkbox"><label for="73b087ba-e430-4766-a778-60104e03bc77" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="69d75b34-10a2-4774-ac52-f5e9afb59db4" type="checkbox"><label for="69d75b34-10a2-4774-ac52-f5e9afb59db4" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="d33f4bc8-d8f4-401a-a7ad-925058469130" type="checkbox"><label for="d33f4bc8-d8f4-401a-a7ad-925058469130" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="a15bdd72-d5d0-4c65-bccd-96270b7cfbfd" type="checkbox"><label for="a15bdd72-d5d0-4c65-bccd-96270b7cfbfd" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="93342583-a2e7-4912-a003-5c407b1dadfe" type="checkbox"><label for="93342583-a2e7-4912-a003-5c407b1dadfe" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="8a9f3153-55f2-4f14-a771-4371c8673e32" type="checkbox"><label for="8a9f3153-55f2-4f14-a771-4371c8673e32" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                             StandardScaler(),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(),
                                                                             ['sex'])],
                                                              verbose_feature_names_out=False)})</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice the arguments for FunctionTransformer in the above code.</p>
<ul>
<li>first argument is the function to be called</li>
<li>second argument are the parameters to be passed to our function</li>
</ul>
<p>The sequence of arguments for the callable function will be</p>
<ul>
<li>first argument will be the output from any previous step in the pipeline (if there is any). In our case, it is nd-array coming from ColumnTransformer. It will be mapped to <code>X</code>. We don't have to do anything about it.</li>
<li>second argument (if any) we want to pass to function. In our case we need it to be the fitted transformer from the previous step so we have explicitly passed it using <code>kw_args</code> as key-value pair. Where key name is the same as callable method argument name ('transformer' in our case). </li>
</ul>
<p>Now let's do our pickle test one more time.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># save our pipeline</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>

<span class="c1"># reload it</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">s2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 {color: black;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 pre{padding: 0;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable {background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-estimator:hover {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-item {z-index: 1;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-parallel-item:only-child::after {width: 0;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59 div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-631ddde1-16ef-4a3c-b047-bad8f33b6f59" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="ec9bb235-5034-4154-8f6b-e8ab4b383581" type="checkbox"><label for="ec9bb235-5034-4154-8f6b-e8ab4b383581" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('standardscaler',
                                                  StandardScaler(),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(), ['sex'])],
                                   verbose_feature_names_out=False)),
                ('dataframer',
                 FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                                     kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                                              StandardScaler(),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(),
                                                                                              ['sex'])],
                                                                               verbose_feature_names_out=False)}))])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="bb60241a-02b2-4fae-ae5e-e587f5fcb569" type="checkbox"><label for="bb60241a-02b2-4fae-ae5e-e587f5fcb569" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('standardscaler', StandardScaler(),
                                 ['age', 'fare']),
                                ('onehotencoder', OneHotEncoder(), ['sex'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="4ef00a54-ef13-4006-b1e0-febf19c07340" type="checkbox"><label for="4ef00a54-ef13-4006-b1e0-febf19c07340" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="1d5d96ff-c056-40fb-a65d-7daa33aa6951" type="checkbox"><label for="1d5d96ff-c056-40fb-a65d-7daa33aa6951" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="44041671-e734-4d47-b00c-81d699a7b28a" type="checkbox"><label for="44041671-e734-4d47-b00c-81d699a7b28a" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="a8fd907f-d663-419e-bd03-d35a0b28a057" type="checkbox"><label for="a8fd907f-d663-419e-bd03-d35a0b28a057" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="e32941e4-8a75-49d1-ba1d-0bd1869df507" type="checkbox"><label for="e32941e4-8a75-49d1-ba1d-0bd1869df507" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('standardscaler',
                                                                             StandardScaler(),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(),
                                                                             ['sex'])],
                                                              verbose_feature_names_out=False)})</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alright, no more issues so let's proceed to our next question.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Where-are-the-rest-of-the-columns?">
<a class="anchor" href="#Where-are-the-rest-of-the-columns?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Where are the rest of the columns?<a class="anchor-link" href="#Where-are-the-rest-of-the-columns?"> </a>
</h3>
<p>By default, only the specified columns in transformers are transformed and combined in the output, and the non-specified columns are dropped. (default of <code>remainder='drop'</code>). By specifying <code>remainder='passthrough'</code>, all remaining columns that were not specified in transformers will be automatically passed through. This subset of columns is concatenated with the output of the transformers.</p>
<p>Let's see it in action.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'fare'</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span> <span class="p">),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">'passthrough'</span>
<span class="p">)</span>

<span class="c1"># get_dataframe is already defined in last section. Intentionally omitted here. </span>
<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>-0.499399</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.390431</td>
      <td>-0.090935</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.296092</td>
      <td>-0.018241</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.320765</td>
      <td>-0.510137</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.947761</td>
      <td>-0.501444</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have our remaining features back now, so let's proceed to our next question.</p>
<h3 id="What-happens-if-I-change-the-sequence-in-ColumnTranformer?">
<a class="anchor" href="#What-happens-if-I-change-the-sequence-in-ColumnTranformer?" aria-hidden="true"><span class="octicon octicon-link"></span></a>What happens if I change the sequence in ColumnTranformer?<a class="anchor-link" href="#What-happens-if-I-change-the-sequence-in-ColumnTranformer?"> </a>
</h3>
<p>It is better to make some changes and then see the results. I am making two changes in ColumnTransformer</p>
<ol>
<li>Changed the order of transformers (OHE before scaling)</li>
<li>Changed the order of features inside the transformer ('fare' before 'age')</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span> <span class="p">),</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'fare'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">]),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">'passthrough'</span>
<span class="p">)</span>

<span class="c1"># get_dataframe is already defined in last section. Intentionally omitted here. </span>
<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>fare</th>
      <th>age</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.499399</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.090935</td>
      <td>-0.390431</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.018241</td>
      <td>-1.296092</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.510137</td>
      <td>-0.320765</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.501444</td>
      <td>-0.947761</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that changing the sequence in ColumnTransformer does change the output. Also note</p>
<ul>
<li>Specified columns in transformers are transformed and combined in the output</li>
<li>Transformers sequence in ColumnTransformer also represents the columns sequence in the output</li>
<li>When <code>remainder=passthrough</code> is used then remaining columns will be appended at the end. Remainder columns sequence will be same as in the input.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pipeline-inside-ColumnTransformer">
<a class="anchor" href="#Pipeline-inside-ColumnTransformer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pipeline inside ColumnTransformer<a class="anchor-link" href="#Pipeline-inside-ColumnTransformer"> </a>
</h2>
<p>Let's assume we have more requirements this time. I want</p>
<ul>
<li>for numerical features (age, fare): impute the missing values first, and then scale them</li>
<li>for categorical features (sex): one hot encode them</li>
</ul>
<p>Our pipeline will look like this.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"fare"</span><span class="p">]</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">"imputer"</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">"median"</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
        <span class="p">])</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sex"</span><span class="p">]</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> <span class="c1"># note "numeric_transformer" is a pipeline this time</span>
        <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s1">'passthrough'</span><span class="p">,</span>
        <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
</p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>                            Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [31]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     18</span> dataframer <span style="color: rgb(98,98,98)">=</span> FunctionTransformer(func<span style="color: rgb(98,98,98)">=</span>get_dataframe, kw_args<span style="color: rgb(98,98,98)">=</span>{<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">transformer</span><span style="color: rgb(175,0,0)">"</span>: preprocessor})
<span class="ansi-green-fg">     19</span> pipe <span style="color: rgb(98,98,98)">=</span> Pipeline([
<span class="ansi-green-fg">     20</span>                     (<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">preprocess</span><span style="color: rgb(175,0,0)">"</span>, preprocessor),
<span class="ansi-green-fg">     21</span>                     (<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">dataframer</span><span style="color: rgb(175,0,0)">"</span>, dataframer)
<span class="ansi-green-fg">     22</span>                 ])
<span class="ansi-green-intense-fg ansi-bold">---&gt; 24</span> temp <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">pipe</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X_train</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y_train</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     25</span> temp<span style="color: rgb(98,98,98)">.</span>head()

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:434</span>, in <span class="ansi-cyan-fg">Pipeline.fit_transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params)</span>
<span class="ansi-green-fg">    432</span> fit_params_last_step <span style="color: rgb(98,98,98)">=</span> fit_params_steps[<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>steps[<span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">1</span>][<span style="color: rgb(98,98,98)">0</span>]]
<span class="ansi-green-fg">    433</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">hasattr</span>(last_step, <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">fit_transform</span><span style="color: rgb(175,0,0)">"</span>):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 434</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">last_step</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">Xt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params_last_step</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    435</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    436</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> last_step<span style="color: rgb(98,98,98)">.</span>fit(Xt, y, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params_last_step)<span style="color: rgb(98,98,98)">.</span>transform(Xt)

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\base.py:855</span>, in <span class="ansi-cyan-fg">TransformerMixin.fit_transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params)</span>
<span class="ansi-green-fg">    852</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>fit(X, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params)<span style="color: rgb(98,98,98)">.</span>transform(X)
<span class="ansi-green-fg">    853</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    854</span>     <span style="color: rgb(95,135,135)"># fit method of arity 2 (supervised transformation)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 855</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\preprocessing\_function_transformer.py:182</span>, in <span class="ansi-cyan-fg">FunctionTransformer.transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X)</span>
<span class="ansi-green-fg">    169</span> <span style="color: rgb(175,0,0)">"""Transform X using the forward function.</span>
<span class="ansi-green-fg">    170</span> 
<span class="ansi-green-fg">    171</span> <span style="color: rgb(175,0,0)">Parameters</span>
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    179</span> <span style="color: rgb(175,0,0)">    Transformed input.</span>
<span class="ansi-green-fg">    180</span> <span style="color: rgb(175,0,0)">"""</span>
<span class="ansi-green-fg">    181</span> X <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_check_input(X, reset<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 182</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kw_args</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">kw_args</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\preprocessing\_function_transformer.py:205</span>, in <span class="ansi-cyan-fg">FunctionTransformer._transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, func, kw_args)</span>
<span class="ansi-green-fg">    202</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> func <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    203</span>     func <span style="color: rgb(98,98,98)">=</span> _identity
<span class="ansi-green-intense-fg ansi-bold">--&gt; 205</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">kw_args</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">if</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kw_args</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">else</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">{</span><span class="ansi-yellow-bg">}</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>

Input <span class="ansi-green-intense-fg ansi-bold">In [27]</span>, in <span class="ansi-cyan-fg">get_dataframe</span><span class="ansi-blue-intense-fg ansi-bold">(X, transformer)</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">get_dataframe</span>(X, transformer):
<span class="ansi-green-fg">      2</span>     <span style="color: rgb(175,0,0)">""" </span>
<span class="ansi-green-fg">      3</span> <span style="color: rgb(175,0,0)">    x: an nd-array</span>
<span class="ansi-green-fg">      4</span> <span style="color: rgb(175,0,0)">    transformer: fitted transformer</span>
<span class="ansi-green-fg">      5</span> <span style="color: rgb(175,0,0)">    """</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 6</span>     col_names <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">transformer</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_feature_names_out</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      7</span>     output <span style="color: rgb(98,98,98)">=</span> pd<span style="color: rgb(98,98,98)">.</span>DataFrame(X<span style="color: rgb(98,98,98)">.</span>T, col_names)<span style="color: rgb(98,98,98)">.</span>T
<span class="ansi-green-fg">      8</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> output

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\compose\_column_transformer.py:481</span>, in <span class="ansi-cyan-fg">ColumnTransformer.get_feature_names_out</span><span class="ansi-blue-intense-fg ansi-bold">(self, input_features)</span>
<span class="ansi-green-fg">    479</span> transformer_with_feature_names_out <span style="color: rgb(98,98,98)">=</span> []
<span class="ansi-green-fg">    480</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> name, trans, column, _ <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_iter(fitted<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 481</span>     feature_names_out <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_get_feature_name_out_for_transformer</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    482</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">name</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">trans</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">column</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">input_features</span>
<span class="ansi-green-fg">    483</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    484</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> feature_names_out <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    485</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">continue</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\compose\_column_transformer.py:454</span>, in <span class="ansi-cyan-fg">ColumnTransformer._get_feature_name_out_for_transformer</span><span class="ansi-blue-intense-fg ansi-bold">(self, name, trans, column, feature_names_in)</span>
<span class="ansi-green-fg">    450</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(column, Iterable) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span style="color: rgb(0,135,0)">all</span>(
<span class="ansi-green-fg">    451</span>     <span style="color: rgb(0,135,0)">isinstance</span>(col, <span style="color: rgb(0,135,0)">str</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> col <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> column
<span class="ansi-green-fg">    452</span> ):
<span class="ansi-green-fg">    453</span>     column <span style="color: rgb(98,98,98)">=</span> _safe_indexing(feature_names_in, column)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 454</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">trans</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_feature_names_out</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">column</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:751</span>, in <span class="ansi-cyan-fg">Pipeline.get_feature_names_out</span><span class="ansi-blue-intense-fg ansi-bold">(self, input_features)</span>
<span class="ansi-green-fg">    749</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> _, name, transform <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_iter():
<span class="ansi-green-fg">    750</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span style="color: rgb(0,135,0)">hasattr</span>(transform, <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">get_feature_names_out</span><span style="color: rgb(175,0,0)">"</span>):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 751</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">AttributeError</span>(
<span class="ansi-green-fg">    752</span>             <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">Estimator </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> does not provide get_feature_names_out. </span><span style="color: rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    753</span>             <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">Did you mean to call pipeline[:-1].get_feature_names_out</span><span style="color: rgb(175,0,0)">"</span>
<span class="ansi-green-fg">    754</span>             <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">()?</span><span style="color: rgb(175,0,0)">"</span><span style="color: rgb(98,98,98)">.</span>format(name)
<span class="ansi-green-fg">    755</span>         )
<span class="ansi-green-fg">    756</span>     feature_names_out <span style="color: rgb(98,98,98)">=</span> transform<span style="color: rgb(98,98,98)">.</span>get_feature_names_out(feature_names_out)
<span class="ansi-green-fg">    757</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> feature_names_out

<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>: Estimator imputer does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?</pre>
</div>
</div>

</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Oh geez! What went wrong this time. The error message says</p>

<pre><code>AttributeError: Estimator imputer does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?</code></pre>
<p>From the error message I am getting that</p>
<blockquote>
<p>Estimator imputer does not provide get_feature_names_out</p>
</blockquote>
<p>Hmmm, this is strange. Why is this estimator missing a very useful function? Let's check the docs first on <a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html">SimpleImputer</a>. For the docs I indeed could not find this method <code>get_feature_names_out()</code> for this transformer. A little googling lead me to this Sklearn Github issue page <a href="https://github.com/scikit-learn/scikit-learn/issues/21308">Implement get_feature_names_out for all estimators</a>. Developers are actively adding <code>get_feature_names_out()</code> to all estimators and transformers, and it looks like this feature has not been implemented for <code>SimpleImputer</code> till Sklearn version==1.0.2. 
But no worries we can overcome this limitation, and implement this feature ourselves through a custom transformer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Custom-Transformer">
<a class="anchor" href="#Custom-Transformer" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://scikit-learn.org/stable/developers/develop.html#rolling-your-own-estimator">Custom Transformer</a><a class="anchor-link" href="#Custom-Transformer"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can create a custom transformer or an estimator simply by inheriting a class from <code>BaseEstimator</code> and optionally the mixin classes in <code>sklearn.base</code>. Sklean provides a template that we can use to create our custom transformer. Template link is here: <a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L146">https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L146</a></p>
<p>Let us use the same pipeline as in last cell but replace <code>SimpleImputer</code> with a custom one.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>

<span class="k">class</span> <span class="nc">SimpleImputerCustom</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
       
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># we have returned the input features name as out features will have the same name</span>
        <span class="k">return</span> <span class="n">input_features</span>


<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"fare"</span><span class="p">]</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">"imputer"</span><span class="p">,</span> <span class="n">SimpleImputerCustom</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
             <span class="p">]</span>
<span class="p">)</span>


<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sex"</span><span class="p">]</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> <span class="c1"># note "numeric_transformer" is a pipeline</span>
        <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s1">'passthrough'</span><span class="p">,</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>pclass</th>
      <th>name</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>-0.499638</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.436411</td>
      <td>-0.090979</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.448729</td>
      <td>-0.01825</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.358541</td>
      <td>-0.510381</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.059376</td>
      <td>-0.501684</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-Engineering-with-Custom-Transformer">
<a class="anchor" href="#Feature-Engineering-with-Custom-Transformer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Feature Engineering with Custom Transformer<a class="anchor-link" href="#Feature-Engineering-with-Custom-Transformer"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So far, so good! Let's assume that we have another requirement and it is about feature engineering. We have to combine 'sibsp' and 'parch' into two new features: family_size and is_alone.</p>
<p>Let's implement this now.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">FamilyFeatureTransformer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
       
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">'family_size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">'parch'</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s1">'sibsp'</span><span class="p">]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'parch'</span><span class="p">,</span> <span class="s1">'sibsp'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we can drop this feature now</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">'is_alone'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">'family_size'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'is_alone'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">X</span>
    
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># this time we have created new features. Their names are different from input features.</span>
        <span class="c1"># so we have explicitly mentioned them here.</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'family_size'</span><span class="p">,</span> <span class="s1">'is_alone'</span><span class="p">]</span>

<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"fare"</span><span class="p">]</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">"imputer"</span><span class="p">,</span> <span class="n">SimpleImputerCustom</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
             <span class="p">]</span>
<span class="p">)</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sex"</span><span class="p">]</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="n">family_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"parch"</span><span class="p">,</span> <span class="s2">"sibsp"</span><span class="p">]</span>
<span class="n">family_transformer</span> <span class="o">=</span> <span class="n">FamilyFeatureTransformer</span><span class="p">()</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> 
        <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="n">family_transformer</span><span class="p">,</span> <span class="n">family_features</span><span class="p">),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s1">'drop'</span><span class="p">,</span> <span class="c1"># let's drop extra features this time</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">)</span>
                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>fare</th>
      <th>sex_female</th>
      <th>sex_male</th>
      <th>family_size</th>
      <th>is_alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000000</td>
      <td>-0.499638</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.436411</td>
      <td>-0.090979</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.448729</td>
      <td>-0.018250</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.358541</td>
      <td>-0.510381</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.059376</td>
      <td>-0.501684</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sklean-Pipeline-with-Feature-Importance">
<a class="anchor" href="#Sklean-Pipeline-with-Feature-Importance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sklean Pipeline with Feature Importance<a class="anchor-link" href="#Sklean-Pipeline-with-Feature-Importance"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alright, we have our required features ready and we can now pass them to a classifier. Let's use RandomForrest as our classifier and run our pipeline with it.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="c1"># 'preprocessor' and 'dataframer' are already declared in last section, and intentionally omitted here.</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">'rf_estimator'</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>

                <span class="p">])</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>                            Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [34]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      4</span> <span style="color: rgb(95,135,135)"># 'preprocessor' and 'dataframer' are already declared in last section, and intentionally omitted here.</span>
<span class="ansi-green-fg">      5</span> pipe <span style="color: rgb(98,98,98)">=</span> Pipeline([
<span class="ansi-green-fg">      6</span>                     (<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">preprocess</span><span style="color: rgb(175,0,0)">"</span>, preprocessor),
<span class="ansi-green-fg">      7</span>                     (<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">dataframer</span><span style="color: rgb(175,0,0)">"</span>, dataframer),
<span class="ansi-green-fg">      8</span>                     (<span style="color: rgb(175,0,0)">'</span><span style="color: rgb(175,0,0)">rf_estimator</span><span style="color: rgb(175,0,0)">'</span>, RandomForestClassifier())
<span class="ansi-green-fg">      9</span> 
<span class="ansi-green-fg">     10</span>                 ])
<span class="ansi-green-intense-fg ansi-bold">---&gt; 12</span> temp <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">pipe</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit_transform</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X_train</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y_train</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     13</span> temp<span style="color: rgb(98,98,98)">.</span>head()

File <span class="ansi-green-intense-fg ansi-bold">~\anaconda3\envs\sc_mlflow\lib\site-packages\sklearn\pipeline.py:436</span>, in <span class="ansi-cyan-fg">Pipeline.fit_transform</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, **fit_params)</span>
<span class="ansi-green-fg">    434</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> last_step<span style="color: rgb(98,98,98)">.</span>fit_transform(Xt, y, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>fit_params_last_step)
<span class="ansi-green-fg">    435</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">--&gt; 436</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">last_step</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">Xt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">y</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">fit_params_last_step</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">transform</span>(Xt)

<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>: 'RandomForestClassifier' object has no attribute 'transform'</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Okay, looks like we have made a mistake here. Error message is saying</p>

<pre><code>AttributeError: 'RandomForestClassifier' object has no attribute 'transform'</code></pre>
<p>I get that. In our pipeline we have an estimator that does not have a <code>transform</code> method defined for it. We should use <code>predict</code> method instead.</p>
<p>Note:</p>
<ul>
<li>Estimators implement predict method (<a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L11">Template reference Estimator</a>, <a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L74">Template reference Classifier</a>)</li>
<li>Transformers implement transform method (<a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py#L146">Template reference Transformer</a>)</li>
<li>
<code>fit_transform</code> is same calling <code>fit</code> and then <code>transform</code>
</li>
</ul>
<p>Let us fix the error and run our pipeline again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pipeline created in last section and intentionally omitted here.</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7862595419847328</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see how our final pipeline looks visually.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># set_config(display='text')</span>
<span class="n">pipe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-094f6b23-72e9-4895-8e98-607e2a1a464e {color: black;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e pre{padding: 0;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable {background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-estimator:hover {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-item {z-index: 1;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-parallel-item:only-child::after {width: 0;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-094f6b23-72e9-4895-8e98-607e2a1a464e div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-094f6b23-72e9-4895-8e98-607e2a1a464e" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="ca76dfde-00f2-4057-a29c-a8116207019d" type="checkbox"><label for="ca76dfde-00f2-4057-a29c-a8116207019d" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="4e3834d5-ce09-4677-875a-61109d70af6a" type="checkbox"><label for="4e3834d5-ce09-4677-875a-61109d70af6a" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputerCustom()),
                                                 ('scaler', StandardScaler())]),
                                 ['age', 'fare']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['sex']),
                                ('familyfeaturetransformer',
                                 FamilyFeatureTransformer(),
                                 ['parch', 'sibsp'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="f25f2e93-bb80-4e54-bfff-b7263183cbd3" type="checkbox"><label for="f25f2e93-bb80-4e54-bfff-b7263183cbd3" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-serial">
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="108a879c-a560-40ae-a624-db3e332efe26" type="checkbox"><label for="108a879c-a560-40ae-a624-db3e332efe26" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputerCustom</label><div class="sk-toggleable__content"><pre>SimpleImputerCustom()</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="39c8a3a9-d36f-42c3-ab7c-86e69958a54f" type="checkbox"><label for="39c8a3a9-d36f-42c3-ab7c-86e69958a54f" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="484841a9-3d3d-4e15-9c6e-4f41d0b4e65e" type="checkbox"><label for="484841a9-3d3d-4e15-9c6e-4f41d0b4e65e" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="f9bd1712-adee-4275-b38c-903a02139b82" type="checkbox"><label for="f9bd1712-adee-4275-b38c-903a02139b82" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="09a0f69d-bb27-405a-87df-bae3d2aeda22" type="checkbox"><label for="09a0f69d-bb27-405a-87df-bae3d2aeda22" class="sk-toggleable__label sk-toggleable__label-arrow">familyfeaturetransformer</label><div class="sk-toggleable__content"><pre>['parch', 'sibsp']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="09ebfae6-ee32-43db-a2eb-0bb75605ff87" type="checkbox"><label for="09ebfae6-ee32-43db-a2eb-0bb75605ff87" class="sk-toggleable__label sk-toggleable__label-arrow">FamilyFeatureTransformer</label><div class="sk-toggleable__content"><pre>FamilyFeatureTransformer()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="173bb70a-3517-42e8-abbb-67fabd971aae" type="checkbox"><label for="173bb70a-3517-42e8-abbb-67fabd971aae" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161953C3670&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                             Pipeline(steps=[('imputer',
                                                                                              SimpleImputerCustom()),
                                                                                             ('scaler',
                                                                                              StandardScaler())]),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(handle_unknown='ignore'),
                                                                             ['sex']),
                                                                            ('familyfeaturetransformer',
                                                                             FamilyFeatureTransformer(),
                                                                             ['parch',
                                                                              'sibsp'])],
                                                              verbose_feature_names_out=False)})</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="2d648296-9d3f-453c-92f0-23fd7bb38a06" type="checkbox"><label for="2d648296-9d3f-453c-92f0-23fd7bb38a06" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also get the importance of features in our dataset from RandomForrest classifier.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># last estimator is the RF classifier</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_names_in_</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Importances'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="p">[</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Relative Importance'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that all the feature names were passed to the RF Classifier and that is why we were able to get them back using its attribute <code>feature_names_in_</code>. This can be super useful when you have many model deployed in the environment, and you can just use the model object to get information about the features it was trained on.</p>
<p>For a moment let's also remove the feature names from our pipeline and see how it will effect our feature importance plot.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="c1"># ("dataframer", dataframer),</span>
                    <span class="p">(</span><span class="s1">'rf_estimator'</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>

                <span class="p">])</span>

<span class="c1"># fit the pipeline</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># get the feature importance plot</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_names_in_</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Importances'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="p">[</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Relative Importance'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>                            Traceback (most recent call last)
Input <span class="ansi-green-intense-fg ansi-bold">In [38]</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     12</span> clf <span style="color: rgb(98,98,98)">=</span> pipe[<span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">1</span>]
<span class="ansi-green-fg">     13</span> importances <span style="color: rgb(98,98,98)">=</span> clf<span style="color: rgb(98,98,98)">.</span>feature_importances_
<span class="ansi-green-intense-fg ansi-bold">---&gt; 14</span> features <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">clf</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">feature_names_in_</span>
<span class="ansi-green-fg">     16</span> indices <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>argsort(importances)
<span class="ansi-green-fg">     18</span> plt<span style="color: rgb(98,98,98)">.</span>title(<span style="color: rgb(175,0,0)">'</span><span style="color: rgb(175,0,0)">Feature Importances</span><span style="color: rgb(175,0,0)">'</span>)

<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>: 'RandomForestClassifier' object has no attribute 'feature_names_in_'</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>No feature names were passed to our classifier this time and it is missing <code>feature_names_in_</code> attribute. We can circumvent this and still get feature importance plot.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="c1"># ("dataframer", dataframer),</span>
                    <span class="p">(</span><span class="s1">'rf_estimator'</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>

                <span class="p">])</span>

<span class="c1"># fit the pipeline</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># get the feature importance plot</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="c1"># features = clf.feature_names_in_</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Importances'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Relative Importance'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This time we get the same plot but not withOUT feature names, and it is not useful anymore. So definitely we need to keep the feature names with the final estimator. Feature names can help us a lot in interpreting the model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-complete-Pipeline">
<a class="anchor" href="#The-complete-Pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a>The complete Pipeline<a class="anchor-link" href="#The-complete-Pipeline"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For an easy reference, let's put the whole pipeline in one place.</p>
<h3 id="Load-Data">
<a class="anchor" href="#Load-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Load Data<a class="anchor-link" href="#Load-Data"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_openml</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># for consistency</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s2">"titanic"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'body'</span><span class="p">,</span> <span class="s1">'cabin'</span><span class="p">,</span> <span class="s1">'boat'</span><span class="p">,</span> <span class="s1">'home.dest'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pclass</th>
      <th>name</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>ticket</th>
      <th>fare</th>
      <th>embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>999</th>
      <td>3.0</td>
      <td>McCarthy, Miss. Catherine 'Katie'</td>
      <td>female</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>383123</td>
      <td>7.7500</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>392</th>
      <td>2.0</td>
      <td>del Carlo, Mrs. Sebastiano (Argenia Genovesi)</td>
      <td>female</td>
      <td>24.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>SC/PARIS 2167</td>
      <td>27.7208</td>
      <td>C</td>
    </tr>
    <tr>
      <th>628</th>
      <td>3.0</td>
      <td>Andersson, Miss. Sigrid Elisabeth</td>
      <td>female</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>347082</td>
      <td>31.2750</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1165</th>
      <td>3.0</td>
      <td>Saad, Mr. Khalil</td>
      <td>male</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2672</td>
      <td>7.2250</td>
      <td>C</td>
    </tr>
    <tr>
      <th>604</th>
      <td>3.0</td>
      <td>Abelseth, Miss. Karen Marie</td>
      <td>female</td>
      <td>16.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>348125</td>
      <td>7.6500</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Train-Model">
<a class="anchor" href="#Train-Model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Train Model<a class="anchor-link" href="#Train-Model"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="k">class</span> <span class="nc">FamilyFeatureTransformer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
       
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">'family_size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">'parch'</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s1">'sibsp'</span><span class="p">]</span>
        <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'parch'</span><span class="p">,</span> <span class="s1">'sibsp'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we can drop this feature now</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">'is_alone'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">'family_size'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'is_alone'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">X</span>
    
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># this time we have created new features. Their names are different from input features.</span>
        <span class="c1"># so we have explicitly mentioned them here.</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'family_size'</span><span class="p">,</span> <span class="s1">'is_alone'</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">SimpleImputerCustom</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
       
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># we have returned the input features name as out features will have the same name</span>
        <span class="k">return</span> <span class="n">input_features</span>

<span class="k">def</span> <span class="nf">get_dataframe</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformer</span><span class="p">):</span>
    <span class="sd">""" </span>
<span class="sd">    x: an nd-array</span>
<span class="sd">    transformer: fitted transformer</span>
<span class="sd">    """</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">col_names</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">output</span>
    
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"age"</span><span class="p">,</span> <span class="s2">"fare"</span><span class="p">]</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">"imputer"</span><span class="p">,</span> <span class="n">SimpleImputerCustom</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
             <span class="p">]</span>
<span class="p">)</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sex"</span><span class="p">]</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="n">family_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"parch"</span><span class="p">,</span> <span class="s2">"sibsp"</span><span class="p">]</span>
<span class="n">family_transformer</span> <span class="o">=</span> <span class="n">FamilyFeatureTransformer</span><span class="p">()</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
        <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> 
        <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="n">family_transformer</span><span class="p">,</span> <span class="n">family_features</span><span class="p">),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s1">'drop'</span><span class="p">,</span> <span class="c1"># let's drop extra features this time</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">dataframer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_dataframe</span><span class="p">,</span> <span class="n">kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">"transformer"</span><span class="p">:</span> <span class="n">preprocessor</span><span class="p">})</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                    <span class="p">(</span><span class="s2">"preprocess"</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">"dataframer"</span><span class="p">,</span> <span class="n">dataframer</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">'rf_estimator'</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>

                <span class="p">])</span>

<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.8015267175572519</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plot-Feature-Importance">
<a class="anchor" href="#Plot-Feature-Importance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plot Feature Importance<a class="anchor-link" href="#Plot-Feature-Importance"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># last estimator is the RF classifier</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_names_in_</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Importances'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="p">[</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Relative Importance'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pickle-Test">
<a class="anchor" href="#Pickle-Test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pickle Test<a class="anchor-link" href="#Pickle-Test"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">"diagram"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># save our pipeline</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>

<span class="c1"># reload it</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">s2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-561aebda-eb81-4234-8134-ac945ae0df01 {color: black;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 pre{padding: 0;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable {background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-estimator:hover {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-item {z-index: 1;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-parallel-item:only-child::after {width: 0;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-561aebda-eb81-4234-8134-ac945ae0df01 div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-561aebda-eb81-4234-8134-ac945ae0df01" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="ce161ee7-57d7-4081-bf25-e6fc94b1e0d0" type="checkbox"><label for="ce161ee7-57d7-4081-bf25-e6fc94b1e0d0" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocess',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputerCustom()),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['age', 'fare']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['sex']),
                                                 ('familyfeaturetransformer',
                                                  FamilyFeatureTransformer(),
                                                  ['parch', 'sibsp'])],
                                   verbose_feature_names_out=False)),
                ('data...
                                     kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                                              Pipeline(steps=[('imputer',
                                                                                                               SimpleImputerCustom()),
                                                                                                              ('scaler',
                                                                                                               StandardScaler())]),
                                                                                              ['age',
                                                                                               'fare']),
                                                                                             ('onehotencoder',
                                                                                              OneHotEncoder(handle_unknown='ignore'),
                                                                                              ['sex']),
                                                                                             ('familyfeaturetransformer',
                                                                                              FamilyFeatureTransformer(),
                                                                                              ['parch',
                                                                                               'sibsp'])],
                                                                               verbose_feature_names_out=False)})),
                ('rf_estimator', RandomForestClassifier())])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="7113a6a8-63db-403d-8c92-759f9c794fce" type="checkbox"><label for="7113a6a8-63db-403d-8c92-759f9c794fce" class="sk-toggleable__label sk-toggleable__label-arrow">preprocess: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputerCustom()),
                                                 ('scaler', StandardScaler())]),
                                 ['age', 'fare']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['sex']),
                                ('familyfeaturetransformer',
                                 FamilyFeatureTransformer(),
                                 ['parch', 'sibsp'])],
                  verbose_feature_names_out=False)</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="5920ba7f-d5c9-4979-8dda-eb0ae3c2db59" type="checkbox"><label for="5920ba7f-d5c9-4979-8dda-eb0ae3c2db59" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline</label><div class="sk-toggleable__content"><pre>['age', 'fare']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-serial">
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="7e025bdd-c9ff-49d9-bee8-cc643b14d053" type="checkbox"><label for="7e025bdd-c9ff-49d9-bee8-cc643b14d053" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputerCustom</label><div class="sk-toggleable__content"><pre>SimpleImputerCustom()</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="ac2cc19d-8e5b-4005-b3d4-2d9972dd075c" type="checkbox"><label for="ac2cc19d-8e5b-4005-b3d4-2d9972dd075c" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div>
</div></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="302e430e-5d2f-44e2-a797-7c92d40a6f84" type="checkbox"><label for="302e430e-5d2f-44e2-a797-7c92d40a6f84" class="sk-toggleable__label sk-toggleable__label-arrow">onehotencoder</label><div class="sk-toggleable__content"><pre>['sex']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="e1eef113-4e5f-4f60-8b2d-f2698e9a0f6d" type="checkbox"><label for="e1eef113-4e5f-4f60-8b2d-f2698e9a0f6d" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="fedcce1a-e1b1-497e-826a-e23991cd9301" type="checkbox"><label for="fedcce1a-e1b1-497e-826a-e23991cd9301" class="sk-toggleable__label sk-toggleable__label-arrow">familyfeaturetransformer</label><div class="sk-toggleable__content"><pre>['parch', 'sibsp']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="394e3193-4df5-4f05-8acd-f0e5fccd524e" type="checkbox"><label for="394e3193-4df5-4f05-8acd-f0e5fccd524e" class="sk-toggleable__label sk-toggleable__label-arrow">FamilyFeatureTransformer</label><div class="sk-toggleable__content"><pre>FamilyFeatureTransformer()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="57a500e9-b6cc-4e50-b227-45c7f27b2b54" type="checkbox"><label for="57a500e9-b6cc-4e50-b227-45c7f27b2b54" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function get_dataframe at 0x00000161997DF3A0&gt;,
                    kw_args={'transformer': ColumnTransformer(transformers=[('pipeline',
                                                                             Pipeline(steps=[('imputer',
                                                                                              SimpleImputerCustom()),
                                                                                             ('scaler',
                                                                                              StandardScaler())]),
                                                                             ['age',
                                                                              'fare']),
                                                                            ('onehotencoder',
                                                                             OneHotEncoder(handle_unknown='ignore'),
                                                                             ['sex']),
                                                                            ('familyfeaturetransformer',
                                                                             FamilyFeatureTransformer(),
                                                                             ['parch',
                                                                              'sibsp'])],
                                                              verbose_feature_names_out=False)})</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="91e95626-95a2-491b-97e1-526e185c50b4" type="checkbox"><label for="91e95626-95a2-491b-97e1-526e185c50b4" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div>
</div></div>
</div>
</div></div>
</div>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="hassaanbinaslam/myblog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/myblog/ml/sklearn/2022/03/04/sklearn-pipeline-deep-dive.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/myblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/myblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/myblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A log of my mistakes, thoughts, and learning.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/hassaanbinaslam" target="_blank" title="hassaanbinaslam"><svg class="svg-icon grey"><use xlink:href="/myblog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/hassaanbinaslam" target="_blank" title="hassaanbinaslam"><svg class="svg-icon grey"><use xlink:href="/myblog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
